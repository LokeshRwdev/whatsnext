(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8341,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={cancelIdleCallback:function(){return o},requestIdleCallback:function(){return s}};for(var a in r)Object.defineProperty(n,a,{enumerable:!0,get:r[a]});let s="undefined"!=typeof self&&self.requestIdleCallback&&self.requestIdleCallback.bind(window)||function(e){let t=Date.now();return self.setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},o="undefined"!=typeof self&&self.cancelIdleCallback&&self.cancelIdleCallback.bind(window)||function(e){return clearTimeout(e)};("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),t.exports=n.default)},79520,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={default:function(){return b},handleClientScriptLoad:function(){return x},initScriptLoader:function(){return h}};for(var a in r)Object.defineProperty(n,a,{enumerable:!0,get:r[a]});let s=e.r(55682),o=e.r(90809),i=e.r(43476),l=s._(e.r(74080)),c=o._(e.r(71645)),u=e.r(42732),d=e.r(22737),f=e.r(8341),m=new Map,p=new Set,g=e=>{let{src:t,id:n,onLoad:r=()=>{},onReady:a=null,dangerouslySetInnerHTML:s,children:o="",strategy:i="afterInteractive",onError:c,stylesheets:u}=e,f=n||t;if(f&&p.has(f))return;if(m.has(t)){p.add(f),m.get(t).then(r,c);return}let g=()=>{a&&a(),p.add(f)},x=document.createElement("script"),h=new Promise((e,t)=>{x.addEventListener("load",function(t){e(),r&&r.call(this,t),g()}),x.addEventListener("error",function(e){t(e)})}).catch(function(e){c&&c(e)});s?(x.innerHTML=s.__html||"",g()):o?(x.textContent="string"==typeof o?o:Array.isArray(o)?o.join(""):"",g()):t&&(x.src=t,m.set(t,h)),(0,d.setAttributesFromProps)(x,e),"worker"===i&&x.setAttribute("type","text/partytown"),x.setAttribute("data-nscript",i),u&&(e=>{if(l.default.preinit)return e.forEach(e=>{l.default.preinit(e,{as:"style"})});if("undefined"!=typeof window){let t=document.head;e.forEach(e=>{let n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.appendChild(n)})}})(u),document.body.appendChild(x)};function x(e){let{strategy:t="afterInteractive"}=e;"lazyOnload"===t?window.addEventListener("load",()=>{(0,f.requestIdleCallback)(()=>g(e))}):g(e)}function h(e){e.forEach(x),[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach(e=>{let t=e.id||e.getAttribute("src");p.add(t)})}function y(e){let{id:t,src:n="",onLoad:r=()=>{},onReady:a=null,strategy:s="afterInteractive",onError:o,stylesheets:d,...m}=e,{updateScripts:x,scripts:h,getIsSsr:y,appDir:b,nonce:v}=(0,c.useContext)(u.HeadManagerContext);v=m.nonce||v;let w=(0,c.useRef)(!1);(0,c.useEffect)(()=>{let e=t||n;w.current||(a&&e&&p.has(e)&&a(),w.current=!0)},[a,t,n]);let j=(0,c.useRef)(!1);if((0,c.useEffect)(()=>{if(!j.current){if("afterInteractive"===s)g(e);else"lazyOnload"===s&&("complete"===document.readyState?(0,f.requestIdleCallback)(()=>g(e)):window.addEventListener("load",()=>{(0,f.requestIdleCallback)(()=>g(e))}));j.current=!0}},[e,s]),("beforeInteractive"===s||"worker"===s)&&(x?(h[s]=(h[s]||[]).concat([{id:t,src:n,onLoad:r,onReady:a,onError:o,...m,nonce:v}]),x(h)):y&&y()?p.add(t||n):y&&!y()&&g({...e,nonce:v})),b){if(d&&d.forEach(e=>{l.default.preinit(e,{as:"style"})}),"beforeInteractive"===s)if(!n)return m.dangerouslySetInnerHTML&&(m.children=m.dangerouslySetInnerHTML.__html,delete m.dangerouslySetInnerHTML),(0,i.jsx)("script",{nonce:v,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([0,{...m,id:t}])})`}});else return l.default.preload(n,m.integrity?{as:"script",integrity:m.integrity,nonce:v,crossOrigin:m.crossOrigin}:{as:"script",nonce:v,crossOrigin:m.crossOrigin}),(0,i.jsx)("script",{nonce:v,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([n,{...m,id:t}])})`}});"afterInteractive"===s&&n&&l.default.preload(n,m.integrity?{as:"script",integrity:m.integrity,nonce:v,crossOrigin:m.crossOrigin}:{as:"script",nonce:v,crossOrigin:m.crossOrigin})}return null}Object.defineProperty(y,"__nextScript",{value:!0});let b=y;("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),t.exports=n.default)},3303,(e,t,n)=>{t.exports=e.r(79520)},54949,e=>{"use strict";let t,n,r,a;var s=e.i(43476),o=e.i(62786),i=e.i(71645),l=e.i(44215);let c=(0,e.i(6344).create)(e=>({trackingOn:!1,permissionStatus:"prompt",lastFix:null,lastPingAt:null,lastRecommendation:null,error:null,isDriving:!1,autoStartPending:!0,setTrackingOn:t=>e({trackingOn:t}),setPermissionStatus:t=>e({permissionStatus:t}),setLastFix:t=>e({lastFix:t}),setLastPingAt:t=>e({lastPingAt:t}),setRecommendation:t=>e({lastRecommendation:t}),setError:t=>e({error:t}),setIsDriving:t=>e(()=>({isDriving:t,autoStartPending:!t})),setAutoStartPending:t=>e({autoStartPending:t})}));var u=e.i(70065),d=e.i(67881);let f=(0,e.i(75254).default)("arrow-up-right",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);var m=e.i(46897),p=e.i(16715),g=e.i(77241),x=e.i(55545),h=e.i(55024),y=e.i(99151),b=e.i(45110),v=e.i(81092);function w(e,t){let n=(0,v.toDate)(e)-(0,v.toDate)(t);return n<0?-1:n>0?1:n}var j=e.i(34662);function _({trackingOn:e,seedRecommendation:t}){var n,r;let{data:a}=function(e=0){let[t,n]=(0,i.useState)(null),[r,a]=(0,i.useState)(!0),[s,o]=(0,i.useState)(null),c=(0,i.useCallback)(async()=>{let{data:e,error:t}=await (0,l.fetchDriverState)();t?o(t.message):(o(null),n(e)),a(!1)},[]);return(0,i.useEffect)(()=>{if(c(),e>0){let t=setInterval(c,e);return()=>clearInterval(t)}},[c,e]),{data:t,loading:r,error:s,refresh:c}}(),[o,f]=(0,i.useState)(t??null),[m,_]=(0,i.useState)(!t),[M,N]=(0,i.useState)(null),k=c(e=>e.setRecommendation),D=c(e=>e.lastFix),E=(0,i.useRef)(D),C=(0,i.useRef)(0);(0,i.useEffect)(()=>{E.current=D},[D]);let P=(0,i.useCallback)(e=>{f(e),k(e)},[k]),O=(0,i.useCallback)(()=>{if(a?.recommendation){let e=a.recommendation;if(Date.now()-Date.parse(e.computed_at)<45e3)return P(e),N(null),_(!1),!0}return!1},[a,P]),L=(0,i.useCallback)(async()=>{C.current=Date.now(),_(!0);let e={k:3},t=E.current;t&&(e.lat=t.lat,e.lon=t.lon);let{data:n,error:r}=await (0,l.fetchRecommendations)(e);r?"NO_STATE"===r.code?N("We couldn't get your current location. Enable live tracking or share location to see zone recommendations."):N(r.message):(N(null),P(n)),_(!1)},[P]);(0,i.useEffect)(()=>{t||O()||L()},[t,O,L]),(0,i.useEffect)(()=>{O()},[a,O]),(0,i.useEffect)(()=>{t&&(!o||t.computed_at!==o.computed_at)&&P(t)},[t,o,P]);let T=(0,i.useCallback)(()=>{Date.now()-C.current<18e4||L()},[L]);(0,i.useEffect)(()=>{if(!e)return;T();let t=setInterval(T,18e4);return()=>clearInterval(t)},[e,T]);let B=!m&&!M&&(!o||!o.top||0===o.top.length),R=e&&!D,A=o?.computed_at?(n=new Date(o.computed_at),r={addSuffix:!0},function(e,t,n){var r;let a,s=(0,h.getDefaultOptions)(),o=n?.locale??s.locale??x.defaultLocale,i=w(e,t);if(isNaN(i))throw RangeError("Invalid time value");let l=Object.assign({},n,{addSuffix:n?.addSuffix,comparison:i}),[c,u]=(0,b.normalizeDates)(n?.in,...i>0?[t,e]:[e,t]),d=(r=void 0,e=>{let t=(r?Math[r]:Math.trunc)(e);return 0===t?0:t})(((0,v.toDate)(u)-(0,v.toDate)(c))/1e3),f=Math.round((d-((0,y.getTimezoneOffsetInMilliseconds)(u)-(0,y.getTimezoneOffsetInMilliseconds)(c))/1e3)/60);if(f<2)if(n?.includeSeconds)if(d<5)return o.formatDistance("lessThanXSeconds",5,l);else if(d<10)return o.formatDistance("lessThanXSeconds",10,l);else if(d<20)return o.formatDistance("lessThanXSeconds",20,l);else if(d<40)return o.formatDistance("halfAMinute",0,l);else if(d<60)return o.formatDistance("lessThanXMinutes",1,l);else return o.formatDistance("xMinutes",1,l);else if(0===f)return o.formatDistance("lessThanXMinutes",1,l);else return o.formatDistance("xMinutes",f,l);if(f<45)return o.formatDistance("xMinutes",f,l);if(f<90)return o.formatDistance("aboutXHours",1,l);if(f<j.minutesInDay){let e=Math.round(f/60);return o.formatDistance("aboutXHours",e,l)}if(f<2520)return o.formatDistance("xDays",1,l);else if(f<j.minutesInMonth){let e=Math.round(f/j.minutesInDay);return o.formatDistance("xDays",e,l)}else if(f<2*j.minutesInMonth)return a=Math.round(f/j.minutesInMonth),o.formatDistance("aboutXMonths",a,l);if((a=function(e,t,n){var r,a;let s,o,i,l,[c,u,d]=(0,b.normalizeDates)(void 0,e,e,t),f=w(u,d),m=Math.abs(function(e,t,n){let[r,a]=(0,b.normalizeDates)(void 0,e,t);return 12*(r.getFullYear()-a.getFullYear())+(r.getMonth()-a.getMonth())}(u,d));if(m<1)return 0;1===u.getMonth()&&u.getDate()>27&&u.setDate(30),u.setMonth(u.getMonth()-f*m);let p=w(u,d)===-f;+(s=(0,v.toDate)(c,void 0),r=void 0,(o=(0,v.toDate)(s,r?.in)).setHours(23,59,59,999),o)==+(a=void 0,l=(i=(0,v.toDate)(s,a?.in)).getMonth(),i.setFullYear(i.getFullYear(),l+1,0),i.setHours(23,59,59,999),i)&&1===m&&1===w(c,d)&&(p=!1);let g=f*(m-p);return 0===g?0:g}(u,c))<12){let e=Math.round(f/j.minutesInMonth);return o.formatDistance("xMonths",e,l)}{let e=a%12,t=Math.trunc(a/12);return e<3?o.formatDistance("aboutXYears",t,l):e<9?o.formatDistance("overXYears",t,l):o.formatDistance("almostXYears",t+1,l)}}(n,(0,g.constructFrom)(n,Date.now()),r)):null,z=o?.context,F="number"==typeof z?.traffic_speed_idx?z.traffic_speed_idx:null,q=o?.traffic_source??null,$=(0,i.useMemo)(()=>{var e;return[A?`Refreshed ${A}`:"Refreshed just now","google"===(e=q)?"Google live traffic":"cache"===e?"Cached traffic snapshot":"fallback"===e?"Estimated traffic":null,null!==F?`Avg traffic ${S(F)}`:null].filter(Boolean).join(" | ")},[A,q,F]);return(0,s.jsxs)(u.Card,{className:"shadow-sm",children:[(0,s.jsxs)(u.CardHeader,{className:"flex flex-row items-center justify-between space-y-0",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(u.CardTitle,{className:"text-base font-semibold",children:"Next best zones"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:$})]}),(0,s.jsx)(d.Button,{variant:"ghost",size:"icon","aria-label":"Refresh",onClick:L,children:(0,s.jsx)(p.RefreshCw,{className:"h-4 w-4"})})]}),(0,s.jsxs)(u.CardContent,{className:"space-y-4",children:[m&&(0,s.jsx)("div",{className:"space-y-3",children:[0,1,2].map(e=>(0,s.jsxs)("div",{className:"rounded-xl border p-3",children:[(0,s.jsx)("div",{className:"h-4 w-1/2 animate-pulse rounded bg-muted"}),(0,s.jsx)("div",{className:"mt-2 h-3 w-1/3 animate-pulse rounded bg-muted"})]},e))}),!m&&M&&(0,s.jsxs)("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:[M,(0,s.jsx)(d.Button,{size:"sm",variant:"secondary",className:"mt-3",onClick:L,children:"Try again"})]}),B&&(0,s.jsx)("div",{className:"rounded-xl border border-dashed p-4 text-sm text-muted-foreground",children:R?"Waiting for GPS fix...":"We'll start suggesting zones once we see your location."}),!m&&!M&&o?.top?.length?(0,s.jsx)("div",{className:"space-y-3",children:o.top.map(e=>(0,s.jsx)(I,{zone:e},e.zone_id))}):null]})]})}function I({zone:e}){let t="number"==typeof e.score,n="number"==typeof e.eta_min,r="number"==typeof e.distance_km?`${e.distance_km.toFixed(1)} km`:"Distance n/a",a=n?`${e.eta_min} min`:"ETA n/a",o=t?e.score.toFixed(2):"Score n/a",i=t?`${Math.min(100,Math.round(100*e.score))}%`:"0%",l="number"==typeof e.traffic_speed_idx?S(e.traffic_speed_idx):null;return(0,s.jsxs)("div",{className:"rounded-2xl border p-4",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-base font-semibold",children:[(0,s.jsx)(m.MapPin,{className:"h-4 w-4 text-primary"}),e.zone_name]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[r," | ",a," | ",o]}),l&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Traffic: ",l]})]}),(0,s.jsxs)(d.Button,{size:"sm",variant:"secondary",onClick:()=>{let t=encodeURIComponent(`${e.zone_name} Patna`);window.open(`https://www.google.com/maps/search/?api=1&query=${t}`,"_blank")},children:["Navigate",(0,s.jsx)(f,{className:"ml-1 h-3 w-3"})]})]}),(0,s.jsx)("div",{className:"mt-3 text-sm text-muted-foreground",children:e.reason}),(0,s.jsx)("div",{className:"mt-3 h-1.5 rounded-full bg-muted",children:(0,s.jsx)("div",{className:"h-full rounded-full bg-emerald-500",style:{width:i}})})]})}function S(e){return e>=.85?"Smooth":e>=.65?"Moderate":e>=.4?"Busy":"Heavy"}e.i(47167);var M=e.i(3303);let N="AIzaSyBmrEg7SfI6pHlfcoAhOBG5GbHXxFz9pqk";function k({currentLocation:e,recommendedZones:t}){let n=(0,i.useRef)(null),[r,a]=(0,i.useState)(!1),[o,l]=(0,i.useState)(null),[c,f]=(0,i.useState)(null),[m,p]=(0,i.useState)(null),[g,x]=(0,i.useState)(!1),h=(0,i.useRef)([]),y=(0,i.useRef)(null),b=(0,i.useMemo)(()=>(t??[]).filter(e=>"number"==typeof e.lat&&"number"==typeof e.lon),[t]),v=(0,i.useCallback)(()=>{navigator.geolocation?(x(!0),null!==y.current&&navigator.geolocation.clearWatch(y.current),y.current=navigator.geolocation.watchPosition(e=>{let t="number"==typeof e.coords.accuracy?e.coords.accuracy:null;if(!Number.isFinite(t)||null===t||t>200){p("Waiting for a precise GPS fix (move outdoors if possible)."),x(!1);return}f({lat:e.coords.latitude,lon:e.coords.longitude,accuracy:t}),p(null),x(!1)},e=>{x(!1),p(function(e){switch(e.code){case e.PERMISSION_DENIED:return"Location permission denied. Please enable location access in your browser settings.";case e.POSITION_UNAVAILABLE:return"GPS signal unavailable. Move outdoors for a clearer sky view.";case e.TIMEOUT:return"Timed out while fetching your location. Try again from an open area.";default:return"Unable to retrieve your location"}}(e))},{enableHighAccuracy:!0,maximumAge:0,timeout:15e3})):p("Geolocation is not supported by your browser")},[]);return(0,i.useEffect)(()=>(v(),()=>{null!==y.current&&navigator.geolocation&&navigator.geolocation.clearWatch(y.current)}),[v]),(0,i.useEffect)(()=>{if(!N||!r||o||!n.current)return;let t=window.google;if(!t?.maps)return;let a=e||c,s=a?{lat:a.lat,lng:a.lon}:{lat:25.617,lng:85.141},i=new t.maps.Map(n.current,{center:s,zoom:13,disableDefaultUI:!0}),u=new t.maps.TrafficLayer;return u.setMap(i),l(i),()=>{u.setMap(null)}},[r,o,e,c]),(0,i.useEffect)(()=>{if(!o)return;let t=window.google;if(!t?.maps)return;h.current.forEach(e=>e.setMap(null)),h.current=[];let n=new t.maps.LatLngBounds,r=!1,a=e||c;if(a){let e=new t.maps.Marker({map:o,position:{lat:a.lat,lng:a.lon},title:"You",icon:{path:t.maps.SymbolPath.CIRCLE,scale:7,fillColor:"#10b981",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2}});h.current.push(e),n.extend(e.getPosition()),r=!0,o.panTo(e.getPosition())}b.forEach((e,a)=>{let s=new t.maps.Marker({map:o,position:{lat:e.lat,lng:e.lon},label:`${a+1}`,title:e.zone_name});h.current.push(s),n.extend(s.getPosition()),r=!0}),r&&o.fitBounds(n,48)},[o,b,e,c]),(0,s.jsxs)(u.Card,{className:"shadow-sm",children:[(0,s.jsxs)(u.CardHeader,{className:"space-y-1",children:[(0,s.jsx)(u.CardTitle,{className:"text-base font-semibold",children:"Live map preview"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Browser geolocation + Google Maps traffic overlay (visual only)"})]}),(0,s.jsxs)(u.CardContent,{className:"space-y-3",children:[m&&(0,s.jsx)("div",{className:"rounded-lg bg-amber-50 px-3 py-2 text-xs text-amber-800",children:m}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(d.Button,{variant:"outline",size:"sm",onClick:v,disabled:g,children:g?"Requesting location...":"Use my current location"})}),(0,s.jsx)("div",{className:"h-64 w-full overflow-hidden rounded-2xl border",ref:n}),b.length>0?(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:b.slice(0,3).map((e,t)=>(0,s.jsxs)("div",{children:["#",t+1," ",e.zone_name,": ",e.eta_min.toFixed(1)," min,"," ",e.distance_km.toFixed(1)," km"]},e.zone_id))}):(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Start tracking to see nearby recommended zones on the map."})]}),(0,s.jsx)(M.default,{id:"google-maps-js",src:`https://maps.googleapis.com/maps/api/js?key=${N}&libraries=visualization`,strategy:"lazyOnload",onLoad:()=>a(!0)})]})}var D=e.i(46696);let E=[{type:"booking_received",label:"Got a Ride",variant:"default"},{type:"ride_started",label:"Ride Started",variant:"secondary"},{type:"ride_completed",label:"Ride Completed",variant:"outline"},{type:"booking_cancelled",label:"Booking Cancelled",variant:"ghost"}];function C({lastFix:e}){let[t,n]=(0,i.useState)("ola"),[r,a]=(0,i.useState)(null),[o,u]=(0,i.useState)(!1),f=c(e=>e.setIsDriving),m=(0,i.useMemo)(()=>e?`${e.lat.toFixed(4)}, ${e.lon.toFixed(4)}`:"No live GPS",[e]),p=async()=>{if(!r)return;u(!0);let n={event_type:r.type,platform:t};e&&("ride_completed"===r.type?(n.drop_lat=e.lat,n.drop_lon=e.lon):(n.pickup_lat=e.lat,n.pickup_lon=e.lon));let{error:s}=await (0,l.postRideEvent)(n);u(!1),a(null),s?D.toast.error(s.message):(D.toast.success(`${function(e){switch(e){case"booking_received":return"Booking";case"ride_started":return"Ride start";case"ride_completed":return"Ride completion";case"booking_cancelled":return"Cancellation";default:return"Event"}}(r.type)} logged`),function(e,t){switch(e){case"ride_started":t(!0);return;case"ride_completed":case"booking_cancelled":case"booking_received":t(!1);return;default:return}}(r.type,f))};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-2xl border bg-white/60 px-4 py-3 shadow-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase text-muted-foreground",children:"Current platform"}),(0,s.jsx)("div",{className:"mt-1 inline-flex gap-2 rounded-full bg-muted p-1",children:["ola","uber"].map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>n(e),className:`rounded-full px-3 py-1 text-xs font-semibold capitalize transition ${t===e?"bg-white text-foreground shadow":"text-muted-foreground"}`,children:e},e))})]}),(0,s.jsxs)("div",{className:"text-right text-xs text-muted-foreground",children:[(0,s.jsx)("p",{children:"Last fix"}),(0,s.jsx)("p",{className:"font-semibold text-foreground",children:m})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-3",children:E.map(e=>(0,s.jsx)(d.Button,{className:"booking_received"===e.type?"col-span-2 h-14 text-base":"h-12",variant:e.variant,onClick:()=>a(e),children:e.label},e.type))}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Your live location is only used to suggest better zones and calculate your performance. It stays private to you."}),r&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 pb-8",children:(0,s.jsxs)("div",{className:"w-full max-w-md rounded-3xl bg-bg p-5 shadow-2xl",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-muted-foreground",children:"Confirm action"}),(0,s.jsx)("h3",{className:"text-2xl font-semibold",children:r.label}),(0,s.jsxs)("p",{className:"mt-2 text-sm text-muted-foreground",children:["Platform: ",(0,s.jsx)("span",{className:"font-medium capitalize",children:t})]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Location: ",(0,s.jsx)("span",{className:"font-medium",children:m})]}),(0,s.jsxs)("div",{className:"mt-5 flex gap-3",children:[(0,s.jsx)(d.Button,{variant:"outline",className:"flex-1",onClick:()=>a(null),children:"Cancel"}),(0,s.jsx)(d.Button,{className:"flex-1",onClick:p,disabled:o,children:o?"Saving.":"Confirm"})]})]})})]})}var P=e.i(47163);function O({accuracy:e,trackingOn:t}){let n=t?"GPS: waiting for fix":"GPS: paused",r="bg-muted text-muted-foreground";if("number"==typeof e&&Number.isFinite(e)){let t=Math.max(0,Math.round(e));t<=30?(n=`GPS: ${t}m accuracy`,r="bg-emerald-100 text-emerald-900"):t<=100?(n=`GPS: ${t}m (ok)`,r="bg-amber-100 text-amber-900"):(n=`GPS: ${t}m (weak) - move outdoors`,r="bg-rose-100 text-rose-900")}else t&&(r="bg-muted text-muted-foreground");return(0,s.jsx)("div",{className:(0,P.cn)("inline-flex rounded-full px-3 py-1 text-xs font-semibold",r),children:n})}let L=(e,t)=>t.some(t=>e instanceof t),T=new WeakMap,B=new WeakMap,R=new WeakMap,A={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return T.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return z(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function z(e){if(e instanceof IDBRequest){let t;return t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{t(z(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",a),e.addEventListener("error",s)}),R.set(t,e),t}if(B.has(e))return B.get(e);let r=function(e){if("function"==typeof e)return(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(F(this),t),z(this.request)}:function(...t){return z(e.apply(F(this),t))};return(e instanceof IDBTransaction&&function(e){if(T.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});T.set(e,t)}(e),L(e,t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,A):e}(e);return r!==e&&(B.set(e,r),R.set(r,e)),r}let F=e=>R.get(e),q=["get","getKey","getAll","getAllKeys","count"],$=["put","add","delete","clear"],H=new Map;function G(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(H.get(t))return H.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,a=$.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(a||q.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,a?"readwrite":"readonly"),o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),a&&s.done]))[0]};return H.set(t,s),s}A={...r=A,get:(e,t,n)=>G(e,t)||r.get(e,t,n),has:(e,t)=>!!G(e,t)||r.has(e,t)};let W=["continue","continuePrimaryKey","advance"],U={},X=new WeakMap,Y=new WeakMap,V={get(e,t){if(!W.includes(t))return e[t];let n=U[t];return n||(n=U[t]=function(...e){X.set(this,Y.get(this)[t](...e))}),n}};async function*K(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let n=new Proxy(t,V);for(Y.set(n,t),R.set(n,F(t));t;)yield n,t=await (X.get(n)||t.continue()),X.delete(n)}function J(e,t){return t===Symbol.asyncIterator&&L(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&L(e,[IDBIndex,IDBObjectStore])}A={...a=A,get:(e,t,n)=>J(e,t)?K:a.get(e,t,n),has:(e,t)=>J(e,t)||a.has(e,t)};let Z="events";async function Q(){return function(e,t,{blocked:n,upgrade:r,blocking:a,terminated:s}={}){let o=indexedDB.open(e,1),i=z(o);return r&&o.addEventListener("upgradeneeded",e=>{r(z(o.result),e.oldVersion,e.newVersion,z(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),i.then(e=>{s&&e.addEventListener("close",()=>s()),a&&e.addEventListener("versionchange",e=>a(e.oldVersion,e.newVersion,e))}).catch(()=>{}),i}("ride-db",0,{upgrade(e){e.createObjectStore(Z,{keyPath:"id",autoIncrement:!0})}})}async function ee(e){(await Q()).add(Z,{...e,created_at:Date.now()})}let et=(0,e.i(20755).createBrowserSupabaseClient)();var en=e.i(1559);function er(){let e,t,n,r,a,u,d,f,m,p,g,x,h,y,b,v,w,j,I,S,M,N,E,P=(e=c(e=>e.trackingOn),t=c(e=>e.permissionStatus),n=c(e=>e.lastFix),r=c(e=>e.lastPingAt),a=c(e=>e.lastRecommendation),u=c(e=>e.error),d=c(e=>e.autoStartPending),f=c(e=>e.setTrackingOn),m=c(e=>e.setPermissionStatus),p=c(e=>e.setLastFix),g=c(e=>e.setLastPingAt),x=c(e=>e.setRecommendation),h=c(e=>e.setError),y=c(e=>e.setAutoStartPending),b=(0,i.useRef)(null),v=(0,i.useRef)(0),w=(0,i.useRef)(null),j=(0,i.useCallback)(async()=>{try{if(navigator.permissions?.query){let e=await navigator.permissions.query({name:"geolocation"});m(e.state),e.onchange=()=>m(e.state)}else m("unsupported")}catch(e){console.warn("permission query failed",e),m("unsupported")}},[m]),(0,i.useEffect)(()=>{j()},[j]),I=(0,i.useCallback)(()=>{null!==b.current&&"undefined"!=typeof navigator&&navigator.geolocation&&(navigator.geolocation.clearWatch(b.current),b.current=null)},[]),S=(0,i.useCallback)((e,t)=>{g(t),e&&x(e),h(null)},[g,x,h]),M=(0,i.useCallback)(async e=>{var t,n;let r,a,s,o,i,c="number"==typeof e.coords.accuracy?e.coords.accuracy:null;if(!Number.isFinite(c)||null===c||c>200)return void h("GPS accuracy is weak (>200m). Move outdoors for a clear fix.");let u="number"==typeof e.coords.speed&&Number.isFinite(e.coords.speed)?3.6*e.coords.speed:null;p({lat:e.coords.latitude,lon:e.coords.longitude,accuracy:c,speed:u,timestamp:e.timestamp}),h(null);let d=Date.now(),f=w.current,m=!1;if(f&&"number"==typeof f.coords.accuracy&&Number.isFinite(f.coords.accuracy)&&(m=c<=.5*f.coords.accuracy),f&&30>(t=f.coords,n=e.coords,r=t.latitude*Math.PI/180,s=(a=n.latitude*Math.PI/180)-r,2*Math.atan2(Math.sqrt(i=Math.sin(s/2)*Math.sin(s/2)+Math.cos(r)*Math.cos(a)*Math.sin((o=(n.longitude-t.longitude)*Math.PI/180)/2)*Math.sin(o/2)),Math.sqrt(1-i))*6371e3)&&d-v.current<5e3&&!m)return;w.current=e,v.current=d;let g={lat:e.coords.latitude,lon:e.coords.longitude,ts:new Date(e.timestamp).toISOString(),accuracy_m:c,speed_kmh:u??void 0},{data:x,error:y}=await (0,l.postPing)(g);if(y){h(y.message),await ee(g),D.toast.error("Could not sync live location. We'll retry soon.");return}S(x?.recommendation??null,g.ts??new Date().toISOString())},[p,S,h]),N=(0,i.useCallback)(async()=>{try{let{state:e}=await navigator.permissions.query({name:"geolocation"});if(m(e),"denied"===e)return D.toast.error("Location permission denied. Enable it in browser settings."),!1;return"prompt"===e&&(await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),m("granted")),!0}catch(e){return console.error("permission request failed",e),m("unsupported"),!1}},[m]),E=(0,i.useCallback)(async()=>{if(e){I(),f(!1);return}await N()?f(!0):h("Location permission required for live tracking")},[e,N,I,f,h]),(0,i.useEffect)(()=>{!e&&d&&(E(),y(!1))},[e,d,E,y]),(0,i.useEffect)(()=>{if(!e)return void I();if("undefined"==typeof navigator||!navigator.geolocation){h("Geolocation is not supported in this browser."),D.toast.error("Geolocation is not available on this device."),f(!1);return}return b.current=navigator.geolocation.watchPosition(e=>M(e),e=>{console.error("watchPosition error",e);let t=function(e){switch(e.code){case e.PERMISSION_DENIED:return"Location permission denied. Enable it in your browser settings.";case e.POSITION_UNAVAILABLE:return"GPS signal unavailable. Move outdoors for a clear view of the sky.";case e.TIMEOUT:return"Timed out while waiting for GPS. Try again from an open area.";default:return e.message||"Unable to determine your location."}}(e);h(t),e.code===e.PERMISSION_DENIED?(f(!1),m("denied"),D.toast.error("Permission denied. Please re-enable location access.")):D.toast.error(t)},{enableHighAccuracy:!0,maximumAge:0,timeout:15e3}),()=>I()},[e,M,I,h,f,m]),(0,i.useEffect)(()=>{function e(){h(null)}return window.addEventListener("online",e),()=>window.removeEventListener("online",e)},[h]),{trackingOn:e,permissionStatus:t,lastFix:n,lastPingAt:r,lastRecommendation:a,error:u,toggleTracking:E}),L=function(){let[e,t]=(0,i.useState)(null);return(0,i.useEffect)(()=>{let e=!0;return async function(){let{data:{user:n}}=await et.auth.getUser();if(!n)return;let{data:r}=await et.from("profiles").select("id,full_name").eq("id",n.id).maybeSingle();e&&t({id:n.id,full_name:r?.full_name??n.user_metadata?.full_name??null})}(),()=>{e=!1}},[]),e}(),{stats:T}=(0,en.useTodayStats)(),B=L?.full_name?`Hi, ${L.full_name.split(" ")[0]}`:"Hi driver",R=`Today | ${T.totalTrips} trips | ?${T.totalEarnings.toFixed(0)}`;return(0,s.jsx)(o.DriverShell,{title:B,subtitle:R,children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:(0,s.jsx)("div",{className:"flex flex-col items-start gap-2 sm:items-end",children:(0,s.jsx)(O,{trackingOn:P.trackingOn,accuracy:P.lastFix?.accuracy??null})})}),(0,s.jsx)(_,{trackingOn:P.trackingOn,seedRecommendation:P.lastRecommendation}),(0,s.jsx)(k,{currentLocation:P.lastFix,recommendedZones:P.lastRecommendation?.top??null}),(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Ride actions"}),(0,s.jsx)(C,{lastFix:P.lastFix})]})]})})}e.s(["default",()=>er],54949)}]);