(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46897,e=>{"use strict";let t=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},85424,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(75254);let s=(0,a.default)("car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);var n=e.i(46897);let i=(0,a.default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);var l=e.i(67881),o=e.i(70065),c=e.i(23750),d=e.i(57801),u=e.i(47163);function m({label:e,variant:r="default",className:a}){return(0,t.jsx)("span",{className:(0,u.cn)("inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",{default:"bg-muted text-muted-foreground",success:"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400",warning:"bg-amber-100 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400"}[r],a),children:e})}var g=e.i(4421),x=e.i(15940);async function p(e){let{data:{session:t}}=await x.supabase.auth.getSession();if(!t)return console.error("[sendRideEvent] No session; user must be logged in."),{ok:!1,error:"UNAUTHORIZED"};try{let{data:t,error:r}=await x.supabase.functions.invoke("ingest_ride_event",{body:e});if(r)return console.error("[sendRideEvent] Supabase function error:",r),{ok:!1,error:r.message??"FUNCTION_ERROR"};return console.log("[sendRideEvent] Success:",t),{ok:!0,data:t}}catch(e){return console.error("[sendRideEvent] Unexpected error:",e),{ok:!1,error:e?.message??"UNKNOWN_ERROR"}}}var h=e.i(18566),b=e.i(46696);async function f(){return new Promise(e=>navigator.geolocation.getCurrentPosition(t=>e({lat:t.coords.latitude,lon:t.coords.longitude}),()=>e({lat:null,lon:null}),{enableHighAccuracy:!0,maximumAge:5e3,timeout:1e4}))}async function v(e,t){let r=await f();return(await p({event_type:e,occurred_at:new Date().toISOString(),battery_pct:t,...r})).ok}function y(){let[e,a]=(0,r.useState)("seeking"),[u,x]=(0,r.useState)(!1),p=(0,g.useAppStore)(e=>e.battery);(0,h.useRouter)();let f=(0,g.useAppStore)(e=>e.setBattery),y=async(e,t)=>{x(!0);try{await v(e,p)?(b.toast.success("Event recorded successfully!"),a(t)):b.toast.error("Failed to record event. Saved offline.")}catch(e){b.toast.error("An error occurred")}finally{x(!1)}};return(0,t.jsx)(d.PageShell,{children:(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[(0,t.jsxs)(o.Card,{className:"shadow-md",children:[(0,t.jsxs)(o.CardHeader,{children:[(0,t.jsxs)(o.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(s,{className:"h-6 w-6 text-primary"}),"Patna EV Co-Pilot"]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["seeking"===e&&"Ready for your next ride","booked"===e&&"Booking confirmed","ontrip"===e&&"Trip in progress"]})]}),(0,t.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Battery Level (Optional)"}),(0,t.jsx)(c.Input,{type:"number",min:"0",max:"100",placeholder:"e.g. 75",value:p||"",onChange:e=>f(e.target.value?Number(e.target.value):null),className:"text-center text-lg"})]}),"seeking"===e&&(0,t.jsx)(l.Button,{size:"lg",className:"w-full h-14 text-lg",onClick:()=>y("booking_received","booked"),disabled:u,children:"Got a Ride"}),"booked"===e&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsx)(l.Button,{size:"lg",onClick:()=>y("ride_started","ontrip"),disabled:u,className:"h-14",children:"Start Trip"}),(0,t.jsx)(l.Button,{size:"lg",variant:"outline",onClick:()=>y("booking_cancelled","seeking"),disabled:u,className:"h-14",children:"Cancel"})]}),"ontrip"===e&&(0,t.jsx)(l.Button,{size:"lg",className:"w-full h-14 text-lg",onClick:()=>y("ride_completed","seeking"),disabled:u,children:"End Trip"})]})]}),(0,t.jsxs)(o.Card,{children:[(0,t.jsx)(o.CardHeader,{children:(0,t.jsxs)(o.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,t.jsx)(i,{className:"h-5 w-5"}),"Recommended Zones"]})}),(0,t.jsx)(o.CardContent,{className:"space-y-3",children:[{name:"Airport",reason:"High demand",variant:"success"},{name:"P&M Mall",reason:"Event nearby",variant:"warning"},{name:"Patna Junction",reason:"Popular now",variant:"default"}].map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.MapPin,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium",children:e.name})]}),(0,t.jsx)(m,{label:e.reason,variant:e.variant})]},e.name))})]})]})})}e.s(["default",()=>y],85424)}]);