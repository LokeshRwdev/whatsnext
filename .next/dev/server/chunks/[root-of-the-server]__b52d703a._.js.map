{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/api-respond.ts"],"sourcesContent":["export type ApiErrorPayload = {\n  error: {\n    code: string;\n    message: string;\n    details?: unknown;\n  };\n};\n\nexport class HttpError extends Error {\n  code: string;\n  status: number;\n  details?: unknown;\n\n  constructor(status: number, code: string, message: string, details?: unknown) {\n    super(message);\n    this.status = status;\n    this.code = code;\n    this.details = details;\n  }\n}\n\nexport function ok<T>(data: T, status: number = 200) {\n  return Response.json(data, { status });\n}\n\nexport function bad(\n  message: string,\n  details?: unknown,\n  status: number = 400,\n  code?: string\n) {\n  const resolvedCode =\n    code ?? (status >= 500 ? \"INTERNAL_ERROR\" : \"BAD_REQUEST\");\n\n  return Response.json(\n    {\n      error: {\n        code: resolvedCode,\n        message,\n        details,\n      },\n    } satisfies ApiErrorPayload,\n    { status }\n  );\n}\n\nexport function handleRouteError(err: unknown) {\n  if (err instanceof HttpError) {\n    return bad(err.message, err.details, err.status, err.code);\n  }\n\n  if (err instanceof Error) {\n    return bad(err.message, null, 500, \"INTERNAL_ERROR\");\n  }\n\n  return bad(\"Internal error\", null, 500, \"INTERNAL_ERROR\");\n}\n"],"names":[],"mappings":";;;;;;;;;;AAQO,MAAM,kBAAkB;IAC7B,KAAa;IACb,OAAe;IACf,QAAkB;IAElB,YAAY,MAAc,EAAE,IAAY,EAAE,OAAe,EAAE,OAAiB,CAAE;QAC5E,KAAK,CAAC;QACN,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,OAAO,GAAG;IACjB;AACF;AAEO,SAAS,GAAM,IAAO,EAAE,SAAiB,GAAG;IACjD,OAAO,SAAS,IAAI,CAAC,MAAM;QAAE;IAAO;AACtC;AAEO,SAAS,IACd,OAAe,EACf,OAAiB,EACjB,SAAiB,GAAG,EACpB,IAAa;IAEb,MAAM,eACJ,QAAQ,CAAC,UAAU,MAAM,mBAAmB,aAAa;IAE3D,OAAO,SAAS,IAAI,CAClB;QACE,OAAO;YACL,MAAM;YACN;YACA;QACF;IACF,GACA;QAAE;IAAO;AAEb;AAEO,SAAS,iBAAiB,GAAY;IAC3C,IAAI,eAAe,WAAW;QAC5B,OAAO,IAAI,IAAI,OAAO,EAAE,IAAI,OAAO,EAAE,IAAI,MAAM,EAAE,IAAI,IAAI;IAC3D;IAEA,IAAI,eAAe,OAAO;QACxB,OAAO,IAAI,IAAI,OAAO,EAAE,MAAM,KAAK;IACrC;IAEA,OAAO,IAAI,kBAAkB,MAAM,KAAK;AAC1C","debugId":null}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/supabase/config.ts"],"sourcesContent":["const isServer = () => typeof window === \"undefined\";\n\n/**\n * Next.js only inlines environment variables when they are referenced with static keys.\n * Avoid dynamic lookups (e.g. process.env[key]) because they are stripped from the client bundle\n * and will always be undefined in the browser.\n */\nexport function getSupabaseConfig() {\n  const serverUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const serverAnonKey =\n    process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  const url = isServer() ? serverUrl : process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const anonKey = isServer() ? serverAnonKey : process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  if (!url) {\n    throw new Error(\"Missing SUPABASE_URL/NEXT_PUBLIC_SUPABASE_URL environment variable\");\n  }\n  if (!anonKey) {\n    throw new Error(\"Missing SUPABASE_ANON_KEY/NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable\");\n  }\n\n  return { url, anonKey };\n}\n"],"names":[],"mappings":";;;;AAAA,MAAM,WAAW,IAAM,kDAAkB;AAOlC,SAAS;IACd,MAAM,YAAY,QAAQ,GAAG,CAAC,YAAY;IAC1C,MAAM,gBACJ,QAAQ,GAAG,CAAC,iBAAiB;IAE/B,MAAM,MAAM,aAAa,YAAY;IACrC,MAAM,UAAU,aAAa,gBAAgB;IAE7C;;IAGA;;IAIA,OAAO;QAAE;QAAK;IAAQ;AACxB","debugId":null}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport type { SupabaseClient, User as SupabaseUser } from \"@supabase/supabase-js\";\nimport { cookies } from \"next/headers\";\nimport { getSupabaseConfig } from \"./config\";\nimport type { AppUser, DriverProfile } from \"./types\";\n\nexport type { AppUser, DriverProfile } from \"./types\";\n\nfunction mapUser(user: SupabaseUser | null): AppUser | null {\n  if (!user) return null;\n  return {\n    id: user.id,\n    email: user.email ?? null,\n    fullName: (user.user_metadata as Record<string, any> | null)?.full_name ?? null,\n  };\n}\n\nexport async function createServerSupabaseClient() {\n  const { url, anonKey } = getSupabaseConfig();\n  const cookieStore = await cookies();\n\n  const supabase = createServerClient(url, anonKey, {\n    cookies: {\n      get(name: string) {\n        return cookieStore.get(name)?.value;\n      },\n      set(name: string, value: string, options: any) {\n        const mutableStore = cookieStore as unknown as {\n          set?: (options: { name: string; value: string } & Record<string, any>) => void;\n        };\n        mutableStore.set?.({ name, value, ...options });\n      },\n      remove(name: string, options: any) {\n        const mutableStore = cookieStore as unknown as {\n          set?: (options: { name: string; value: string } & Record<string, any>) => void;\n        };\n        mutableStore.set?.({ name, value: \"\", ...options, maxAge: 0 });\n      },\n    },\n  });\n\n  const {\n    data: { user },\n    error,\n  } = await supabase.auth.getUser();\n\n  if (error && error.message !== \"Auth session missing!\") {\n    console.warn(\"[supabase] auth.getUser failed\", error);\n  }\n\n  return {\n    supabase,\n    user: mapUser(user),\n  };\n}\n\nexport async function loadProfile(supabase: SupabaseClient, userId: string) {\n  const { data, error } = await supabase\n    .from(\"profiles\")\n    .select(\"id,full_name,created_at\")\n    .eq(\"id\", userId)\n    .maybeSingle();\n\n  if (error && error.code !== \"PGRST116\") {\n    console.warn(\"[supabase] failed to load profile\", { userId, error });\n    return null;\n  }\n\n  return (data ?? null) as DriverProfile | null;\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;AACA;;;;AAKA,SAAS,QAAQ,IAAyB;IACxC,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO;QACL,IAAI,KAAK,EAAE;QACX,OAAO,KAAK,KAAK,IAAI;QACrB,UAAU,AAAC,KAAK,aAAa,EAAiC,aAAa;IAC7E;AACF;AAEO,eAAe;IACpB,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,IAAA,gJAAiB;IAC1C,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,MAAM,WAAW,IAAA,iMAAkB,EAAC,KAAK,SAAS;QAChD,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,YAAY,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAY;gBAC3C,MAAM,eAAe;gBAGrB,aAAa,GAAG,GAAG;oBAAE;oBAAM;oBAAO,GAAG,OAAO;gBAAC;YAC/C;YACA,QAAO,IAAY,EAAE,OAAY;gBAC/B,MAAM,eAAe;gBAGrB,aAAa,GAAG,GAAG;oBAAE;oBAAM,OAAO;oBAAI,GAAG,OAAO;oBAAE,QAAQ;gBAAE;YAC9D;QACF;IACF;IAEA,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACd,KAAK,EACN,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,SAAS,MAAM,OAAO,KAAK,yBAAyB;QACtD,QAAQ,IAAI,CAAC,kCAAkC;IACjD;IAEA,OAAO;QACL;QACA,MAAM,QAAQ;IAChB;AACF;AAEO,eAAe,YAAY,QAAwB,EAAE,MAAc;IACxE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC,2BACP,EAAE,CAAC,MAAM,QACT,WAAW;IAEd,IAAI,SAAS,MAAM,IAAI,KAAK,YAAY;QACtC,QAAQ,IAAI,CAAC,qCAAqC;YAAE;YAAQ;QAAM;QAClE,OAAO;IACT;IAEA,OAAQ,QAAQ;AAClB","debugId":null}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/app/api/driver-state/route.ts"],"sourcesContent":["import { ok, bad } from \"@/lib/api-respond\";\nimport { createServerSupabaseClient } from \"@/lib/supabase/server\";\n\ntype DriverStateRow = {\n  driver_id: string;\n  last_ping_at: string | null;\n  lat: number | null;\n  lon: number | null;\n  snapped_zone_id: number | null;\n  speed_kmh: number | null;\n  battery_pct: number | null;\n  recommendation: Record<string, unknown> | null;\n  updated_at: string | null;\n};\n\nexport async function GET() {\n  let userId: string | null = null;\n  try {\n    const { supabase, user } = await createServerSupabaseClient();\n\n    if (!user) {\n      return bad(\"Please sign in\", null, 401, \"UNAUTHENTICATED\");\n    }\n\n    userId = user.id;\n\n    const {\n      data,\n      error,\n      status,\n    } = await supabase\n      .from(\"driver_state\")\n      .select(\n        \"driver_id,last_ping_at,lat,lon,snapped_zone_id,speed_kmh,battery_pct,recommendation,updated_at\"\n      )\n      // driver_state rows are keyed by driver_id via RLS (auth.uid())\n      .eq(\"driver_id\", user.id)\n      .maybeSingle();\n\n    if (error) {\n      if (status === 401) {\n        return bad(\"Please sign in\", null, 401, \"UNAUTHENTICATED\");\n      }\n\n      if (status === 403) {\n        return bad(\"Forbidden\", null, 403, \"FORBIDDEN\");\n      }\n\n      console.error(\"[driver-state] supabase query failed\", {\n        userId,\n        status,\n        error,\n      });\n      return bad(\"Failed to fetch driver state\", null, 500, \"DB_ERROR\");\n    }\n\n    if (!data) {\n      return ok(null);\n    }\n\n    const row = data as DriverStateRow;\n\n    return ok({\n      driver_id: row.driver_id,\n      last_ping_at: row.last_ping_at,\n      snapped_zone: row.snapped_zone_id,\n      snapped_zone_id: row.snapped_zone_id,\n      lat: row.lat,\n      lon: row.lon,\n      speed_kmh: row.speed_kmh,\n      battery_pct: row.battery_pct,\n      recommendation: row.recommendation,\n      updated_at: row.updated_at,\n    });\n  } catch (error) {\n    console.error(\"GET /api/driver-state failed\", { userId, error });\n    return bad(\"Failed to fetch driver state\", null, 500, \"DB_ERROR\");\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAcO,eAAe;IACpB,IAAI,SAAwB;IAC5B,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,yJAA0B;QAE3D,IAAI,CAAC,MAAM;YACT,OAAO,IAAA,8HAAG,EAAC,kBAAkB,MAAM,KAAK;QAC1C;QAEA,SAAS,KAAK,EAAE;QAEhB,MAAM,EACJ,IAAI,EACJ,KAAK,EACL,MAAM,EACP,GAAG,MAAM,SACP,IAAI,CAAC,gBACL,MAAM,CACL,iGAEF,gEAAgE;SAC/D,EAAE,CAAC,aAAa,KAAK,EAAE,EACvB,WAAW;QAEd,IAAI,OAAO;YACT,IAAI,WAAW,KAAK;gBAClB,OAAO,IAAA,8HAAG,EAAC,kBAAkB,MAAM,KAAK;YAC1C;YAEA,IAAI,WAAW,KAAK;gBAClB,OAAO,IAAA,8HAAG,EAAC,aAAa,MAAM,KAAK;YACrC;YAEA,QAAQ,KAAK,CAAC,wCAAwC;gBACpD;gBACA;gBACA;YACF;YACA,OAAO,IAAA,8HAAG,EAAC,gCAAgC,MAAM,KAAK;QACxD;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,IAAA,6HAAE,EAAC;QACZ;QAEA,MAAM,MAAM;QAEZ,OAAO,IAAA,6HAAE,EAAC;YACR,WAAW,IAAI,SAAS;YACxB,cAAc,IAAI,YAAY;YAC9B,cAAc,IAAI,eAAe;YACjC,iBAAiB,IAAI,eAAe;YACpC,KAAK,IAAI,GAAG;YACZ,KAAK,IAAI,GAAG;YACZ,WAAW,IAAI,SAAS;YACxB,aAAa,IAAI,WAAW;YAC5B,gBAAgB,IAAI,cAAc;YAClC,YAAY,IAAI,UAAU;QAC5B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;YAAE;YAAQ;QAAM;QAC9D,OAAO,IAAA,8HAAG,EAAC,gCAAgC,MAAM,KAAK;IACxD;AACF","debugId":null}}]
}