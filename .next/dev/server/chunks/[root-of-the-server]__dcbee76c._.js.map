{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/api-respond.ts"],"sourcesContent":["export type ApiErrorPayload = {\n  error: {\n    code: string;\n    message: string;\n    details?: unknown;\n  };\n};\n\nexport class HttpError extends Error {\n  code: string;\n  status: number;\n  details?: unknown;\n\n  constructor(status: number, code: string, message: string, details?: unknown) {\n    super(message);\n    this.status = status;\n    this.code = code;\n    this.details = details;\n  }\n}\n\nexport function ok<T>(data: T, status: number = 200) {\n  return Response.json(data, { status });\n}\n\nexport function bad(\n  message: string,\n  details?: unknown,\n  status: number = 400,\n  code?: string\n) {\n  const resolvedCode =\n    code ?? (status >= 500 ? \"INTERNAL_ERROR\" : \"BAD_REQUEST\");\n\n  return Response.json(\n    {\n      error: {\n        code: resolvedCode,\n        message,\n        details,\n      },\n    } satisfies ApiErrorPayload,\n    { status }\n  );\n}\n\nexport function handleRouteError(err: unknown) {\n  if (err instanceof HttpError) {\n    return bad(err.message, err.details, err.status, err.code);\n  }\n\n  if (err instanceof Error) {\n    return bad(err.message, null, 500, \"INTERNAL_ERROR\");\n  }\n\n  return bad(\"Internal error\", null, 500, \"INTERNAL_ERROR\");\n}\n"],"names":[],"mappings":";;;;;;;;;;AAQO,MAAM,kBAAkB;IAC7B,KAAa;IACb,OAAe;IACf,QAAkB;IAElB,YAAY,MAAc,EAAE,IAAY,EAAE,OAAe,EAAE,OAAiB,CAAE;QAC5E,KAAK,CAAC;QACN,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,OAAO,GAAG;IACjB;AACF;AAEO,SAAS,GAAM,IAAO,EAAE,SAAiB,GAAG;IACjD,OAAO,SAAS,IAAI,CAAC,MAAM;QAAE;IAAO;AACtC;AAEO,SAAS,IACd,OAAe,EACf,OAAiB,EACjB,SAAiB,GAAG,EACpB,IAAa;IAEb,MAAM,eACJ,QAAQ,CAAC,UAAU,MAAM,mBAAmB,aAAa;IAE3D,OAAO,SAAS,IAAI,CAClB;QACE,OAAO;YACL,MAAM;YACN;YACA;QACF;IACF,GACA;QAAE;IAAO;AAEb;AAEO,SAAS,iBAAiB,GAAY;IAC3C,IAAI,eAAe,WAAW;QAC5B,OAAO,IAAI,IAAI,OAAO,EAAE,IAAI,OAAO,EAAE,IAAI,MAAM,EAAE,IAAI,IAAI;IAC3D;IAEA,IAAI,eAAe,OAAO;QACxB,OAAO,IAAI,IAAI,OAAO,EAAE,MAAM,KAAK;IACrC;IAEA,OAAO,IAAI,kBAAkB,MAAM,KAAK;AAC1C","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/zod-schemas.ts"],"sourcesContent":["import { z } from \"zod\";\r\nimport { extendZodWithOpenApi, OpenAPIRegistry } from \"@asteasolutions/zod-to-openapi\";\r\n\r\nextendZodWithOpenApi(z);\r\n\r\n// Initialize OpenAPI Registry\r\nexport const registry = new OpenAPIRegistry();\r\n\r\n// ===== Base Schemas =====\r\n\r\nexport const ApiErrorSchema = z.object({\r\n  error: z.string(),\r\n  details: z.any().optional(),\r\n});\r\n\r\nexport const HealthSchema = z.object({\r\n  ok: z.boolean(),\r\n  time: z.string().datetime(),\r\n});\r\n\r\n// ===== Event Types =====\r\nexport const RideEventTypeSchema = z.enum([\r\n  \"booking_received\",\r\n  \"ride_started\",\r\n  \"ride_completed\",\r\n  \"booking_cancelled\",\r\n]);\r\n\r\nexport const PlatformSchema = z.enum([\"ola\", \"uber\"]);\r\n\r\nexport const CancelReasonSchema = z.enum([\"driver\", \"rider\", \"platform\"]);\r\n\r\n// ===== Entity Schemas =====\r\n\r\nexport const ZoneSchema = z.object({\r\n  id: z.string().uuid(),\r\n  name: z.string(),\r\n  geohash6: z.string().nullable(),\r\n  is_airport: z.boolean(),\r\n  is_charger: z.boolean(),\r\n  meta: z.record(z.any()).nullable(),\r\n});\r\n\r\nexport const RideEventSchema = z.object({\r\n  id: z.string().uuid(),\r\n  driver_id: z.string().uuid(),\r\n  event_type: RideEventTypeSchema,\r\n  occurred_at: z.string().datetime(),\r\n  zone_id: z.string().uuid().nullable(),\r\n  geohash6: z.string().nullable(),\r\n  battery_pct: z.number().min(0).max(100).nullable(),\r\n  created_at: z.string().datetime(),\r\n});\r\n\r\nexport const ZoneVisitSchema = z.object({\r\n  id: z.string().uuid(),\r\n  driver_id: z.string().uuid(),\r\n  zone_id: z.string().uuid(),\r\n  arrived_at: z.string().datetime(),\r\n  left_at: z.string().datetime().nullable(),\r\n  context: z.record(z.any()).nullable(),\r\n  created_at: z.string().datetime(),\r\n});\r\n\r\nexport const PingSchema = z.object({\r\n  id: z.string().uuid(),\r\n  driver_id: z.string().uuid(),\r\n  ts: z.string().datetime(),\r\n  lat: z.number(),\r\n  lon: z.number(),\r\n  speed_kmh: z.number().nullable(),\r\n  battery_pct: z.number().min(0).max(100).nullable(),\r\n  created_at: z.string().datetime(),\r\n});\r\n\r\nexport const ChargeSchema = z.object({\r\n  id: z.string().uuid(),\r\n  driver_id: z.string().uuid(),\r\n  station_zone: z.string().uuid().nullable(),\r\n  start_at: z.string().datetime(),\r\n  end_at: z.string().datetime().nullable(),\r\n  kwh: z.number().nullable(),\r\n  cost_inr: z.number().nullable(),\r\n  created_at: z.string().datetime(),\r\n});\r\n\r\nexport const CityEventSchema = z.object({\r\n  id: z.string().uuid(),\r\n  name: z.string(),\r\n  category: z.string().nullable(),\r\n  venue_zone: z.string().uuid(),\r\n  start_at: z.string().datetime(),\r\n  end_at: z.string().datetime(),\r\n  impact_score: z.number().nullable(),\r\n  created_at: z.string().datetime(),\r\n});\r\n\r\n// ===== Request Schemas =====\r\n\r\nexport const CreateRideEventReq = z.object({\r\n  event_type: RideEventTypeSchema,\r\n  occurred_at: z.string().datetime().optional(),\r\n  lat: z.number().nullable().optional(),\r\n  lon: z.number().nullable().optional(),\r\n  battery_pct: z.number().min(0).max(100).nullable().optional(),\r\n});\r\n\r\nexport const RideEventIngestSchema = z\r\n  .object({\r\n    event_type: RideEventTypeSchema,\r\n    occurred_at: z.string().datetime().optional(),\r\n    platform: PlatformSchema.optional(),\r\n    fare_inr: z.number().min(0).optional(),\r\n    distance_km: z.number().min(0).optional(),\r\n    pickup_lat: z.number().min(-90).max(90).optional(),\r\n    pickup_lon: z.number().min(-180).max(180).optional(),\r\n    drop_lat: z.number().min(-90).max(90).optional(),\r\n    drop_lon: z.number().min(-180).max(180).optional(),\r\n    surge_multiplier: z.number().min(0).max(10).optional(),\r\n    promo_code: z.string().max(64).optional(),\r\n    cancel_reason: CancelReasonSchema.optional(),\r\n    deadhead_distance_km: z.number().min(0).max(200).optional(),\r\n    deadhead_time_min: z.number().min(0).max(600).optional(),\r\n  })\r\n  .refine(\r\n    (data) =>\r\n      (data.pickup_lat === undefined && data.pickup_lon === undefined) ||\r\n      (data.pickup_lat !== undefined && data.pickup_lon !== undefined),\r\n    {\r\n      message: \"pickup_lat and pickup_lon must be provided together\",\r\n      path: [\"pickup_lat\"],\r\n    }\r\n  )\r\n  .refine(\r\n    (data) =>\r\n      (data.drop_lat === undefined && data.drop_lon === undefined) ||\r\n      (data.drop_lat !== undefined && data.drop_lon !== undefined),\r\n    {\r\n      message: \"drop_lat and drop_lon must be provided together\",\r\n      path: [\"drop_lat\"],\r\n    }\r\n  )\r\n  .refine(\r\n    (data) =>\r\n      data.event_type !== \"booking_cancelled\" || data.cancel_reason !== undefined,\r\n    {\r\n      message: \"cancel_reason required for booking_cancelled events\",\r\n      path: [\"cancel_reason\"],\r\n    }\r\n  );\r\n\r\nexport const TripSyncReq = z.object({\r\n  booking_at: z.string().datetime().optional(),\r\n  pickup_at: z.string().datetime(),\r\n  drop_at: z.string().datetime(),\r\n  pickup_lat: z.number().min(-90).max(90),\r\n  pickup_lon: z.number().min(-180).max(180),\r\n  drop_lat: z.number().min(-90).max(90),\r\n  drop_lon: z.number().min(-180).max(180),\r\n  distance_km: z.number().min(0),\r\n  fare_inr: z.number().min(0),\r\n  platform: PlatformSchema,\r\n  surge_multiplier: z.number().min(0).max(10).optional(),\r\n  promo_code: z.string().max(64).optional(),\r\n  deadhead_km: z.number().min(0).max(200).optional(),\r\n  deadhead_min: z.number().min(0).max(600).optional(),\r\n  tip_inr: z.number().min(0).optional(),\r\n});\r\n\r\nexport const OpsDailyUpsertReq = z.object({\r\n  day: z\r\n    .string()\r\n    .regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"day must be YYYY-MM-DD\")\r\n    .optional(),\r\n  platforms: z.array(PlatformSchema).min(1).optional(),\r\n  idle_minutes: z.number().int().min(0).optional(),\r\n  fuel_litres: z.number().min(0).optional(),\r\n  fuel_cost_inr: z.number().min(0).optional(),\r\n  energy_kwh: z.number().min(0).optional(),\r\n  energy_cost_inr: z.number().min(0).optional(),\r\n  tolls_parking_inr: z.number().min(0).optional(),\r\n  notes: z.string().max(512).optional(),\r\n});\r\n\r\nexport type RideEventIngestInput = z.infer<typeof RideEventIngestSchema>;\r\nexport type TripSyncInput = z.infer<typeof TripSyncReq>;\r\nexport type OpsDailyUpsertInput = z.infer<typeof OpsDailyUpsertReq>;\r\n\r\nexport const CreateZoneVisitReq = z.object({\r\n  zone_id: z.string().uuid(),\r\n  arrived_at: z.string().datetime().optional(),\r\n  context: z.record(z.any()).optional(),\r\n});\r\n\r\nexport const UpdateZoneVisitReq = z.object({\r\n  left_at: z.string().datetime(),\r\n});\r\n\r\nexport const CreatePingReq = z.object({\r\n  ts: z.string().datetime().optional(),\r\n  lat: z.number().min(-90).max(90),\r\n  lon: z.number().min(-180).max(180),\r\n  accuracy_m: z.number().min(0).max(5000).nullable().optional(),\r\n  speed_kmh: z.number().min(0).max(200).nullable().optional(),\r\n  battery_pct: z.number().min(0).max(100).nullable().optional(),\r\n  traffic_context: z\r\n    .object({\r\n      traffic_speed_idx: z.number().min(0).max(1).optional(),\r\n      route_incident: z.boolean().optional(),\r\n      airport_wave: z.number().min(0).max(1).optional(),\r\n      weather_flag_rain: z.boolean().optional(),\r\n      event_flag: z.boolean().optional(),\r\n    })\r\n    .optional(),\r\n});\r\n\r\nexport const CreateChargeReq = z.object({\r\n  station_zone: z.string().uuid().nullable().optional(),\r\n  start_at: z.string().datetime().optional(),\r\n  end_at: z.string().datetime().nullable().optional(),\r\n  kwh: z.number().nullable().optional(),\r\n  cost_inr: z.number().nullable().optional(),\r\n});\r\n\r\nexport const AdminZoneReq = z.object({\r\n  name: z.string(),\r\n  lat: z.number(),\r\n  lon: z.number(),\r\n  is_airport: z.boolean().optional(),\r\n  is_charger: z.boolean().optional(),\r\n  meta: z.record(z.any()).optional(),\r\n});\r\n\r\nexport const AdminEventReq = z.object({\r\n  name: z.string(),\r\n  category: z.string().optional(),\r\n  venue_zone: z.string().uuid(),\r\n  start_at: z.string().datetime(),\r\n  end_at: z.string().datetime(),\r\n  impact_score: z.number().optional(),\r\n});\r\n\r\n// ===== Response Schemas =====\r\n\r\nexport const DataResponseSchema = <T extends z.ZodType>(dataSchema: T) =>\r\n  z.object({\r\n    data: dataSchema,\r\n  });\r\n\r\nexport const CreatedResponseSchema = z.object({\r\n  data: z.object({\r\n    created: z.boolean(),\r\n    id: z.string().uuid().optional(),\r\n  }),\r\n});\r\n\r\nexport const RecommendationSchema = z.object({\r\n  zone_id: z.string().uuid(),\r\n  zone_name: z.string(),\r\n  score: z.number(),\r\n  distance_km: z.number(),\r\n  eta_min: z.number(),\r\n  reason: z.string(),\r\n});\r\n\r\nexport const DriverStateSchema = z.object({\r\n  driver_id: z.string().uuid(),\r\n  last_ping_at: z.string().datetime(),\r\n  lat: z.number(),\r\n  lon: z.number(),\r\n  snapped_zone: z.string().uuid().nullable(),\r\n  speed_kmh: z.number().nullable(),\r\n  battery_pct: z.number().min(0).max(100).nullable(),\r\n  recommendation: z.array(RecommendationSchema).nullable(),\r\n  updated_at: z.string().datetime(),\r\n});\r\n\r\nexport const PingResponseSchema = z.object({\r\n  snapped_zone: z.string().uuid().nullable(),\r\n  recommendation: z.array(RecommendationSchema),\r\n});\r\n\r\nexport const WeatherSchema = z.object({\r\n  hour: z.string().datetime(),\r\n  temp_c: z.number().nullable(),\r\n  humidity: z.number().nullable(),\r\n  wind_kmh: z.number().nullable(),\r\n  rain_mm: z.number().nullable(),\r\n});\r\n\r\nexport const AirportWaveSchema = z.object({\r\n  bucket: z.string(),\r\n  arrival_wave: z.number().nullable(),\r\n  departure_wave: z.number().nullable(),\r\n});\r\n\r\nexport const HotspotSchema = z.object({\r\n  zone_id: z.string().uuid(),\r\n  bucket: z.string(),\r\n  popularity_index: z.number(),\r\n});\r\n\r\n// ===== Register Components =====\r\n\r\nregistry.register(\"ApiError\", ApiErrorSchema.openapi(\"ApiError\"));\r\nregistry.register(\"Health\", HealthSchema.openapi(\"Health\"));\r\nregistry.register(\"Zone\", ZoneSchema.openapi(\"Zone\"));\r\nregistry.register(\"RideEvent\", RideEventSchema.openapi(\"RideEvent\"));\r\nregistry.register(\"ZoneVisit\", ZoneVisitSchema.openapi(\"ZoneVisit\"));\r\nregistry.register(\"Ping\", PingSchema.openapi(\"Ping\"));\r\nregistry.register(\"Charge\", ChargeSchema.openapi(\"Charge\"));\r\nregistry.register(\"CityEvent\", CityEventSchema.openapi(\"CityEvent\"));\r\nregistry.register(\"Recommendation\", RecommendationSchema.openapi(\"Recommendation\"));\r\nregistry.register(\"DriverState\", DriverStateSchema.openapi(\"DriverState\"));\r\nregistry.register(\"PingResponse\", PingResponseSchema.openapi(\"PingResponse\"));\r\nregistry.register(\"Weather\", WeatherSchema.openapi(\"Weather\"));\r\nregistry.register(\"AirportWave\", AirportWaveSchema.openapi(\"AirportWave\"));\r\nregistry.register(\"Hotspot\", HotspotSchema.openapi(\"Hotspot\"));\r\n\r\nregistry.register(\"CreateRideEventReq\", CreateRideEventReq.openapi(\"CreateRideEventReq\"));\r\nregistry.register(\"CreateZoneVisitReq\", CreateZoneVisitReq.openapi(\"CreateZoneVisitReq\"));\r\nregistry.register(\"UpdateZoneVisitReq\", UpdateZoneVisitReq.openapi(\"UpdateZoneVisitReq\"));\r\nregistry.register(\"CreatePingReq\", CreatePingReq.openapi(\"CreatePingReq\"));\r\nregistry.register(\"CreateChargeReq\", CreateChargeReq.openapi(\"CreateChargeReq\"));\r\nregistry.register(\"AdminZoneReq\", AdminZoneReq.openapi(\"AdminZoneReq\"));\r\nregistry.register(\"AdminEventReq\", AdminEventReq.openapi(\"AdminEventReq\"));\r\n\r\n// ===== Register Paths =====\r\n\r\n// Health\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/health\",\r\n  tags: [\"System\"],\r\n  summary: \"Health check\",\r\n  responses: {\r\n    200: {\r\n      description: \"System is healthy\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(HealthSchema),\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\n// Zones\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/zones\",\r\n  tags: [\"Zones\"],\r\n  summary: \"List all zones\",\r\n  security: [{ bearerAuth: [] }],\r\n  responses: {\r\n    200: {\r\n      description: \"List of zones\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(z.array(ZoneSchema)),\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\n// Ride Events\r\nregistry.registerPath({\r\n  method: \"post\",\r\n  path: \"/api/ride-events\",\r\n  tags: [\"Ride Events\"],\r\n  summary: \"Create a ride event\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    body: {\r\n      content: {\r\n        \"application/json\": {\r\n          schema: CreateRideEventReq,\r\n        },\r\n      },\r\n    },\r\n  },\r\n  responses: {\r\n    201: {\r\n      description: \"Ride event created\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: CreatedResponseSchema,\r\n        },\r\n      },\r\n    },\r\n    400: {\r\n      description: \"Validation error\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/ride-events\",\r\n  tags: [\"Ride Events\"],\r\n  summary: \"List own ride events\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    query: z.object({\r\n      limit: z.string().optional(),\r\n    }),\r\n  },\r\n  responses: {\r\n    200: {\r\n      description: \"List of ride events\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(z.array(RideEventSchema)),\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/ride-events/{id}\",\r\n  tags: [\"Ride Events\"],\r\n  summary: \"Get a ride event by ID\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    params: z.object({\r\n      id: z.string().uuid(),\r\n    }),\r\n  },\r\n  responses: {\r\n    200: {\r\n      description: \"Ride event details\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(RideEventSchema),\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    404: {\r\n      description: \"Not found\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\n// Zone Visits\r\nregistry.registerPath({\r\n  method: \"post\",\r\n  path: \"/api/zone-visits\",\r\n  tags: [\"Zone Visits\"],\r\n  summary: \"Create a zone visit\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    body: {\r\n      content: {\r\n        \"application/json\": {\r\n          schema: CreateZoneVisitReq,\r\n        },\r\n      },\r\n    },\r\n  },\r\n  responses: {\r\n    201: {\r\n      description: \"Zone visit created\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: CreatedResponseSchema,\r\n        },\r\n      },\r\n    },\r\n    400: {\r\n      description: \"Validation error\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/zone-visits\",\r\n  tags: [\"Zone Visits\"],\r\n  summary: \"List own zone visits\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    query: z.object({\r\n      limit: z.string().optional(),\r\n    }),\r\n  },\r\n  responses: {\r\n    200: {\r\n      description: \"List of zone visits\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(z.array(ZoneVisitSchema)),\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nregistry.registerPath({\r\n  method: \"patch\",\r\n  path: \"/api/zone-visits/{id}\",\r\n  tags: [\"Zone Visits\"],\r\n  summary: \"Update zone visit left_at\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    params: z.object({\r\n      id: z.string().uuid(),\r\n    }),\r\n    body: {\r\n      content: {\r\n        \"application/json\": {\r\n          schema: UpdateZoneVisitReq,\r\n        },\r\n      },\r\n    },\r\n  },\r\n  responses: {\r\n    200: {\r\n      description: \"Zone visit updated\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(ZoneVisitSchema),\r\n        },\r\n      },\r\n    },\r\n    400: {\r\n      description: \"Validation error\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    404: {\r\n      description: \"Not found\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\n// Pings\r\nregistry.registerPath({\r\n  method: \"post\",\r\n  path: \"/api/pings\",\r\n  tags: [\"Tracking\"],\r\n  summary: \"Submit GPS ping and receive recommendations\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    body: {\r\n      content: {\r\n        \"application/json\": {\r\n          schema: CreatePingReq,\r\n        },\r\n      },\r\n    },\r\n  },\r\n  responses: {\r\n    201: {\r\n      description: \"Ping processed, recommendations computed\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(PingResponseSchema),\r\n        },\r\n      },\r\n    },\r\n    400: {\r\n      description: \"Validation error\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\n// Charges\r\nregistry.registerPath({\r\n  method: \"post\",\r\n  path: \"/api/charges\",\r\n  tags: [\"Charges\"],\r\n  summary: \"Create a charge record\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    body: {\r\n      content: {\r\n        \"application/json\": {\r\n          schema: CreateChargeReq,\r\n        },\r\n      },\r\n    },\r\n  },\r\n  responses: {\r\n    201: {\r\n      description: \"Charge created\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: CreatedResponseSchema,\r\n        },\r\n      },\r\n    },\r\n    400: {\r\n      description: \"Validation error\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/charges\",\r\n  tags: [\"Charges\"],\r\n  summary: \"List own charges\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    query: z.object({\r\n      limit: z.string().optional(),\r\n    }),\r\n  },\r\n  responses: {\r\n    200: {\r\n      description: \"List of charges\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(z.array(ChargeSchema)),\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\n// Context APIs\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/context/weather\",\r\n  tags: [\"Context\"],\r\n  summary: \"Get latest weather observation\",\r\n  security: [{ bearerAuth: [] }],\r\n  responses: {\r\n    200: {\r\n      description: \"Latest weather data\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(WeatherSchema.nullable()),\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/context/airport-wave\",\r\n  tags: [\"Context\"],\r\n  summary: \"Get current airport wave data\",\r\n  security: [{ bearerAuth: [] }],\r\n  responses: {\r\n    200: {\r\n      description: \"Airport wave data\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(z.array(AirportWaveSchema)),\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/context/hotspot\",\r\n  tags: [\"Context\"],\r\n  summary: \"Get zone hotspot popularity\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    query: z.object({\r\n      zone_id: z.string().uuid().optional(),\r\n      bucket: z.string().optional(),\r\n    }),\r\n  },\r\n  responses: {\r\n    200: {\r\n      description: \"Hotspot data\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(HotspotSchema.nullable()),\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\n// Recommendations\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/recommendations/next-spot\",\r\n  tags: [\"Recommendations\"],\r\n  summary: \"Get top recommended zones with ETA and distance\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    query: z.object({\r\n      lat: z.string().optional(),\r\n      lon: z.string().optional(),\r\n      limit: z.string().optional(),\r\n    }),\r\n  },\r\n  responses: {\r\n    200: {\r\n      description: \"Recommended zones with scores, distance, and ETA\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(z.array(RecommendationSchema)),\r\n        },\r\n      },\r\n    },\r\n    400: {\r\n      description: \"Missing or invalid coordinates\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\n// Driver State\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/driver-state\",\r\n  tags: [\"Tracking\"],\r\n  summary: \"Get current driver state and cached recommendations\",\r\n  security: [{ bearerAuth: [] }],\r\n  responses: {\r\n    200: {\r\n      description: \"Current driver state\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(DriverStateSchema),\r\n        },\r\n      },\r\n    },\r\n    204: {\r\n      description: \"No state available (new driver)\",\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\n// Admin - Zones\r\nregistry.registerPath({\r\n  method: \"post\",\r\n  path: \"/api/admin/zones\",\r\n  tags: [\"Admin\"],\r\n  summary: \"Create a zone (admin only)\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    body: {\r\n      content: {\r\n        \"application/json\": {\r\n          schema: AdminZoneReq,\r\n        },\r\n      },\r\n    },\r\n  },\r\n  responses: {\r\n    201: {\r\n      description: \"Zone created\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: CreatedResponseSchema,\r\n        },\r\n      },\r\n    },\r\n    400: {\r\n      description: \"Validation error\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    403: {\r\n      description: \"Forbidden - admin only\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nregistry.registerPath({\r\n  method: \"get\",\r\n  path: \"/api/admin/zones\",\r\n  tags: [\"Admin\"],\r\n  summary: \"List all zones (admin)\",\r\n  security: [{ bearerAuth: [] }],\r\n  responses: {\r\n    200: {\r\n      description: \"List of zones\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(z.array(ZoneSchema)),\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    403: {\r\n      description: \"Forbidden - admin only\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nregistry.registerPath({\r\n  method: \"patch\",\r\n  path: \"/api/admin/zones/{id}\",\r\n  tags: [\"Admin\"],\r\n  summary: \"Update a zone (admin only)\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    params: z.object({\r\n      id: z.string().uuid(),\r\n    }),\r\n    body: {\r\n      content: {\r\n        \"application/json\": {\r\n          schema: AdminZoneReq.partial(),\r\n        },\r\n      },\r\n    },\r\n  },\r\n  responses: {\r\n    200: {\r\n      description: \"Zone updated\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(ZoneSchema),\r\n        },\r\n      },\r\n    },\r\n    400: {\r\n      description: \"Validation error\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    403: {\r\n      description: \"Forbidden - admin only\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    404: {\r\n      description: \"Not found\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\n// Admin - Events\r\nregistry.registerPath({\r\n  method: \"post\",\r\n  path: \"/api/admin/events\",\r\n  tags: [\"Admin\"],\r\n  summary: \"Create a city event (admin only)\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    body: {\r\n      content: {\r\n        \"application/json\": {\r\n          schema: AdminEventReq,\r\n        },\r\n      },\r\n    },\r\n  },\r\n  responses: {\r\n    201: {\r\n      description: \"Event created\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: CreatedResponseSchema,\r\n        },\r\n      },\r\n    },\r\n    400: {\r\n      description: \"Validation error\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    403: {\r\n      description: \"Forbidden - admin only\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nregistry.registerPath({\r\n  method: \"patch\",\r\n  path: \"/api/admin/events/{id}\",\r\n  tags: [\"Admin\"],\r\n  summary: \"Update a city event (admin only)\",\r\n  security: [{ bearerAuth: [] }],\r\n  request: {\r\n    params: z.object({\r\n      id: z.string().uuid(),\r\n    }),\r\n    body: {\r\n      content: {\r\n        \"application/json\": {\r\n          schema: AdminEventReq.partial(),\r\n        },\r\n      },\r\n    },\r\n  },\r\n  responses: {\r\n    200: {\r\n      description: \"Event updated\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: DataResponseSchema(CityEventSchema),\r\n        },\r\n      },\r\n    },\r\n    400: {\r\n      description: \"Validation error\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    401: {\r\n      description: \"Unauthorized\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    403: {\r\n      description: \"Forbidden - admin only\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n    404: {\r\n      description: \"Not found\",\r\n      content: {\r\n        \"application/json\": {\r\n          schema: ApiErrorSchema,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1354, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/server/geo-utils.ts"],"sourcesContent":["/**\n * Server-side geospatial utilities for Patna EV Co-Pilot\n * All geographic calculations for recommendations and distance estimation\n */\n\n/**\n * Geometry point returned by Supabase/PostGIS. Coordinates array is [lon, lat].\n * See https://supabase.com/docs/guides/database/extensions/postgis#geography-geometric-objects\n */\nexport type GeoJsonPoint = {\n  type: \"Point\";\n  coordinates: [number, number];\n  crs?: { type: string; properties: Record<string, any> };\n};\n\n/**\n * Convert GeoJSON point to lat/lon pair.\n */\nexport function latLonFromPoint(\n  point: GeoJsonPoint | null | undefined\n): { lat: number | null; lon: number | null } {\n  if (!point || !Array.isArray(point.coordinates)) {\n    return { lat: null, lon: null };\n  }\n  const [lon, lat] = point.coordinates ?? [];\n  if (!Number.isFinite(lat) || !Number.isFinite(lon)) {\n    return { lat: null, lon: null };\n  }\n  return { lat, lon };\n}\n\n/**\n * Build a GeoJSON Point payload for inserting/updating geography columns.\n */\nexport function pointFromLatLon(lat: number, lon: number): GeoJsonPoint {\n  return {\n    type: \"Point\",\n    coordinates: [lon, lat],\n  };\n}\n\n/**\n * Calculate Haversine distance between two points in meters\n */\nexport function haversineDistance(\r\n  lat1: number,\r\n  lon1: number,\r\n  lat2: number,\r\n  lon2: number\r\n): number {\r\n  const R = 6371e3; // Earth's radius in meters\r\n  const 1 = (lat1 * Math.PI) / 180;\r\n  const 2 = (lat2 * Math.PI) / 180;\r\n  const  = ((lat2 - lat1) * Math.PI) / 180;\r\n  const  = ((lon2 - lon1) * Math.PI) / 180;\r\n\r\n  const a =\r\n    Math.sin( / 2) * Math.sin( / 2) +\r\n    Math.cos(1) * Math.cos(2) * Math.sin( / 2) * Math.sin( / 2);\r\n\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\r\n  return R * c; // Distance in meters\r\n}\r\n\r\n/**\r\n * Calculate distance in kilometers\r\n */\r\nexport function distanceKm(\r\n  lat1: number,\r\n  lon1: number,\r\n  lat2: number,\r\n  lon2: number\r\n): number {\r\n  return haversineDistance(lat1, lon1, lat2, lon2) / 1000;\r\n}\r\n\r\n/**\r\n * Estimate travel time in minutes based on distance and average speed\r\n * Applies Patna-specific road biases:\r\n * - Urban areas: ~15 km/h average (heavy traffic, narrow roads)\r\n * - Highway corridors: ~30 km/h average\r\n * - Short distances (<2km): add 3 min penalty for navigation/turns\r\n */\r\nexport function estimateETA(\r\n  distanceMeters: number,\r\n  currentSpeedKmh?: number | null\r\n): number {\r\n  const distanceKm = distanceMeters / 1000;\r\n\r\n  // Use current speed if available and reasonable (5-60 km/h)\r\n  let avgSpeed = 15; // Default urban speed\r\n  if (currentSpeedKmh && currentSpeedKmh >= 5 && currentSpeedKmh <= 60) {\r\n    avgSpeed = currentSpeedKmh;\r\n  } else if (distanceKm > 5) {\r\n    // Longer distances likely use better roads\r\n    avgSpeed = 25;\r\n  }\r\n\r\n  let etaMinutes = (distanceKm / avgSpeed) * 60;\r\n\r\n  // Add navigation penalty for short trips\r\n  if (distanceKm < 2) {\r\n    etaMinutes += 3;\r\n  }\r\n\r\n  return Math.ceil(etaMinutes);\r\n}\r\n\r\n/**\r\n * Validate latitude is within valid range\r\n */\r\nexport function isValidLatitude(lat: number): boolean {\r\n  return lat >= -90 && lat <= 90;\r\n}\r\n\r\n/**\r\n * Validate longitude is within valid range\r\n */\r\nexport function isValidLongitude(lon: number): boolean {\r\n  return lon >= -180 && lon <= 180;\r\n}\r\n\r\n/**\r\n * Validate coordinates are within Patna's approximate bounds\r\n * Patna roughly: 25.3-25.8N, 84.9-85.4E\r\n * Using generous bounds to allow some flexibility\r\n */\r\nexport function isWithinPatnaBounds(lat: number, lon: number): boolean {\r\n  return lat >= 25.0 && lat <= 26.0 && lon >= 84.5 && lon <= 85.8;\r\n}\r\n\r\n/**\r\n * Get current 30-minute time bucket\r\n * Returns format: \"HH:00\" or \"HH:30\"\r\n */\r\nexport function getCurrentBucket30m(): string {\r\n  const now = new Date();\r\n  const hour = String(now.getHours()).padStart(2, \"0\");\r\n  const minutes = now.getMinutes() < 30 ? \"00\" : \"30\";\r\n  return `${hour}:${minutes}`;\r\n}\r\n\r\n/**\r\n * Get hour of day (0-23)\r\n */\r\nexport function getCurrentHour(): number {\r\n  return new Date().getHours();\r\n}\r\n\r\n/**\r\n * Get day of week (0=Sunday, 6=Saturday)\r\n */\r\nexport function getCurrentDayOfWeek(): number {\r\n  return new Date().getDay();\r\n}\r\n\r\n/**\r\n * Format coordinates for logging (truncated to 4 decimal places)\r\n */\r\nexport function formatCoords(lat: number, lon: number): string {\r\n  return `${lat.toFixed(4)},${lon.toFixed(4)}`;\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC,GAED;;;CAGC;;;;;;;;;;;;;;;;;;;;;;;;;;AAUM,SAAS,gBACd,KAAsC;IAEtC,IAAI,CAAC,SAAS,CAAC,MAAM,OAAO,CAAC,MAAM,WAAW,GAAG;QAC/C,OAAO;YAAE,KAAK;YAAM,KAAK;QAAK;IAChC;IACA,MAAM,CAAC,KAAK,IAAI,GAAG,MAAM,WAAW,IAAI,EAAE;IAC1C,IAAI,CAAC,OAAO,QAAQ,CAAC,QAAQ,CAAC,OAAO,QAAQ,CAAC,MAAM;QAClD,OAAO;YAAE,KAAK;YAAM,KAAK;QAAK;IAChC;IACA,OAAO;QAAE;QAAK;IAAI;AACpB;AAKO,SAAS,gBAAgB,GAAW,EAAE,GAAW;IACtD,OAAO;QACL,MAAM;QACN,aAAa;YAAC;YAAK;SAAI;IACzB;AACF;AAKO,SAAS,kBACd,IAAY,EACZ,IAAY,EACZ,IAAY,EACZ,IAAY;IAEZ,MAAM,IAAI,QAAQ,2BAA2B;IAC7C,MAAM,KAAK,AAAC,OAAO,KAAK,EAAE,GAAI;IAC9B,MAAM,KAAK,AAAC,OAAO,KAAK,EAAE,GAAI;IAC9B,MAAM,KAAK,AAAC,CAAC,OAAO,IAAI,IAAI,KAAK,EAAE,GAAI;IACvC,MAAM,KAAK,AAAC,CAAC,OAAO,IAAI,IAAI,KAAK,EAAE,GAAI;IAEvC,MAAM,IACJ,KAAK,GAAG,CAAC,KAAK,KAAK,KAAK,GAAG,CAAC,KAAK,KACjC,KAAK,GAAG,CAAC,MAAM,KAAK,GAAG,CAAC,MAAM,KAAK,GAAG,CAAC,KAAK,KAAK,KAAK,GAAG,CAAC,KAAK;IAEjE,MAAM,IAAI,IAAI,KAAK,KAAK,CAAC,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI;IAErD,OAAO,IAAI,GAAG,qBAAqB;AACrC;AAKO,SAAS,WACd,IAAY,EACZ,IAAY,EACZ,IAAY,EACZ,IAAY;IAEZ,OAAO,kBAAkB,MAAM,MAAM,MAAM,QAAQ;AACrD;AASO,SAAS,YACd,cAAsB,EACtB,eAA+B;IAE/B,MAAM,aAAa,iBAAiB;IAEpC,4DAA4D;IAC5D,IAAI,WAAW,IAAI,sBAAsB;IACzC,IAAI,mBAAmB,mBAAmB,KAAK,mBAAmB,IAAI;QACpE,WAAW;IACb,OAAO,IAAI,aAAa,GAAG;QACzB,2CAA2C;QAC3C,WAAW;IACb;IAEA,IAAI,aAAa,AAAC,aAAa,WAAY;IAE3C,yCAAyC;IACzC,IAAI,aAAa,GAAG;QAClB,cAAc;IAChB;IAEA,OAAO,KAAK,IAAI,CAAC;AACnB;AAKO,SAAS,gBAAgB,GAAW;IACzC,OAAO,OAAO,CAAC,MAAM,OAAO;AAC9B;AAKO,SAAS,iBAAiB,GAAW;IAC1C,OAAO,OAAO,CAAC,OAAO,OAAO;AAC/B;AAOO,SAAS,oBAAoB,GAAW,EAAE,GAAW;IAC1D,OAAO,OAAO,QAAQ,OAAO,QAAQ,OAAO,QAAQ,OAAO;AAC7D;AAMO,SAAS;IACd,MAAM,MAAM,IAAI;IAChB,MAAM,OAAO,OAAO,IAAI,QAAQ,IAAI,QAAQ,CAAC,GAAG;IAChD,MAAM,UAAU,IAAI,UAAU,KAAK,KAAK,OAAO;IAC/C,OAAO,GAAG,KAAK,CAAC,EAAE,SAAS;AAC7B;AAKO,SAAS;IACd,OAAO,IAAI,OAAO,QAAQ;AAC5B;AAKO,SAAS;IACd,OAAO,IAAI,OAAO,MAAM;AAC1B;AAKO,SAAS,aAAa,GAAW,EAAE,GAAW;IACnD,OAAO,GAAG,IAAI,OAAO,CAAC,GAAG,CAAC,EAAE,IAAI,OAAO,CAAC,IAAI;AAC9C","debugId":null}},
    {"offset": {"line": 1472, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/server/ride-event-ingest.ts"],"sourcesContent":["import type { SupabaseClient } from \"@supabase/supabase-js\";\nimport type { RideEventIngestInput } from \"@/lib/zod-schemas\";\nimport {\n  isValidLatitude,\n  isValidLongitude,\n  pointFromLatLon,\n} from \"./geo-utils\";\n\nconst ZONE_SNAP_RADIUS_M = 3000;\n\ninterface IngestResult {\n  eventId: number;\n  pickupZoneId: number | null;\n  dropZoneId: number | null;\n  occurredAt: string;\n}\n\nexport async function ingestRideEvent({\n  supabase,\n  driverId,\n  payload,\n}: {\n  supabase: SupabaseClient;\n  driverId: string;\n  payload: RideEventIngestInput;\n}): Promise<IngestResult> {\n  const occurredAt = payload.occurred_at\n    ? new Date(payload.occurred_at).toISOString()\n    : new Date().toISOString();\n\n  const hasPickup =\n    typeof payload.pickup_lat === \"number\" &&\n    typeof payload.pickup_lon === \"number\" &&\n    isValidLatitude(payload.pickup_lat) &&\n    isValidLongitude(payload.pickup_lon);\n\n  const hasDrop =\n    typeof payload.drop_lat === \"number\" &&\n    typeof payload.drop_lon === \"number\" &&\n    isValidLatitude(payload.drop_lat) &&\n    isValidLongitude(payload.drop_lon);\n\n  const [pickupZoneId, dropZoneId] = await Promise.all([\n    hasPickup\n      ? snapZoneId(supabase, payload.pickup_lat!, payload.pickup_lon!)\n      : Promise.resolve(null),\n    hasDrop\n      ? snapZoneId(supabase, payload.drop_lat!, payload.drop_lon!)\n      : Promise.resolve(null),\n  ]);\n\n  const insertPayload: Record<string, any> = {\n    driver_id: driverId,\n    event_type: payload.event_type,\n    occurred_at: occurredAt,\n    platform: payload.platform ?? null,\n    surge_multiplier: payload.surge_multiplier ?? null,\n    promo_code: payload.promo_code ?? null,\n    cancel_reason:\n      payload.event_type === \"booking_cancelled\"\n        ? payload.cancel_reason ?? null\n        : null,\n    deadhead_distance_km: payload.deadhead_distance_km ?? null,\n    deadhead_time_min: payload.deadhead_time_min ?? null,\n    pickup_zone: pickupZoneId,\n    drop_zone: dropZoneId,\n    pickup_loc: hasPickup\n      ? pointFromLatLon(payload.pickup_lat!, payload.pickup_lon!)\n      : null,\n    drop_loc: hasDrop\n      ? pointFromLatLon(payload.drop_lat!, payload.drop_lon!)\n      : null,\n  };\n\n  const { data, error } = await supabase\n    .from(\"ride_events\")\n    .insert(insertPayload)\n    .select(\"id\")\n    .single();\n\n  if (error) {\n    throw error;\n  }\n\n  if (payload.event_type === \"ride_completed\") {\n    try {\n      await supabase.rpc(\"upsert_trip_from_events\", {\n        p_driver_id: driverId,\n        p_platform: payload.platform ?? null,\n        p_fare_inr: payload.fare_inr ?? null,\n        p_distance_km: payload.distance_km ?? null,\n        p_pickup_zone: pickupZoneId,\n        p_drop_zone: dropZoneId,\n        p_completed_at: occurredAt,\n        p_event_id: data?.id ?? null,\n        p_deadhead_distance_km: payload.deadhead_distance_km ?? null,\n        p_deadhead_time_min: payload.deadhead_time_min ?? null,\n      });\n    } catch (rpcError) {\n      console.error(\"[ride-events] upsert_trip_from_events failed\", {\n        driverId,\n        rpcError,\n      });\n    }\n  }\n\n  return {\n    eventId: data!.id,\n    pickupZoneId,\n    dropZoneId,\n    occurredAt,\n  };\n}\n\nasync function snapZoneId(\n  supabase: SupabaseClient,\n  lat: number,\n  lon: number\n): Promise<number | null> {\n  const { data, error } = await supabase.rpc(\"nearest_zone\", {\n    p_lat: lat,\n    p_lon: lon,\n    p_max_m: ZONE_SNAP_RADIUS_M,\n  });\n\n  if (error) {\n    console.error(\"[ride-events] nearest_zone failed\", { error });\n    return null;\n  }\n\n  return typeof data === \"number\" ? data : null;\n}\n"],"names":[],"mappings":";;;;AAEA;;AAMA,MAAM,qBAAqB;AASpB,eAAe,gBAAgB,EACpC,QAAQ,EACR,QAAQ,EACR,OAAO,EAKR;IACC,MAAM,aAAa,QAAQ,WAAW,GAClC,IAAI,KAAK,QAAQ,WAAW,EAAE,WAAW,KACzC,IAAI,OAAO,WAAW;IAE1B,MAAM,YACJ,OAAO,QAAQ,UAAU,KAAK,YAC9B,OAAO,QAAQ,UAAU,KAAK,YAC9B,IAAA,kJAAe,EAAC,QAAQ,UAAU,KAClC,IAAA,mJAAgB,EAAC,QAAQ,UAAU;IAErC,MAAM,UACJ,OAAO,QAAQ,QAAQ,KAAK,YAC5B,OAAO,QAAQ,QAAQ,KAAK,YAC5B,IAAA,kJAAe,EAAC,QAAQ,QAAQ,KAChC,IAAA,mJAAgB,EAAC,QAAQ,QAAQ;IAEnC,MAAM,CAAC,cAAc,WAAW,GAAG,MAAM,QAAQ,GAAG,CAAC;QACnD,YACI,WAAW,UAAU,QAAQ,UAAU,EAAG,QAAQ,UAAU,IAC5D,QAAQ,OAAO,CAAC;QACpB,UACI,WAAW,UAAU,QAAQ,QAAQ,EAAG,QAAQ,QAAQ,IACxD,QAAQ,OAAO,CAAC;KACrB;IAED,MAAM,gBAAqC;QACzC,WAAW;QACX,YAAY,QAAQ,UAAU;QAC9B,aAAa;QACb,UAAU,QAAQ,QAAQ,IAAI;QAC9B,kBAAkB,QAAQ,gBAAgB,IAAI;QAC9C,YAAY,QAAQ,UAAU,IAAI;QAClC,eACE,QAAQ,UAAU,KAAK,sBACnB,QAAQ,aAAa,IAAI,OACzB;QACN,sBAAsB,QAAQ,oBAAoB,IAAI;QACtD,mBAAmB,QAAQ,iBAAiB,IAAI;QAChD,aAAa;QACb,WAAW;QACX,YAAY,YACR,IAAA,kJAAe,EAAC,QAAQ,UAAU,EAAG,QAAQ,UAAU,IACvD;QACJ,UAAU,UACN,IAAA,kJAAe,EAAC,QAAQ,QAAQ,EAAG,QAAQ,QAAQ,IACnD;IACN;IAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,eACL,MAAM,CAAC,eACP,MAAM,CAAC,MACP,MAAM;IAET,IAAI,OAAO;QACT,MAAM;IACR;IAEA,IAAI,QAAQ,UAAU,KAAK,kBAAkB;QAC3C,IAAI;YACF,MAAM,SAAS,GAAG,CAAC,2BAA2B;gBAC5C,aAAa;gBACb,YAAY,QAAQ,QAAQ,IAAI;gBAChC,YAAY,QAAQ,QAAQ,IAAI;gBAChC,eAAe,QAAQ,WAAW,IAAI;gBACtC,eAAe;gBACf,aAAa;gBACb,gBAAgB;gBAChB,YAAY,MAAM,MAAM;gBACxB,wBAAwB,QAAQ,oBAAoB,IAAI;gBACxD,qBAAqB,QAAQ,iBAAiB,IAAI;YACpD;QACF,EAAE,OAAO,UAAU;YACjB,QAAQ,KAAK,CAAC,gDAAgD;gBAC5D;gBACA;YACF;QACF;IACF;IAEA,OAAO;QACL,SAAS,KAAM,EAAE;QACjB;QACA;QACA;IACF;AACF;AAEA,eAAe,WACb,QAAwB,EACxB,GAAW,EACX,GAAW;IAEX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,gBAAgB;QACzD,OAAO;QACP,OAAO;QACP,SAAS;IACX;IAEA,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,qCAAqC;YAAE;QAAM;QAC3D,OAAO;IACT;IAEA,OAAO,OAAO,SAAS,WAAW,OAAO;AAC3C","debugId":null}},
    {"offset": {"line": 1558, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/supabase/config.ts"],"sourcesContent":["const isServer = () => typeof window === \"undefined\";\n\n/**\n * Next.js only inlines environment variables when they are referenced with static keys.\n * Avoid dynamic lookups (e.g. process.env[key]) because they are stripped from the client bundle\n * and will always be undefined in the browser.\n */\nexport function getSupabaseConfig() {\n  const serverUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const serverAnonKey =\n    process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  const url = isServer() ? serverUrl : process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const anonKey = isServer() ? serverAnonKey : process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  if (!url) {\n    throw new Error(\"Missing SUPABASE_URL/NEXT_PUBLIC_SUPABASE_URL environment variable\");\n  }\n  if (!anonKey) {\n    throw new Error(\"Missing SUPABASE_ANON_KEY/NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable\");\n  }\n\n  return { url, anonKey };\n}\n"],"names":[],"mappings":";;;;AAAA,MAAM,WAAW,IAAM,kDAAkB;AAOlC,SAAS;IACd,MAAM,YAAY,QAAQ,GAAG,CAAC,YAAY;IAC1C,MAAM,gBACJ,QAAQ,GAAG,CAAC,iBAAiB;IAE/B,MAAM,MAAM,aAAa,YAAY;IACrC,MAAM,UAAU,aAAa,gBAAgB;IAE7C;;IAGA;;IAIA,OAAO;QAAE;QAAK;IAAQ;AACxB","debugId":null}},
    {"offset": {"line": 1581, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport type { SupabaseClient, User as SupabaseUser } from \"@supabase/supabase-js\";\nimport { cookies } from \"next/headers\";\nimport { getSupabaseConfig } from \"./config\";\nimport type { AppUser, DriverProfile } from \"./types\";\n\nexport type { AppUser, DriverProfile } from \"./types\";\n\nfunction mapUser(user: SupabaseUser | null): AppUser | null {\n  if (!user) return null;\n  return {\n    id: user.id,\n    email: user.email ?? null,\n    fullName: (user.user_metadata as Record<string, any> | null)?.full_name ?? null,\n  };\n}\n\nexport async function createServerSupabaseClient() {\n  const { url, anonKey } = getSupabaseConfig();\n  const cookieStore = await cookies();\n\n  const supabase = createServerClient(url, anonKey, {\n    cookies: {\n      get(name: string) {\n        return cookieStore.get(name)?.value;\n      },\n      set(name: string, value: string, options: any) {\n        const mutableStore = cookieStore as unknown as {\n          set?: (options: { name: string; value: string } & Record<string, any>) => void;\n        };\n        mutableStore.set?.({ name, value, ...options });\n      },\n      remove(name: string, options: any) {\n        const mutableStore = cookieStore as unknown as {\n          set?: (options: { name: string; value: string } & Record<string, any>) => void;\n        };\n        mutableStore.set?.({ name, value: \"\", ...options, maxAge: 0 });\n      },\n    },\n  });\n\n  const {\n    data: { user },\n    error,\n  } = await supabase.auth.getUser();\n\n  if (error && error.message !== \"Auth session missing!\") {\n    console.warn(\"[supabase] auth.getUser failed\", error);\n  }\n\n  return {\n    supabase,\n    user: mapUser(user),\n  };\n}\n\nexport async function loadProfile(supabase: SupabaseClient, userId: string) {\n  const { data, error } = await supabase\n    .from(\"profiles\")\n    .select(\"id,full_name,created_at\")\n    .eq(\"id\", userId)\n    .maybeSingle();\n\n  if (error && error.code !== \"PGRST116\") {\n    console.warn(\"[supabase] failed to load profile\", { userId, error });\n    return null;\n  }\n\n  return (data ?? null) as DriverProfile | null;\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;AACA;;;;AAKA,SAAS,QAAQ,IAAyB;IACxC,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO;QACL,IAAI,KAAK,EAAE;QACX,OAAO,KAAK,KAAK,IAAI;QACrB,UAAU,AAAC,KAAK,aAAa,EAAiC,aAAa;IAC7E;AACF;AAEO,eAAe;IACpB,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,IAAA,gJAAiB;IAC1C,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,MAAM,WAAW,IAAA,iMAAkB,EAAC,KAAK,SAAS;QAChD,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,YAAY,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAY;gBAC3C,MAAM,eAAe;gBAGrB,aAAa,GAAG,GAAG;oBAAE;oBAAM;oBAAO,GAAG,OAAO;gBAAC;YAC/C;YACA,QAAO,IAAY,EAAE,OAAY;gBAC/B,MAAM,eAAe;gBAGrB,aAAa,GAAG,GAAG;oBAAE;oBAAM,OAAO;oBAAI,GAAG,OAAO;oBAAE,QAAQ;gBAAE;YAC9D;QACF;IACF;IAEA,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACd,KAAK,EACN,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,SAAS,MAAM,OAAO,KAAK,yBAAyB;QACtD,QAAQ,IAAI,CAAC,kCAAkC;IACjD;IAEA,OAAO;QACL;QACA,MAAM,QAAQ;IAChB;AACF;AAEO,eAAe,YAAY,QAAwB,EAAE,MAAc;IACxE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC,2BACP,EAAE,CAAC,MAAM,QACT,WAAW;IAEd,IAAI,SAAS,MAAM,IAAI,KAAK,YAAY;QACtC,QAAQ,IAAI,CAAC,qCAAqC;YAAE;YAAQ;QAAM;QAClE,OAAO;IACT;IAEA,OAAQ,QAAQ;AAClB","debugId":null}},
    {"offset": {"line": 1653, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/app/api/ride-events/ingest/route.ts"],"sourcesContent":["import type { PostgrestError } from \"@supabase/supabase-js\";\nimport { ok, bad } from \"@/lib/api-respond\";\nimport { RideEventIngestSchema } from \"@/lib/zod-schemas\";\nimport { ingestRideEvent } from \"@/lib/server/ride-event-ingest\";\nimport { createServerSupabaseClient } from \"@/lib/supabase/server\";\nimport { z } from \"zod\";\n\nexport async function POST(req: Request) {\n  const { supabase, user } = await createServerSupabaseClient();\n\n  if (!user) {\n    return Response.json(\n      {\n        error: {\n          code: \"UNAUTHENTICATED\",\n          message: \"Please sign in\",\n        },\n      },\n      { status: 401 }\n    );\n  }\n\n  let body: unknown = null;\n  try {\n    body = await req.json();\n  } catch (error) {\n    return bad(\n      \"Request body must be valid JSON\",\n      serializeError(error),\n      400,\n      \"INVALID_JSON\"\n    );\n  }\n\n  const logContext = {\n    userId: user.id,\n  };\n\n  try {\n    const payload = RideEventIngestSchema.parse(body);\n    const result = await ingestRideEvent({\n      supabase,\n      driverId: user.id,\n      payload,\n    });\n\n    return ok({\n      ok: true,\n      event_id: result.eventId,\n      pickup_zone: result.pickupZoneId,\n      drop_zone: result.dropZoneId,\n      occurred_at: result.occurredAt,\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return bad(\"Invalid input\", error.flatten(), 400, \"INVALID_INPUT\");\n    }\n\n    if (isPostgrestError(error)) {\n      console.error(\"[ride-events/ingest] DB error\", {\n        ...logContext,\n        payload: body,\n        error,\n      });\n      return Response.json(\n        {\n          error: {\n            code: \"DB_ERROR\",\n            message: \"Failed to insert ride event\",\n            details: formatPostgrestError(error),\n          },\n        },\n        { status: 500 }\n      );\n    }\n\n    console.error(\"[ride-events/ingest] failed\", {\n      ...logContext,\n      payload: body,\n      error,\n    });\n\n    return bad(\n      error instanceof Error ? error.message : \"Unexpected error\",\n      serializeError(error),\n      500,\n      \"INTERNAL_ERROR\"\n    );\n  }\n}\n\nfunction serializeError(error: unknown) {\n  if (!error) {\n    return null;\n  }\n\n  if (error instanceof Error) {\n    const extras =\n      typeof error === \"object\"\n        ? Object.fromEntries(\n            Object.entries(error as unknown as Record<string, unknown>)\n          )\n        : {};\n\n    return {\n      name: error.name,\n      message: error.message,\n      ...(error.stack ? { stack: error.stack } : {}),\n      ...extras,\n    };\n  }\n\n  if (typeof error === \"object\") {\n    return error;\n  }\n\n  return { message: String(error) };\n}\n\nfunction isPostgrestError(error: unknown): error is PostgrestError {\n  return (\n    typeof error === \"object\" &&\n    error !== null &&\n    \"code\" in error &&\n    typeof (error as { code?: unknown }).code === \"string\" &&\n    \"message\" in error\n  );\n}\n\nfunction formatPostgrestError(error: PostgrestError) {\n  return {\n    code: error.code,\n    message: error.message,\n    details: error.details ?? null,\n    hint: error.hint ?? null,\n  };\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,yJAA0B;IAE3D,IAAI,CAAC,MAAM;QACT,OAAO,SAAS,IAAI,CAClB;YACE,OAAO;gBACL,MAAM;gBACN,SAAS;YACX;QACF,GACA;YAAE,QAAQ;QAAI;IAElB;IAEA,IAAI,OAAgB;IACpB,IAAI;QACF,OAAO,MAAM,IAAI,IAAI;IACvB,EAAE,OAAO,OAAO;QACd,OAAO,IAAA,8HAAG,EACR,mCACA,eAAe,QACf,KACA;IAEJ;IAEA,MAAM,aAAa;QACjB,QAAQ,KAAK,EAAE;IACjB;IAEA,IAAI;QACF,MAAM,UAAU,gJAAqB,CAAC,KAAK,CAAC;QAC5C,MAAM,SAAS,MAAM,IAAA,6JAAe,EAAC;YACnC;YACA,UAAU,KAAK,EAAE;YACjB;QACF;QAEA,OAAO,IAAA,6HAAE,EAAC;YACR,IAAI;YACJ,UAAU,OAAO,OAAO;YACxB,aAAa,OAAO,YAAY;YAChC,WAAW,OAAO,UAAU;YAC5B,aAAa,OAAO,UAAU;QAChC;IACF,EAAE,OAAO,OAAO;QACd,IAAI,iBAAiB,yKAAC,CAAC,QAAQ,EAAE;YAC/B,OAAO,IAAA,8HAAG,EAAC,iBAAiB,MAAM,OAAO,IAAI,KAAK;QACpD;QAEA,IAAI,iBAAiB,QAAQ;YAC3B,QAAQ,KAAK,CAAC,iCAAiC;gBAC7C,GAAG,UAAU;gBACb,SAAS;gBACT;YACF;YACA,OAAO,SAAS,IAAI,CAClB;gBACE,OAAO;oBACL,MAAM;oBACN,SAAS;oBACT,SAAS,qBAAqB;gBAChC;YACF,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,KAAK,CAAC,+BAA+B;YAC3C,GAAG,UAAU;YACb,SAAS;YACT;QACF;QAEA,OAAO,IAAA,8HAAG,EACR,iBAAiB,QAAQ,MAAM,OAAO,GAAG,oBACzC,eAAe,QACf,KACA;IAEJ;AACF;AAEA,SAAS,eAAe,KAAc;IACpC,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,IAAI,iBAAiB,OAAO;QAC1B,MAAM,SACJ,OAAO,UAAU,WACb,OAAO,WAAW,CAChB,OAAO,OAAO,CAAC,UAEjB,CAAC;QAEP,OAAO;YACL,MAAM,MAAM,IAAI;YAChB,SAAS,MAAM,OAAO;YACtB,GAAI,MAAM,KAAK,GAAG;gBAAE,OAAO,MAAM,KAAK;YAAC,IAAI,CAAC,CAAC;YAC7C,GAAG,MAAM;QACX;IACF;IAEA,IAAI,OAAO,UAAU,UAAU;QAC7B,OAAO;IACT;IAEA,OAAO;QAAE,SAAS,OAAO;IAAO;AAClC;AAEA,SAAS,iBAAiB,KAAc;IACtC,OACE,OAAO,UAAU,YACjB,UAAU,QACV,UAAU,SACV,OAAO,AAAC,MAA6B,IAAI,KAAK,YAC9C,aAAa;AAEjB;AAEA,SAAS,qBAAqB,KAAqB;IACjD,OAAO;QACL,MAAM,MAAM,IAAI;QAChB,SAAS,MAAM,OAAO;QACtB,SAAS,MAAM,OAAO,IAAI;QAC1B,MAAM,MAAM,IAAI,IAAI;IACtB;AACF","debugId":null}}]
}