{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/layout/DriverShell.tsx"],"sourcesContent":["import { ReactNode } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface DriverShellProps {\n  title?: string;\n  subtitle?: string;\n  actions?: ReactNode;\n  children: ReactNode;\n  className?: string;\n}\n\nexport function DriverShell({ title, subtitle, actions, children, className }: DriverShellProps) {\n  return (\n    <section className={cn(\"flex h-full flex-col\", className)}>\n      {(title || subtitle || actions) && (\n        <header className=\"flex flex-col gap-2 border-b px-4 py-4 text-left\">\n          <div className=\"flex items-start justify-between gap-3\">\n            <div>\n              {title && <h1 className=\"text-2xl font-semibold leading-tight\">{title}</h1>}\n              {subtitle && <p className=\"text-sm text-muted-foreground\">{subtitle}</p>}\n            </div>\n            {actions && <div className=\"shrink-0\">{actions}</div>}\n          </div>\n        </header>\n      )}\n      <div className=\"flex-1 overflow-y-auto px-4 pb-24 pt-4 md:pb-8\">{children}</div>\n    </section>\n  );\n}\r\n"],"names":[],"mappings":";;;;;AACA;;;AAUO,SAAS,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAoB;IAC7F,qBACE,6LAAC;QAAQ,WAAW,IAAA,qHAAE,EAAC,wBAAwB;;YAC5C,CAAC,SAAS,YAAY,OAAO,mBAC5B,6LAAC;gBAAO,WAAU;0BAChB,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;;gCACE,uBAAS,6LAAC;oCAAG,WAAU;8CAAwC;;;;;;gCAC/D,0BAAY,6LAAC;oCAAE,WAAU;8CAAiC;;;;;;;;;;;;wBAE5D,yBAAW,6LAAC;4BAAI,WAAU;sCAAY;;;;;;;;;;;;;;;;;0BAI7C,6LAAC;gBAAI,WAAU;0BAAkD;;;;;;;;;;;;AAGvE;KAjBgB","debugId":null}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/api-client.ts"],"sourcesContent":["export type ApiError = {\n  code: string;\n  message: string;\n  details?: unknown;\n};\n\nasync function parseJson<T>(res: Response): Promise<T | null> {\n  if (res.status === 204) return null;\n  const contentType = res.headers.get(\"content-type\");\n  if (contentType && contentType.includes(\"application/json\")) {\n    return (await res.json()) as T;\n  }\n  return null;\n}\n\nasync function handleResponse<T>(\n  res: Response\n): Promise<{ data: T | null; error: ApiError | null }> {\n  if (res.ok) {\n    const data = await parseJson<T>(res);\n    return { data, error: null };\n  }\n\n  const payload =\n    (await parseJson<{ error?: { code: string; message: string; details?: unknown } }>(\n      res\n    )) || undefined;\n\n  const error: ApiError = {\n    code: payload?.error?.code || `HTTP_${res.status}`,\n    message: payload?.error?.message || res.statusText,\n    details: payload?.error?.details,\n  };\n  return { data: null, error };\n}\n\nexport async function apiGet<T>(url: string) {\n  const res = await fetch(url, {\n    cache: \"no-store\",\n    credentials: \"include\",\n  });\n  return handleResponse<T>(res);\n}\n\nexport async function apiPost<T, B = unknown>(url: string, body: B) {\n  const res = await fetch(url, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify(body),\n    credentials: \"include\",\n  });\n  return handleResponse<T>(res);\n}\n\nexport type RecommendationZone = {\n  zone_id: number;\n  zone_name: string;\n  lat: number;\n  lon: number;\n  distance_km: number;\n  eta_min: number;\n  score: number;\n  reason: string;\n  success_prob?: number;\n  expected_fare_inr?: number;\n  normalized_fare?: number;\n  traffic_penalty?: number;\n  traffic_speed_idx?: number | null;\n};\n\nexport type RecommendationResponse = {\n  computed_at: string;\n  source?: string;\n  traffic_source?: \"google\" | \"cache\" | \"fallback\" | null;\n  context?: Record<string, unknown> | null;\n  top: RecommendationZone[];\n};\n\nexport type GeoPoint = {\n  type: \"Point\";\n  coordinates: [number, number];\n  crs?: { type: string; properties: Record<string, any> };\n};\n\nexport type DriverState = {\n  driver_id: string;\n  last_ping_at: string | null;\n  loc: GeoPoint | null;\n  /**\n   * Convenience lat/lon derived from loc.coordinates (lon, lat).\n   * These fields are not stored directly in the database.\n   */\n  lat: number | null;\n  lon: number | null;\n  snapped_zone: number | null;\n  speed_kmh: number | null;\n  battery_pct: number | null;\n  last_ping_accuracy_m: number | null;\n  recommendation: RecommendationResponse | null;\n  updated_at: string | null;\n};\n\nexport type DriverStateResponse = DriverState | null;\n\nexport type PingPayload = {\n  lat: number;\n  lon: number;\n  ts?: string;\n  accuracy_m?: number | null;\n  speed_kmh?: number | null;\n  battery_pct?: number | null;\n  traffic_context?: Record<string, unknown>;\n};\n\nexport async function postPing(payload: PingPayload) {\n  return apiPost<{ zone_id: number | null; recommendation: RecommendationResponse | null }>(\n    \"/api/pings\",\n    payload\n  );\n}\n\nexport async function fetchDriverState() {\n  return apiGet<DriverStateResponse>(\"/api/driver-state\");\n}\n\nexport async function fetchRecommendations(params?: {\n  lat?: number;\n  lon?: number;\n  k?: number;\n}) {\n  const qs = new URLSearchParams();\n  if (params?.lat !== undefined) qs.set(\"lat\", String(params.lat));\n  if (params?.lon !== undefined) qs.set(\"lon\", String(params.lon));\n  if (params?.k !== undefined) qs.set(\"k\", String(params.k));\n  const suffix = qs.toString();\n  return apiGet<RecommendationResponse>(\n    `/api/recommendations/next-spot${suffix ? `?${suffix}` : \"\"}`\n  );\n}\n\nexport type RideEventPayload = {\n  event_type: \"booking_received\" | \"ride_started\" | \"ride_completed\" | \"booking_cancelled\";\n  platform: \"ola\" | \"uber\";\n  pickup_lat?: number;\n  pickup_lon?: number;\n  drop_lat?: number;\n  drop_lon?: number;\n  surge_multiplier?: number;\n  promo_code?: string;\n};\n\nexport async function postRideEvent(payload: RideEventPayload) {\n  return apiPost<{ ok: boolean; event_id: number | null }>(\"/api/ride-events/ingest\", {\n    occurred_at: new Date().toISOString(),\n    ...payload,\n  });\n}\n\nexport type OpsDailyInput = {\n  day?: string;\n  platforms?: (\"ola\" | \"uber\")[];\n  idle_minutes?: number;\n  energy_kwh?: number;\n  energy_cost_inr?: number;\n  fuel_litres?: number;\n  fuel_cost_inr?: number;\n  tolls_parking_inr?: number;\n  notes?: string;\n};\n\nexport async function upsertOpsDaily(payload: OpsDailyInput) {\n  return apiPost<{\n    driver_id: string;\n    day: string;\n    idle_minutes: number | null;\n    energy_kwh: number | null;\n    energy_cost_inr: number | null;\n    tolls_parking_inr: number | null;\n    notes: string | null;\n  }>(\"/api/ops-daily/upsert\", payload);\n}\n\nexport type TripSyncPayload = {\n  booking_at?: string;\n  pickup_at: string;\n  drop_at: string;\n  pickup_lat: number;\n  pickup_lon: number;\n  drop_lat: number;\n  drop_lon: number;\n  distance_km: number;\n  fare_inr: number;\n  platform: \"ola\" | \"uber\";\n  surge_multiplier?: number;\n  promo_code?: string;\n  tip_inr?: number;\n};\n\nexport async function postTripSync(payload: TripSyncPayload) {\n  return apiPost<{ trip_id: number | null }>(\"/api/trips/sync\", payload);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAMA,eAAe,UAAa,GAAa;IACvC,IAAI,IAAI,MAAM,KAAK,KAAK,OAAO;IAC/B,MAAM,cAAc,IAAI,OAAO,CAAC,GAAG,CAAC;IACpC,IAAI,eAAe,YAAY,QAAQ,CAAC,qBAAqB;QAC3D,OAAQ,MAAM,IAAI,IAAI;IACxB;IACA,OAAO;AACT;AAEA,eAAe,eACb,GAAa;IAEb,IAAI,IAAI,EAAE,EAAE;QACV,MAAM,OAAO,MAAM,UAAa;QAChC,OAAO;YAAE;YAAM,OAAO;QAAK;IAC7B;IAEA,MAAM,UACJ,AAAC,MAAM,UACL,QACI;IAER,MAAM,QAAkB;QACtB,MAAM,SAAS,OAAO,QAAQ,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;QAClD,SAAS,SAAS,OAAO,WAAW,IAAI,UAAU;QAClD,SAAS,SAAS,OAAO;IAC3B;IACA,OAAO;QAAE,MAAM;QAAM;IAAM;AAC7B;AAEO,eAAe,OAAU,GAAW;IACzC,MAAM,MAAM,MAAM,MAAM,KAAK;QAC3B,OAAO;QACP,aAAa;IACf;IACA,OAAO,eAAkB;AAC3B;AAEO,eAAe,QAAwB,GAAW,EAAE,IAAO;IAChE,MAAM,MAAM,MAAM,MAAM,KAAK;QAC3B,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;QACrB,aAAa;IACf;IACA,OAAO,eAAkB;AAC3B;AA8DO,eAAe,SAAS,OAAoB;IACjD,OAAO,QACL,cACA;AAEJ;AAEO,eAAe;IACpB,OAAO,OAA4B;AACrC;AAEO,eAAe,qBAAqB,MAI1C;IACC,MAAM,KAAK,IAAI;IACf,IAAI,QAAQ,QAAQ,WAAW,GAAG,GAAG,CAAC,OAAO,OAAO,OAAO,GAAG;IAC9D,IAAI,QAAQ,QAAQ,WAAW,GAAG,GAAG,CAAC,OAAO,OAAO,OAAO,GAAG;IAC9D,IAAI,QAAQ,MAAM,WAAW,GAAG,GAAG,CAAC,KAAK,OAAO,OAAO,CAAC;IACxD,MAAM,SAAS,GAAG,QAAQ;IAC1B,OAAO,OACL,CAAC,8BAA8B,EAAE,SAAS,CAAC,CAAC,EAAE,QAAQ,GAAG,IAAI;AAEjE;AAaO,eAAe,cAAc,OAAyB;IAC3D,OAAO,QAAkD,2BAA2B;QAClF,aAAa,IAAI,OAAO,WAAW;QACnC,GAAG,OAAO;IACZ;AACF;AAcO,eAAe,eAAe,OAAsB;IACzD,OAAO,QAQJ,yBAAyB;AAC9B;AAkBO,eAAe,aAAa,OAAwB;IACzD,OAAO,QAAoC,mBAAmB;AAChE","debugId":null}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/hooks/useDriverState.ts"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useState } from \"react\";\nimport { DriverState, fetchDriverState } from \"@/lib/api-client\";\n\nexport function useDriverState(pollMs: number = 0) {\n  const [data, setData] = useState<DriverState | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const load = useCallback(async () => {\n    const { data, error } = await fetchDriverState();\n    if (error) {\n      setError(error.message);\n    } else {\n      setError(null);\n      setData(data);\n    }\n    setLoading(false);\n  }, []);\n\n  useEffect(() => {\n    load();\n    if (pollMs > 0) {\n      const id = setInterval(load, pollMs);\n      return () => clearInterval(id);\n    }\n  }, [load, pollMs]);\n\n  return { data, loading, error, refresh: load };\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAKO,SAAS,eAAe,SAAiB,CAAC;;IAC/C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAqB;IACrD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAgB;IAElD,MAAM,OAAO,IAAA,4KAAW;4CAAC;YACvB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,IAAA,2IAAgB;YAC9C,IAAI,OAAO;gBACT,SAAS,MAAM,OAAO;YACxB,OAAO;gBACL,SAAS;gBACT,QAAQ;YACV;YACA,WAAW;QACb;2CAAG,EAAE;IAEL,IAAA,0KAAS;oCAAC;YACR;YACA,IAAI,SAAS,GAAG;gBACd,MAAM,KAAK,YAAY,MAAM;gBAC7B;gDAAO,IAAM,cAAc;;YAC7B;QACF;mCAAG;QAAC;QAAM;KAAO;IAEjB,OAAO;QAAE;QAAM;QAAS;QAAO,SAAS;IAAK;AAC/C;GAzBgB","debugId":null}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/tracking/store.ts"],"sourcesContent":["\"use client\";\n\nimport { create } from \"zustand\";\nimport type { RecommendationResponse } from \"@/lib/api-client\";\n\nexport type PermissionStateMaybe = PermissionState | \"prompt\" | \"unsupported\";\n\nexport type TrackingFix = {\n  lat: number;\n  lon: number;\n  accuracy?: number | null;\n  speed?: number | null;\n  timestamp: number;\n};\n\ninterface TrackingState {\n  trackingOn: boolean;\n  permissionStatus: PermissionStateMaybe;\n  lastFix: TrackingFix | null;\n  lastPingAt: string | null;\n  lastRecommendation: RecommendationResponse | null;\n  error: string | null;\n  isDriving: boolean;\n  autoStartPending: boolean;\n  setTrackingOn: (next: boolean) => void;\n  setPermissionStatus: (status: PermissionStateMaybe) => void;\n  setLastFix: (fix: TrackingFix | null) => void;\n  setLastPingAt: (iso: string | null) => void;\n  setRecommendation: (rec: RecommendationResponse | null) => void;\n  setError: (message: string | null) => void;\n  setIsDriving: (next: boolean) => void;\n  setAutoStartPending: (pending: boolean) => void;\n}\n\nexport const useTrackingStore = create<TrackingState>((set) => ({\n  trackingOn: false,\n  permissionStatus: \"prompt\",\n  lastFix: null,\n  lastPingAt: null,\n  lastRecommendation: null,\n  error: null,\n  isDriving: false,\n  autoStartPending: true,\n  setTrackingOn: (trackingOn) => set({ trackingOn }),\n  setPermissionStatus: (permissionStatus) => set({ permissionStatus }),\n  setLastFix: (lastFix) => set({ lastFix }),\n  setLastPingAt: (lastPingAt) => set({ lastPingAt }),\n  setRecommendation: (lastRecommendation) => set({ lastRecommendation }),\n  setError: (error) => set({ error }),\n  setIsDriving: (isDriving) =>\n    set(() => ({\n      isDriving,\n      autoStartPending: isDriving ? false : true,\n    })),\n  setAutoStartPending: (autoStartPending) => set({ autoStartPending }),\n}));\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AAkCO,MAAM,mBAAmB,IAAA,qKAAM,EAAgB,CAAC,MAAQ,CAAC;QAC9D,YAAY;QACZ,kBAAkB;QAClB,SAAS;QACT,YAAY;QACZ,oBAAoB;QACpB,OAAO;QACP,WAAW;QACX,kBAAkB;QAClB,eAAe,CAAC,aAAe,IAAI;gBAAE;YAAW;QAChD,qBAAqB,CAAC,mBAAqB,IAAI;gBAAE;YAAiB;QAClE,YAAY,CAAC,UAAY,IAAI;gBAAE;YAAQ;QACvC,eAAe,CAAC,aAAe,IAAI;gBAAE;YAAW;QAChD,mBAAmB,CAAC,qBAAuB,IAAI;gBAAE;YAAmB;QACpE,UAAU,CAAC,QAAU,IAAI;gBAAE;YAAM;QACjC,cAAc,CAAC,YACb,IAAI,IAAM,CAAC;oBACT;oBACA,kBAAkB,YAAY,QAAQ;gBACxC,CAAC;QACH,qBAAqB,CAAC,mBAAqB,IAAI;gBAAE;YAAiB;IACpE,CAAC","debugId":null}},
    {"offset": {"line": 290, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst Card = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\r\n      \"rounded-2xl border bg-card text-card-foreground shadow-sm\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nCard.displayName = \"Card\";\r\n\r\nconst CardHeader = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\r\n    {...props}\r\n  />\r\n));\r\nCardHeader.displayName = \"CardHeader\";\r\n\r\nconst CardTitle = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLHeadingElement>\r\n>(({ className, ...props }, ref) => (\r\n  <h3\r\n    ref={ref}\r\n    className={cn(\r\n      \"text-2xl font-semibold leading-none tracking-tight\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nCardTitle.displayName = \"CardTitle\";\r\n\r\nconst CardDescription = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, ...props }, ref) => (\r\n  <p\r\n    ref={ref}\r\n    className={cn(\"text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n));\r\nCardDescription.displayName = \"CardDescription\";\r\n\r\nconst CardContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\r\n));\r\nCardContent.displayName = \"CardContent\";\r\n\r\nconst CardFooter = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"flex items-center p-6 pt-0\", className)}\r\n    {...props}\r\n  />\r\n));\r\nCardFooter.displayName = \"CardFooter\";\r\n\r\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AACA;;;;AAEA,MAAM,qBAAO,2KAAgB,MAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,6DACA;QAED,GAAG,KAAK;;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,2KAAgB,OAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,2KAAgB,OAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,sDACA;QAED,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,2KAAgB,OAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAI,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,2KAAgB,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 397, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/NextZonesPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { RecommendationResponse, fetchRecommendations } from \"@/lib/api-client\";\nimport { useDriverState } from \"@/lib/hooks/useDriverState\";\nimport { useTrackingStore } from \"@/lib/tracking/store\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowUpRight, MapPin, RefreshCw } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\n\ninterface NextZonesPanelProps {\n  trackingOn: boolean;\n  seedRecommendation?: RecommendationResponse | null;\n}\n\nconst STALE_MS = 45_000;\nconst AUTO_REFRESH_MS = 180_000; // 3 minutes\n\nexport function NextZonesPanel({ trackingOn, seedRecommendation }: NextZonesPanelProps) {\n  const { data: driverState } = useDriverState();\n  const [recommendation, setRecommendation] = useState<RecommendationResponse | null>(\n    seedRecommendation ?? null\n  );\n  const [loading, setLoading] = useState(!seedRecommendation);\n  const [error, setError] = useState<string | null>(null);\n  const setTrackingRecommendation = useTrackingStore((s) => s.setRecommendation);\n  const lastFix = useTrackingStore((s) => s.lastFix);\n  const lastFixRef = useRef(lastFix);\n  const lastFetchAtRef = useRef(0);\n\n  useEffect(() => {\n    lastFixRef.current = lastFix;\n  }, [lastFix]);\n\n  const syncRecommendation = useCallback(\n    (next: RecommendationResponse | null) => {\n      setRecommendation(next);\n      setTrackingRecommendation(next);\n    },\n    [setTrackingRecommendation]\n  );\n\n  const hydrateFromState = useCallback(() => {\n    if (driverState?.recommendation) {\n      const rec = driverState.recommendation;\n      if (Date.now() - Date.parse(rec.computed_at) < STALE_MS) {\n        syncRecommendation(rec);\n        setError(null);\n        setLoading(false);\n        return true;\n      }\n    }\n    return false;\n  }, [driverState, syncRecommendation]);\n\n  const fetchLatest = useCallback(async () => {\n    const loc = lastFixRef.current;\n    \n    // GATING: Do not fetch if we don't have a valid location\n    if (!loc || typeof loc.accuracy !== \"number\" || loc.accuracy > 100) {\n      setError(\n        \"Waiting for GPS fix (accuracy <100m). Move outdoors for better signal.\"\n      );\n      setLoading(false);\n      return;\n    }\n\n    lastFetchAtRef.current = Date.now();\n    setLoading(true);\n    const params: { k: number; lat: number; lon: number } = {\n      k: 3,\n      lat: loc.lat,\n      lon: loc.lon,\n    };\n\n    const { data, error } = await fetchRecommendations(params);\n    if (error) {\n      if (error.code === \"NO_STATE\") {\n        setError(\n          \"We couldn't get your current location. Enable live tracking or share location to see zone recommendations.\"\n        );\n      } else {\n        setError(error.message);\n      }\n    } else {\n      setError(null);\n      syncRecommendation(data);\n    }\n    setLoading(false);\n  }, [syncRecommendation]);\n\n  useEffect(() => {\n    if (!seedRecommendation) {\n      if (!hydrateFromState()) {\n        fetchLatest();\n      }\n    }\n  }, [seedRecommendation, hydrateFromState, fetchLatest]);\n\n  useEffect(() => {\n    hydrateFromState();\n  }, [driverState, hydrateFromState]);\n\n  useEffect(() => {\n    if (\n      seedRecommendation &&\n      (!recommendation ||\n        seedRecommendation.computed_at !== recommendation.computed_at)\n    ) {\n      syncRecommendation(seedRecommendation);\n    }\n  }, [seedRecommendation, recommendation, syncRecommendation]);\n\n  const runAutoRefresh = useCallback(() => {\n    const now = Date.now();\n    if (now - lastFetchAtRef.current < AUTO_REFRESH_MS) {\n      return;\n    }\n    void fetchLatest();\n  }, [fetchLatest]);\n\n  useEffect(() => {\n    if (!trackingOn) return;\n    runAutoRefresh();\n    const id = setInterval(runAutoRefresh, AUTO_REFRESH_MS);\n    return () => clearInterval(id);\n  }, [trackingOn, runAutoRefresh]);\n\n  const empty =\n    !loading && !error && (!recommendation || !recommendation.top || recommendation.top.length === 0);\n  const waitingForGps =\n    trackingOn &&\n    (!lastFix || typeof lastFix.accuracy !== \"number\" || lastFix.accuracy > 100);\n  const computedAgo = recommendation?.computed_at\n    ? formatDistanceToNow(new Date(recommendation.computed_at), { addSuffix: true })\n    : null;\n\n  const context = recommendation?.context as { traffic_speed_idx?: number } | undefined;\n  const avgTrafficIdx =\n    typeof context?.traffic_speed_idx === \"number\" ? context.traffic_speed_idx : null;\n  const trafficSource = recommendation?.traffic_source ?? null;\n  const headerMeta = useMemo(() => {\n    const parts = [\n      computedAgo ? `Refreshed ${computedAgo}` : \"Refreshed just now\",\n      describeTrafficSource(trafficSource),\n      avgTrafficIdx !== null ? `Avg traffic ${describeTrafficLevel(avgTrafficIdx)}` : null,\n    ];\n    return parts.filter(Boolean).join(\" | \");\n  }, [computedAgo, trafficSource, avgTrafficIdx]);\n\n  return (\n    <Card className=\"shadow-sm\">\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0\">\n        <div>\n          <CardTitle className=\"text-base font-semibold\">Next best zones</CardTitle>\n          <p className=\"text-xs text-muted-foreground\">{headerMeta}</p>\n        </div>\n        <Button variant=\"ghost\" size=\"icon\" aria-label=\"Refresh\" onClick={fetchLatest}>\n          <RefreshCw className=\"h-4 w-4\" />\n        </Button>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {loading && (\n          <div className=\"space-y-3\">\n            {[0, 1, 2].map((idx) => (\n              <div key={idx} className=\"rounded-xl border p-3\">\n                <div className=\"h-4 w-1/2 animate-pulse rounded bg-muted\" />\n                <div className=\"mt-2 h-3 w-1/3 animate-pulse rounded bg-muted\" />\n              </div>\n            ))}\n          </div>\n        )}\n\n        {!loading && error && (\n          <div className=\"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-700\">\n            {error}\n            <Button size=\"sm\" variant=\"secondary\" className=\"mt-3\" onClick={fetchLatest}>\n              Try again\n            </Button>\n          </div>\n        )}\n\n        {empty && (\n          <div className=\"rounded-xl border border-dashed p-4 text-sm text-muted-foreground\">\n            {waitingForGps ? (\n              <div>\n                <p className=\"font-medium\">Waiting for GPS fix...</p>\n                <p className=\"mt-1 text-xs\">\n                  Move outdoors for clear sky view. Accuracy must be &lt;100m.\n                </p>\n                {lastFix?.accuracy && (\n                  <p className=\"mt-1 text-xs text-amber-600\">\n                    Current accuracy: {lastFix.accuracy.toFixed(0)}m\n                  </p>\n                )}\n              </div>\n            ) : (\n              \"We'll start suggesting zones once we see your location.\"\n            )}\n          </div>\n        )}\n\n        {!loading && !error && recommendation?.top?.length ? (\n          <div className=\"space-y-3\">\n            {recommendation.top.map((zone) => (\n              <ZoneCard key={zone.zone_id} zone={zone} />\n            ))}\n          </div>\n        ) : null}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction ZoneCard({ zone }: { zone: RecommendationResponse[\"top\"][number] }) {\n  const hasScore = typeof zone.score === \"number\";\n  const hasEta = typeof zone.eta_min === \"number\";\n  const hasDistance = typeof zone.distance_km === \"number\";\n  const distanceLabel = hasDistance ? `${zone.distance_km!.toFixed(1)} km` : \"Distance n/a\";\n  const etaLabel = hasEta ? `${zone.eta_min} min` : \"ETA n/a\";\n  const scoreLabel = hasScore ? zone.score!.toFixed(2) : \"Score n/a\";\n  const barWidth = hasScore ? `${Math.min(100, Math.round(zone.score! * 100))}%` : \"0%\";\n\n  const handleNavigate = () => {\n    const q = encodeURIComponent(`${zone.zone_name} Patna`);\n    window.open(`https://www.google.com/maps/search/?api=1&query=${q}`, \"_blank\");\n  };\n\n  const trafficLabel =\n    typeof zone.traffic_speed_idx === \"number\"\n      ? describeTrafficLevel(zone.traffic_speed_idx)\n      : null;\n\n  return (\n    <div className=\"rounded-2xl border p-4\">\n      <div className=\"flex items-start justify-between gap-3\">\n        <div>\n          <div className=\"flex items-center gap-2 text-base font-semibold\">\n            <MapPin className=\"h-4 w-4 text-primary\" />\n            {zone.zone_name}\n          </div>\n          <p className=\"text-xs text-muted-foreground\">\n            {distanceLabel} | {etaLabel} | {scoreLabel}\n          </p>\n          {trafficLabel && (\n            <p className=\"text-xs text-muted-foreground\">Traffic: {trafficLabel}</p>\n          )}\n        </div>\n        <Button size=\"sm\" variant=\"secondary\" onClick={handleNavigate}>\n          Navigate\n          <ArrowUpRight className=\"ml-1 h-3 w-3\" />\n        </Button>\n      </div>\n      <div className=\"mt-3 text-sm text-muted-foreground\">{zone.reason}</div>\n      <div className=\"mt-3 h-1.5 rounded-full bg-muted\">\n        <div className=\"h-full rounded-full bg-emerald-500\" style={{ width: barWidth }} />\n      </div>\n    </div>\n  );\n}\n\nfunction describeTrafficSource(source?: string | null) {\n  if (source === \"google\") return \"Google live traffic\";\n  if (source === \"cache\") return \"Cached traffic snapshot\";\n  if (source === \"fallback\") return \"Estimated traffic\";\n  return null;\n}\n\nfunction describeTrafficLevel(idx: number) {\n  if (idx >= 0.85) return \"Smooth\";\n  if (idx >= 0.65) return \"Moderate\";\n  if (idx >= 0.4) return \"Busy\";\n  return \"Heavy\";\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 919, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/TrafficPreviewMap.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport Script from \"next/script\";\r\nimport type { RecommendationZone } from \"@/lib/api-client\";\r\nimport type { TrackingFix } from \"@/lib/tracking/store\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\ndeclare global {\r\n  interface Window {\r\n    google?: any;\r\n  }\r\n}\r\n\r\ninterface TrafficPreviewMapProps {\r\n  currentLocation: TrackingFix | null;\r\n  recommendedZones?: RecommendationZone[] | null;\r\n}\r\n\r\nconst DEFAULT_CENTER = { lat: 25.617, lon: 85.141 };\r\nconst MAPS_BROWSER_KEY = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;\r\nconst MAX_ACCURACY_METERS = 200;\r\n\r\nexport function TrafficPreviewMap({\n  currentLocation,\n  recommendedZones,\n}: TrafficPreviewMapProps) {\n  const mapRef = useRef<HTMLDivElement | null>(null);\r\n  const [scriptLoaded, setScriptLoaded] = useState(false);\r\n  const [map, setMap] = useState<any>(null);\r\n  const [userLocation, setUserLocation] = useState<{ lat: number; lon: number; accuracy: number } | null>(null);\r\n  const [locationError, setLocationError] = useState<string | null>(null);\r\n  const [isRequestingLocation, setIsRequestingLocation] = useState(false);\r\n  const markersRef = useRef<any[]>([]);\r\n  const locationWatchRef = useRef<number | null>(null);\r\n  const zones = useMemo(\r\n    () => (recommendedZones ?? []).filter((zone) => typeof zone.lat === \"number\" && typeof zone.lon === \"number\"),\r\n    [recommendedZones]\r\n  );\r\n\r\n  const requestLocation = useCallback(() => {\r\n    if (typeof window === \"undefined\" || !navigator.geolocation) {\r\n      setLocationError(\"Geolocation is not supported by your browser\");\r\n      return;\r\n    }\r\n\r\n    setIsRequestingLocation(true);\r\n    if (locationWatchRef.current !== null) {\r\n      navigator.geolocation.clearWatch(locationWatchRef.current);\r\n    }\r\n\r\n    locationWatchRef.current = navigator.geolocation.watchPosition(\r\n      (position) => {\r\n        const accuracy =\r\n          typeof position.coords.accuracy === \"number\" ? position.coords.accuracy : null;\r\n        if (!Number.isFinite(accuracy) || accuracy === null || accuracy > MAX_ACCURACY_METERS) {\n          setLocationError(\"Waiting for a precise GPS fix (move outdoors if possible).\");\n          setIsRequestingLocation(false);\n          return;\n        }\n        setUserLocation({\r\n          lat: position.coords.latitude,\r\n          lon: position.coords.longitude,\r\n          accuracy,\r\n        });\r\n        setLocationError(null);\r\n        setIsRequestingLocation(false);\r\n      },\r\n      (error) => {\r\n        setIsRequestingLocation(false);\r\n        setLocationError(describeGeoError(error));\r\n      },\r\n      {\r\n        enableHighAccuracy: true,\r\n        maximumAge: 0,\r\n        timeout: 15_000,\r\n      }\r\n    );\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    requestLocation();\r\n    return () => {\r\n      if (locationWatchRef.current !== null && navigator.geolocation) {\r\n        navigator.geolocation.clearWatch(locationWatchRef.current);\r\n      }\r\n    };\r\n  }, [requestLocation]);\r\n\r\n  useEffect(() => {\r\n    if (!MAPS_BROWSER_KEY || !scriptLoaded || map || !mapRef.current) return;\r\n    const google = window.google;\r\n    if (!google?.maps) return;\r\n    \r\n    const effectiveLocation = currentLocation || userLocation;\r\n    const initialCenter = effectiveLocation\r\n      ? { lat: effectiveLocation.lat, lng: effectiveLocation.lon }\r\n      : { lat: DEFAULT_CENTER.lat, lng: DEFAULT_CENTER.lon };\r\n    \r\n    const instance = new google.maps.Map(mapRef.current, {\r\n      center: initialCenter,\r\n      zoom: 13,\r\n      disableDefaultUI: true,\r\n    });\r\n    const trafficLayer = new google.maps.TrafficLayer();\r\n    trafficLayer.setMap(instance);\r\n    setMap(instance);\r\n    return () => {\r\n      trafficLayer.setMap(null);\r\n    };\r\n  }, [scriptLoaded, map, currentLocation, userLocation]);\r\n\r\n  useEffect(() => {\r\n    if (!map) return;\r\n    const google = window.google;\r\n    if (!google?.maps) return;\r\n\r\n    markersRef.current.forEach((marker) => marker.setMap(null));\r\n    markersRef.current = [];\r\n\r\n    const bounds = new google.maps.LatLngBounds();\r\n    let hasBounds = false;\r\n\r\n    const effectiveLocation = currentLocation || userLocation;\r\n    if (effectiveLocation) {\r\n      const marker = new google.maps.Marker({\r\n        map,\r\n        position: { lat: effectiveLocation.lat, lng: effectiveLocation.lon },\r\n        title: \"You\",\r\n        icon: {\r\n          path: google.maps.SymbolPath.CIRCLE,\r\n          scale: 7,\r\n          fillColor: \"#10b981\",\r\n          fillOpacity: 1,\r\n          strokeColor: \"#ffffff\",\r\n          strokeWeight: 2,\r\n        },\r\n      });\r\n      markersRef.current.push(marker);\r\n      bounds.extend(marker.getPosition()!);\r\n      hasBounds = true;\r\n      map.panTo(marker.getPosition()!);\r\n    }\r\n\r\n    zones.forEach((zone, idx) => {\r\n      const marker = new google.maps.Marker({\r\n        map,\r\n        position: { lat: zone.lat, lng: zone.lon },\r\n        label: `${idx + 1}`,\r\n        title: zone.zone_name,\r\n      });\r\n      markersRef.current.push(marker);\r\n      bounds.extend(marker.getPosition()!);\r\n      hasBounds = true;\r\n    });\r\n\r\n    if (hasBounds) {\r\n      map.fitBounds(bounds, 48);\r\n    }\r\n  }, [map, zones, currentLocation, userLocation]);\r\n\r\n  if (!MAPS_BROWSER_KEY) {\r\n    return (\r\n      <Card className=\"shadow-sm\">\r\n        <CardHeader>\r\n          <CardTitle className=\"text-base font-semibold\">Live map preview</CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"text-sm text-muted-foreground\">\r\n          Add <code>NEXT_PUBLIC_GOOGLE_MAPS_API_KEY</code> to load the in-app map preview.\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Card className=\"shadow-sm\">\r\n      <CardHeader className=\"space-y-1\">\r\n        <CardTitle className=\"text-base font-semibold\">Live map preview</CardTitle>\r\n        <p className=\"text-xs text-muted-foreground\">\r\n          Browser geolocation + Google Maps traffic overlay (visual only)\r\n        </p>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-3\">\r\n        {locationError && (\r\n          <div className=\"rounded-lg bg-amber-50 px-3 py-2 text-xs text-amber-800\">\r\n            {locationError}\r\n          </div>\r\n        )}\r\n        <div className=\"flex justify-end\">\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            onClick={requestLocation}\r\n            disabled={isRequestingLocation}\r\n          >\r\n            {isRequestingLocation ? \"Requesting location...\" : \"Use my current location\"}\r\n          </Button>\r\n        </div>\r\n        <div className=\"h-64 w-full overflow-hidden rounded-2xl border\" ref={mapRef} />\r\n        {zones.length > 0 ? (\r\n          <div className=\"text-xs text-muted-foreground\">\r\n            {zones.slice(0, 3).map((zone, idx) => (\r\n              <div key={zone.zone_id}>\r\n                #{idx + 1} {zone.zone_name}: {zone.eta_min.toFixed(1)} min,{\" \"}\r\n                {zone.distance_km.toFixed(1)} km\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-xs text-muted-foreground\">\r\n            Start tracking to see nearby recommended zones on the map.\r\n          </p>\r\n        )}\r\n      </CardContent>\r\n      <Script\r\n        id=\"google-maps-js\"\r\n        src={`https://maps.googleapis.com/maps/api/js?key=${MAPS_BROWSER_KEY}&libraries=visualization`}\r\n        strategy=\"lazyOnload\"\r\n        onLoad={() => setScriptLoaded(true)}\r\n      />\r\n    </Card>\r\n  );\r\n}\n\nfunction describeGeoError(error: GeolocationPositionError) {\n  switch (error.code) {\n    case error.PERMISSION_DENIED:\n      return \"Location permission denied. Please enable location access in your browser settings.\";\n    case error.POSITION_UNAVAILABLE:\n      return \"GPS signal unavailable. Move outdoors for a clearer sky view.\";\n    case error.TIMEOUT:\n      return \"Timed out while fetching your location. Try again from an open area.\";\n    default:\n      return \"Unable to retrieve your location\";\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1249, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/RideControls.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, useState } from \"react\";\nimport { Button, type ButtonProps } from \"@/components/ui/button\";\nimport { postRideEvent } from \"@/lib/api-client\";\nimport { useTrackingStore, type TrackingFix } from \"@/lib/tracking/store\";\nimport { toast } from \"sonner\";\n\ntype RideEventAction =\n  | \"booking_received\"\n  | \"ride_started\"\n  | \"ride_completed\"\n  | \"booking_cancelled\";\n\nconst events: Array<{ type: RideEventAction; label: string; variant: ButtonProps[\"variant\"] }> = [\n  { type: \"booking_received\", label: \"Got a Ride\", variant: \"default\" },\n  { type: \"ride_started\", label: \"Ride Started\", variant: \"secondary\" },\n  { type: \"ride_completed\", label: \"Ride Completed\", variant: \"outline\" },\n  { type: \"booking_cancelled\", label: \"Booking Cancelled\", variant: \"ghost\" },\n] as const;\n\ntype EventConfig = (typeof events)[number];\n\ninterface RideControlsProps {\n  lastFix: TrackingFix | null;\n}\n\nexport function RideControls({ lastFix }: RideControlsProps) {\n  const [platform, setPlatform] = useState<\"ola\" | \"uber\">(\"ola\");\n  const [activeEvent, setActiveEvent] = useState<EventConfig | null>(null);\n  const [submitting, setSubmitting] = useState(false);\n  const setIsDriving = useTrackingStore((s) => s.setIsDriving);\n\n  const coordsCopy = useMemo(() => {\n    if (!lastFix) return \"No live GPS\";\n    return `${lastFix.lat.toFixed(4)}, ${lastFix.lon.toFixed(4)}`;\n  }, [lastFix]);\n\n  const confirmEvent = async () => {\n    if (!activeEvent) return;\n    setSubmitting(true);\n    const payload: Parameters<typeof postRideEvent>[0] = {\n      event_type: activeEvent.type,\n      platform,\n    };\n    if (lastFix) {\n      if (activeEvent.type === \"ride_completed\") {\n        payload.drop_lat = lastFix.lat;\n        payload.drop_lon = lastFix.lon;\n      } else {\n        payload.pickup_lat = lastFix.lat;\n        payload.pickup_lon = lastFix.lon;\n      }\n    }\n    const { error } = await postRideEvent(payload);\n    setSubmitting(false);\n    setActiveEvent(null);\n    if (error) {\n      toast.error(error.message);\n    } else {\n      toast.success(`${copyForEvent(activeEvent.type)} logged`);\n      updateDrivingState(activeEvent.type, setIsDriving);\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between rounded-2xl border bg-white/60 px-4 py-3 shadow-sm\">\n        <div>\n          <p className=\"text-xs uppercase text-muted-foreground\">Current platform</p>\n          <div className=\"mt-1 inline-flex gap-2 rounded-full bg-muted p-1\">\n            {[\"ola\", \"uber\"].map((provider) => (\n              <button\n                key={provider}\n                type=\"button\"\n                onClick={() => setPlatform(provider as \"ola\" | \"uber\")}\n                className={`rounded-full px-3 py-1 text-xs font-semibold capitalize transition ${\n                  platform === provider\n                    ? \"bg-white text-foreground shadow\"\n                    : \"text-muted-foreground\"\n                }`}\n              >\n                {provider}\n              </button>\n            ))}\n          </div>\n        </div>\n        <div className=\"text-right text-xs text-muted-foreground\">\n          <p>Last fix</p>\n          <p className=\"font-semibold text-foreground\">{coordsCopy}</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-3\">\n        {events.map((event) => (\n          <Button\n            key={event.type}\n            className={event.type === \"booking_received\" ? \"col-span-2 h-14 text-base\" : \"h-12\"}\n            variant={event.variant}\n            onClick={() => setActiveEvent(event)}\n          >\n            {event.label}\n          </Button>\n        ))}\n      </div>\n\n      <p className=\"text-xs text-muted-foreground\">\n        Your live location is only used to suggest better zones and calculate your performance. It stays private to you.\n      </p>\n\n      {activeEvent && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 pb-8\">\n          <div className=\"w-full max-w-md rounded-3xl bg-bg p-5 shadow-2xl\">\n            <p className=\"text-sm font-semibold text-muted-foreground\">Confirm action</p>\n            <h3 className=\"text-2xl font-semibold\">{activeEvent.label}</h3>\n            <p className=\"mt-2 text-sm text-muted-foreground\">\n              Platform: <span className=\"font-medium capitalize\">{platform}</span>\n            </p>\n            <p className=\"text-sm text-muted-foreground\">\n              Location: <span className=\"font-medium\">{coordsCopy}</span>\n            </p>\n            <div className=\"mt-5 flex gap-3\">\n              <Button variant=\"outline\" className=\"flex-1\" onClick={() => setActiveEvent(null)}>\n                Cancel\n              </Button>\n              <Button className=\"flex-1\" onClick={confirmEvent} disabled={submitting}>\n                {submitting ? \"Saving.\" : \"Confirm\"}\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction updateDrivingState(action: RideEventAction, setIsDriving: (next: boolean) => void) {\n  switch (action) {\n    case \"ride_started\":\n      setIsDriving(true);\n      return;\n    case \"ride_completed\":\n    case \"booking_cancelled\":\n    case \"booking_received\":\n      setIsDriving(false);\n      return;\n    default:\n      return;\n  }\n}\n\nfunction copyForEvent(type: EventConfig[\"type\"]) {\n  switch (type) {\n    case \"booking_received\":\n      return \"Booking\";\n    case \"ride_started\":\n      return \"Ride start\";\n    case \"ride_completed\":\n      return \"Ride completion\";\n    case \"booking_cancelled\":\n      return \"Cancellation\";\n    default:\n      return \"Event\";\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1575, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/GpsAccuracyBadge.tsx"],"sourcesContent":["\"use client\";\n\nimport { cn } from \"@/lib/utils\";\n\ninterface GpsAccuracyBadgeProps {\n  accuracy?: number | null;\n  trackingOn: boolean;\n}\n\nexport function GpsAccuracyBadge({ accuracy, trackingOn }: GpsAccuracyBadgeProps) {\n  let label = trackingOn ? \"GPS: waiting for fix\" : \"GPS: paused\";\n  let tone = \"bg-muted text-muted-foreground\";\n\n  if (typeof accuracy === \"number\" && Number.isFinite(accuracy)) {\n    const rounded = Math.max(0, Math.round(accuracy));\n    if (rounded <= 30) {\n      label = `GPS: ${rounded}m accuracy`;\n      tone = \"bg-emerald-100 text-emerald-900\";\n    } else if (rounded <= 100) {\n      label = `GPS: ${rounded}m (ok)`;\n      tone = \"bg-amber-100 text-amber-900\";\n    } else {\n      label = `GPS: ${rounded}m (weak) - move outdoors`;\n      tone = \"bg-rose-100 text-rose-900\";\n    }\n  } else if (trackingOn) {\n    tone = \"bg-muted text-muted-foreground\";\n  }\n\n  return (\n    <div className={cn(\"inline-flex rounded-full px-3 py-1 text-xs font-semibold\", tone)}>\n      {label}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AASO,SAAS,iBAAiB,EAAE,QAAQ,EAAE,UAAU,EAAyB;IAC9E,IAAI,QAAQ,aAAa,yBAAyB;IAClD,IAAI,OAAO;IAEX,IAAI,OAAO,aAAa,YAAY,OAAO,QAAQ,CAAC,WAAW;QAC7D,MAAM,UAAU,KAAK,GAAG,CAAC,GAAG,KAAK,KAAK,CAAC;QACvC,IAAI,WAAW,IAAI;YACjB,QAAQ,CAAC,KAAK,EAAE,QAAQ,UAAU,CAAC;YACnC,OAAO;QACT,OAAO,IAAI,WAAW,KAAK;YACzB,QAAQ,CAAC,KAAK,EAAE,QAAQ,MAAM,CAAC;YAC/B,OAAO;QACT,OAAO;YACL,QAAQ,CAAC,KAAK,EAAE,QAAQ,wBAAwB,CAAC;YACjD,OAAO;QACT;IACF,OAAO,IAAI,YAAY;QACrB,OAAO;IACT;IAEA,qBACE,6LAAC;QAAI,WAAW,IAAA,qHAAE,EAAC,4DAA4D;kBAC5E;;;;;;AAGP;KAzBgB","debugId":null}},
    {"offset": {"line": 1621, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/offline-queue.ts"],"sourcesContent":["import { openDB, IDBPDatabase } from \"idb\";\r\n\r\nconst DB = \"ride-db\";\r\nconst STORE = \"events\";\r\n\r\nasync function db() { \r\n  return openDB(DB, 1, { \r\n    upgrade(d: IDBPDatabase) { \r\n      d.createObjectStore(STORE, { keyPath: \"id\", autoIncrement: true }); \r\n    } \r\n  }); \r\n}\r\n\r\nexport async function enqueue(e: any) { \r\n  (await db()).add(STORE, { ...e, created_at: Date.now() }); \r\n}\r\n\r\nexport async function drain(flush: (e: any) => Promise<boolean>) {\r\n  const d = await db();\r\n  const tx = d.transaction(STORE, \"readwrite\");\r\n  const s = tx.store;\r\n  let c = await s.openCursor();\r\n  while (c) { \r\n    const ok = await flush(c.value); \r\n    if (ok) await c.delete(); \r\n    c = await c.continue(); \r\n  }\r\n  await tx.done;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,KAAK;AACX,MAAM,QAAQ;AAEd,eAAe;IACb,OAAO,IAAA,kJAAM,EAAC,IAAI,GAAG;QACnB,SAAQ,CAAe;YACrB,EAAE,iBAAiB,CAAC,OAAO;gBAAE,SAAS;gBAAM,eAAe;YAAK;QAClE;IACF;AACF;AAEO,eAAe,QAAQ,CAAM;IAClC,CAAC,MAAM,IAAI,EAAE,GAAG,CAAC,OAAO;QAAE,GAAG,CAAC;QAAE,YAAY,KAAK,GAAG;IAAG;AACzD;AAEO,eAAe,MAAM,KAAmC;IAC7D,MAAM,IAAI,MAAM;IAChB,MAAM,KAAK,EAAE,WAAW,CAAC,OAAO;IAChC,MAAM,IAAI,GAAG,KAAK;IAClB,IAAI,IAAI,MAAM,EAAE,UAAU;IAC1B,MAAO,EAAG;QACR,MAAM,KAAK,MAAM,MAAM,EAAE,KAAK;QAC9B,IAAI,IAAI,MAAM,EAAE,MAAM;QACtB,IAAI,MAAM,EAAE,QAAQ;IACtB;IACA,MAAM,GAAG,IAAI;AACf","debugId":null}},
    {"offset": {"line": 1666, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/hooks/useLiveTracking.ts"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { postPing, RecommendationResponse } from \"@/lib/api-client\";\nimport { useTrackingStore } from \"@/lib/tracking/store\";\nimport { enqueue } from \"@/lib/offline-queue\";\nimport { toast } from \"sonner\";\n\nconst MIN_DISTANCE_DELTA = 30; // meters\nconst MIN_INTERVAL_MS = 5000;\nconst MAX_ACCURACY_METERS = 200;\nconst ACCURACY_IMPROVEMENT_FACTOR = 0.5;\n\ntype GeoPermissionDescriptor = { name: \"geolocation\" };\n\nexport function useLiveTracking() {\n  const trackingOn = useTrackingStore((s) => s.trackingOn);\n  const permissionStatus = useTrackingStore((s) => s.permissionStatus);\n  const lastFix = useTrackingStore((s) => s.lastFix);\n  const lastPingAt = useTrackingStore((s) => s.lastPingAt);\n  const lastRecommendation = useTrackingStore((s) => s.lastRecommendation);\n  const error = useTrackingStore((s) => s.error);\n  const autoStartPending = useTrackingStore((s) => s.autoStartPending);\n  const setTrackingOn = useTrackingStore((s) => s.setTrackingOn);\n  const setPermissionStatus = useTrackingStore((s) => s.setPermissionStatus);\n  const setLastFix = useTrackingStore((s) => s.setLastFix);\n  const setLastPingAt = useTrackingStore((s) => s.setLastPingAt);\n  const setRecommendation = useTrackingStore((s) => s.setRecommendation);\n  const setError = useTrackingStore((s) => s.setError);\n  const setAutoStartPending = useTrackingStore((s) => s.setAutoStartPending);\n  const watchId = useRef<number | null>(null);\n  const lastSentTimestamp = useRef<number>(0);\n  const lastBroadcastPosition = useRef<GeolocationPosition | null>(null);\n\n  const updatePermissionFromNavigator = useCallback(async () => {\n    try {\n      if (navigator.permissions?.query) {\n        const result = await navigator.permissions.query(\n          { name: \"geolocation\" } as PermissionDescriptor & GeoPermissionDescriptor\n        );\n        setPermissionStatus(result.state);\n        result.onchange = () => setPermissionStatus(result.state);\n      } else {\n        setPermissionStatus(\"unsupported\");\n      }\n    } catch (err) {\n      console.warn(\"permission query failed\", err);\n      setPermissionStatus(\"unsupported\");\n    }\n  }, [setPermissionStatus]);\n\n  useEffect(() => {\n    updatePermissionFromNavigator();\n  }, [updatePermissionFromNavigator]);\n\n  const stopWatch = useCallback(() => {\n    if (watchId.current !== null && typeof navigator !== \"undefined\" && navigator.geolocation) {\n      navigator.geolocation.clearWatch(watchId.current);\n      watchId.current = null;\n    }\n  }, []);\n\n  const handlePingSuccess = useCallback(\n    (recommendation: RecommendationResponse | null, timestampIso: string) => {\n      setLastPingAt(timestampIso);\n      if (recommendation) {\n        setRecommendation(recommendation);\n      }\n      setError(null);\n    },\n    [setLastPingAt, setRecommendation, setError]\n  );\n\n  const sendPing = useCallback(\n    async (position: GeolocationPosition) => {\n      const accuracy =\n        typeof position.coords.accuracy === \"number\" ? position.coords.accuracy : null;\n      if (!Number.isFinite(accuracy) || accuracy === null || accuracy > MAX_ACCURACY_METERS) {\n        setError(\"GPS accuracy is weak (>200m). Move outdoors for a clear fix.\");\n        return;\n      }\n\n      const speedKmh =\n        typeof position.coords.speed === \"number\" && Number.isFinite(position.coords.speed)\n          ? position.coords.speed * 3.6\n          : null;\n\n      setLastFix({\n        lat: position.coords.latitude,\n        lon: position.coords.longitude,\n        accuracy,\n        speed: speedKmh,\n        timestamp: position.timestamp,\n      });\n      setError(null);\n\n      const now = Date.now();\n      const last = lastBroadcastPosition.current;\n      let accuracyImproved = false;\n      if (\n        last &&\n        typeof last.coords.accuracy === \"number\" &&\n        Number.isFinite(last.coords.accuracy)\n      ) {\n        accuracyImproved = accuracy <= last.coords.accuracy * ACCURACY_IMPROVEMENT_FACTOR;\n      }\n\n      if (\n        last &&\n        distanceMeters(last.coords, position.coords) < MIN_DISTANCE_DELTA &&\n        now - lastSentTimestamp.current < MIN_INTERVAL_MS &&\n        !accuracyImproved\n      ) {\n        return;\n      }\n\n      lastBroadcastPosition.current = position;\n      lastSentTimestamp.current = now;\n\n      const payload = {\n        lat: position.coords.latitude,\n        lon: position.coords.longitude,\n        ts: new Date(position.timestamp).toISOString(),\n        accuracy_m: accuracy,\n        speed_kmh: speedKmh ?? undefined,\n      };\n\n      const { data, error } = await postPing(payload);\n      if (error) {\n        setError(error.message);\n        await enqueue(payload);\n        toast.error(\"Could not sync live location. We'll retry soon.\");\n        return;\n      }\n\n      handlePingSuccess(data?.recommendation ?? null, payload.ts ?? new Date().toISOString());\n    },\n    [setLastFix, handlePingSuccess, setError]\n  );\n\n  const requestPermission = useCallback(async () => {\n    try {\n      const { state } = await navigator.permissions.query(\n        { name: \"geolocation\" } as PermissionDescriptor & GeoPermissionDescriptor\n      );\n      setPermissionStatus(state);\n      if (state === \"denied\") {\n        toast.error(\"Location permission denied. Enable it in browser settings.\");\n        return false;\n      }\n      if (state === \"prompt\") {\n        await new Promise<GeolocationPosition>((resolve, reject) => {\n          navigator.geolocation.getCurrentPosition(resolve, reject, {\n            enableHighAccuracy: true,\n            timeout: 15000,\n            maximumAge: 0,\n          });\n        });\n        setPermissionStatus(\"granted\");\n      }\n      return true;\n    } catch (error) {\n      console.error(\"permission request failed\", error);\n      setPermissionStatus(\"unsupported\");\n      return false;\n    }\n  }, [setPermissionStatus]);\n\n  const toggleTracking = useCallback(async () => {\n    if (trackingOn) {\n      stopWatch();\n      setTrackingOn(false);\n      return;\n    }\n\n    const granted = await requestPermission();\n    if (!granted) {\n      setError(\"Location permission required for live tracking\");\n      return;\n    }\n\n    setTrackingOn(true);\n  }, [trackingOn, requestPermission, stopWatch, setTrackingOn, setError]);\n\n  useEffect(() => {\n    if (!trackingOn && autoStartPending) {\n      void toggleTracking();\n      setAutoStartPending(false);\n    }\n  }, [trackingOn, autoStartPending, toggleTracking, setAutoStartPending]);\n\n  useEffect(() => {\n    if (!trackingOn) {\n      stopWatch();\n      return;\n    }\n\n    if (typeof navigator === \"undefined\" || !navigator.geolocation) {\n      setError(\"Geolocation is not supported in this browser.\");\n      toast.error(\"Geolocation is not available on this device.\");\n      setTrackingOn(false);\n      return;\n    }\n\n    watchId.current = navigator.geolocation.watchPosition(\n      (pos) => sendPing(pos),\n      (err) => {\n        console.error(\"watchPosition error\", err);\n        const friendly = describeGeoError(err);\n        setError(friendly);\n        if (err.code === err.PERMISSION_DENIED) {\n          setTrackingOn(false);\n          setPermissionStatus(\"denied\");\n          toast.error(\"Permission denied. Please re-enable location access.\");\n        } else {\n          toast.error(friendly);\n        }\n      },\n      {\n        enableHighAccuracy: true,\n        maximumAge: 0,\n        timeout: 15000,\n      }\n    );\n\n    return () => stopWatch();\n  }, [trackingOn, sendPing, stopWatch, setError, setTrackingOn, setPermissionStatus]);\n\n  useEffect(() => {\n    function handleOnline() {\n      setError(null);\n    }\n    window.addEventListener(\"online\", handleOnline);\n    return () => window.removeEventListener(\"online\", handleOnline);\n  }, [setError]);\n\n  // Compute hasLocation and isFetchingLocation for gating logic\n  const hasLocation =\n    lastFix !== null &&\n    typeof lastFix.accuracy === \"number\" &&\n    Number.isFinite(lastFix.accuracy) &&\n    lastFix.accuracy <= 100;\n\n  const isFetchingLocation = trackingOn && !hasLocation;\n\n  return {\n    trackingOn,\n    permissionStatus,\n    lastFix,\n    lastPingAt,\n    lastRecommendation,\n    error,\n    toggleTracking,\n    hasLocation,\n    isFetchingLocation,\n  };\n}\n\nfunction distanceMeters(a: GeolocationCoordinates, b: GeolocationCoordinates) {\n  const R = 6371e3;\n  const lat1 = (a.latitude * Math.PI) / 180;\n  const lat2 = (b.latitude * Math.PI) / 180;\n  const deltaLat = lat2 - lat1;\n  const deltaLon = ((b.longitude - a.longitude) * Math.PI) / 180;\n  const x =\n    Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n    Math.cos(lat1) * Math.cos(lat2) * Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(x), Math.sqrt(1 - x));\n  return R * c;\n}\n\nfunction describeGeoError(err: GeolocationPositionError) {\n  switch (err.code) {\n    case err.PERMISSION_DENIED:\n      return \"Location permission denied. Enable it in your browser settings.\";\n    case err.POSITION_UNAVAILABLE:\n      return \"GPS signal unavailable. Move outdoors for a clear view of the sky.\";\n    case err.TIMEOUT:\n      return \"Timed out while waiting for GPS. Try again from an open area.\";\n    default:\n      return err.message || \"Unable to determine your location.\";\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2017, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/hooks/useDriverProfile.ts"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { createBrowserSupabaseClient } from \"@/lib/supabase/client\";\n\nconst supabase = createBrowserSupabaseClient();\n\nexport function useDriverProfile() {\n  const [profile, setProfile] = useState<{ id: string; full_name: string | null } | null>(null);\n\n  useEffect(() => {\n    let active = true;\n    async function load() {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser();\n      if (!user) return;\n      const { data } = await supabase\n        .from(\"profiles\")\n        .select(\"id,full_name\")\n        .eq(\"id\", user.id)\n        .maybeSingle();\n      if (!active) return;\n      setProfile({ id: user.id, full_name: data?.full_name ?? user.user_metadata?.full_name ?? null });\n    }\n    load();\n    return () => {\n      active = false;\n    };\n  }, []);\n\n  return profile;\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAKA,MAAM,WAAW,IAAA,2JAA2B;AAErC,SAAS;;IACd,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAkD;IAExF,IAAA,0KAAS;sCAAC;YACR,IAAI,SAAS;YACb,eAAe;gBACb,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;gBAC/B,IAAI,CAAC,MAAM;gBACX,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SACpB,IAAI,CAAC,YACL,MAAM,CAAC,gBACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,WAAW;gBACd,IAAI,CAAC,QAAQ;gBACb,WAAW;oBAAE,IAAI,KAAK,EAAE;oBAAE,WAAW,MAAM,aAAa,KAAK,aAAa,EAAE,aAAa;gBAAK;YAChG;YACA;YACA;8CAAO;oBACL,SAAS;gBACX;;QACF;qCAAG,EAAE;IAEL,OAAO;AACT;GAzBgB","debugId":null}},
    {"offset": {"line": 2062, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/app/%28driver%29/DriverHomeClient.tsx"],"sourcesContent":["\"use client\";\n\nimport { DriverShell } from \"@/components/layout/DriverShell\";\nimport { TrackingToggle } from \"@/components/TrackingToggle\";\nimport { LiveStatusChip } from \"@/components/LiveStatusChip\";\nimport { NextZonesPanel } from \"@/components/NextZonesPanel\";\nimport { TrafficPreviewMap } from \"@/components/TrafficPreviewMap\";\nimport { RideControls } from \"@/components/RideControls\";\nimport { GpsAccuracyBadge } from \"@/components/GpsAccuracyBadge\";\nimport { useLiveTracking } from \"@/hooks/useLiveTracking\";\nimport { useDriverProfile } from \"@/lib/hooks/useDriverProfile\";\nimport { useTodayStats } from \"@/lib/hooks/useTodayStats\";\n\nexport default function DriverHomeClient() {\n  const tracking = useLiveTracking();\n  const profile = useDriverProfile();\n  const { stats } = useTodayStats();\n\n  const greeting = profile?.full_name ? `Hi, ${profile.full_name.split(\" \")[0]}` : \"Hi driver\";\n  const subtitle = `Today | ${stats.totalTrips} trips | ?${stats.totalEarnings.toFixed(0)}`;\n\n  const gpsReady = tracking.hasLocation;\n  const waitingForGps = tracking.isFetchingLocation;\n\n  return (\n    <DriverShell title={greeting} subtitle={subtitle}>\n      <div className=\"space-y-6\">\n        <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n          {/* <TrackingToggle\n            trackingOn={tracking.trackingOn}\n            permissionStatus={tracking.permissionStatus}\n            toggleTracking={tracking.toggleTracking}\n            error={tracking.error}\n          /> */}\n          <div className=\"flex flex-col items-start gap-2 sm:items-end\">\n            {/* <LiveStatusChip\n              trackingOn={tracking.trackingOn}\n              lastPingAt={tracking.lastPingAt}\n              permissionStatus={tracking.permissionStatus}\n            /> */}\n            <GpsAccuracyBadge\n              trackingOn={tracking.trackingOn}\n              accuracy={tracking.lastFix?.accuracy ?? null}\n            />\n            {waitingForGps && (\n              <div className=\"text-xs text-amber-600\">\n                Acquiring GPS fix...\n              </div>\n            )}\n          </div>\n        </div>\n\n        <NextZonesPanel trackingOn={tracking.trackingOn} seedRecommendation={tracking.lastRecommendation} />\n\n        <TrafficPreviewMap\n          currentLocation={tracking.lastFix}\n          recommendedZones={tracking.lastRecommendation?.top ?? null}\n        />\n\n        <section className=\"space-y-3\">\n          <h2 className=\"text-lg font-semibold\">Ride actions</h2>\n          <RideControls lastFix={tracking.lastFix} />\n        </section>\n      </div>\n    </DriverShell>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAXA;;;;;;;;;AAae,SAAS;;IACtB,MAAM,WAAW,IAAA,8IAAe;IAChC,MAAM,UAAU,IAAA,uJAAgB;IAChC,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,iJAAa;IAE/B,MAAM,WAAW,SAAS,YAAY,CAAC,IAAI,EAAE,QAAQ,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,GAAG;IACjF,MAAM,WAAW,CAAC,QAAQ,EAAE,MAAM,UAAU,CAAC,UAAU,EAAE,MAAM,aAAa,CAAC,OAAO,CAAC,IAAI;IAEzF,MAAM,WAAW,SAAS,WAAW;IACrC,MAAM,gBAAgB,SAAS,kBAAkB;IAEjD,qBACE,6LAAC,sJAAW;QAAC,OAAO;QAAU,UAAU;kBACtC,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;8BAOb,cAAA,6LAAC;wBAAI,WAAU;;0CAMb,6LAAC,sJAAgB;gCACf,YAAY,SAAS,UAAU;gCAC/B,UAAU,SAAS,OAAO,EAAE,YAAY;;;;;;4BAEzC,+BACC,6LAAC;gCAAI,WAAU;0CAAyB;;;;;;;;;;;;;;;;;8BAO9C,6LAAC,kJAAc;oBAAC,YAAY,SAAS,UAAU;oBAAE,oBAAoB,SAAS,kBAAkB;;;;;;8BAEhG,6LAAC,wJAAiB;oBAChB,iBAAiB,SAAS,OAAO;oBACjC,kBAAkB,SAAS,kBAAkB,EAAE,OAAO;;;;;;8BAGxD,6LAAC;oBAAQ,WAAU;;sCACjB,6LAAC;4BAAG,WAAU;sCAAwB;;;;;;sCACtC,6LAAC,8IAAY;4BAAC,SAAS,SAAS,OAAO;;;;;;;;;;;;;;;;;;;;;;;AAKjD;GArDwB;;QACL,8IAAe;QAChB,uJAAgB;QACd,iJAAa;;;KAHT","debugId":null}}]
}