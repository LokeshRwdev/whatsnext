(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([typeof document === "object" ? document.currentScript : undefined,
"[project]/components/layout/DriverShell.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "DriverShell",
    ()=>DriverShell
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils.ts [app-client] (ecmascript)");
;
;
function DriverShell({ title, subtitle, actions, children, className }) {
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("flex h-full flex-col", className),
        children: [
            (title || subtitle || actions) && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("header", {
                className: "flex flex-col gap-2 border-b px-4 py-4 text-left",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "flex items-start justify-between gap-3",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            children: [
                                title && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                                    className: "text-2xl font-semibold leading-tight",
                                    children: title
                                }, void 0, false, {
                                    fileName: "[project]/components/layout/DriverShell.tsx",
                                    lineNumber: 19,
                                    columnNumber: 25
                                }, this),
                                subtitle && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-sm text-muted-foreground",
                                    children: subtitle
                                }, void 0, false, {
                                    fileName: "[project]/components/layout/DriverShell.tsx",
                                    lineNumber: 20,
                                    columnNumber: 28
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/layout/DriverShell.tsx",
                            lineNumber: 18,
                            columnNumber: 13
                        }, this),
                        actions && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "shrink-0",
                            children: actions
                        }, void 0, false, {
                            fileName: "[project]/components/layout/DriverShell.tsx",
                            lineNumber: 22,
                            columnNumber: 25
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/layout/DriverShell.tsx",
                    lineNumber: 17,
                    columnNumber: 11
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/layout/DriverShell.tsx",
                lineNumber: 16,
                columnNumber: 9
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex-1 overflow-y-auto px-4 pb-24 pt-4 md:pb-8",
                children: children
            }, void 0, false, {
                fileName: "[project]/components/layout/DriverShell.tsx",
                lineNumber: 26,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/components/layout/DriverShell.tsx",
        lineNumber: 14,
        columnNumber: 5
    }, this);
}
_c = DriverShell;
var _c;
__turbopack_context__.k.register(_c, "DriverShell");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/lib/api-client.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "apiGet",
    ()=>apiGet,
    "apiPost",
    ()=>apiPost,
    "fetchDriverState",
    ()=>fetchDriverState,
    "fetchRecommendations",
    ()=>fetchRecommendations,
    "postPing",
    ()=>postPing,
    "postRideEvent",
    ()=>postRideEvent,
    "postTripSync",
    ()=>postTripSync,
    "upsertOpsDaily",
    ()=>upsertOpsDaily
]);
async function parseJson(res) {
    if (res.status === 204) return null;
    const contentType = res.headers.get("content-type");
    if (contentType && contentType.includes("application/json")) {
        return await res.json();
    }
    return null;
}
async function handleResponse(res) {
    if (res.ok) {
        const data = await parseJson(res);
        return {
            data,
            error: null
        };
    }
    const payload = await parseJson(res) || undefined;
    const error = {
        code: payload?.error?.code || `HTTP_${res.status}`,
        message: payload?.error?.message || res.statusText,
        details: payload?.error?.details
    };
    return {
        data: null,
        error
    };
}
async function apiGet(url) {
    const res = await fetch(url, {
        cache: "no-store",
        credentials: "include"
    });
    return handleResponse(res);
}
async function apiPost(url, body) {
    const res = await fetch(url, {
        method: "POST",
        headers: {
            "content-type": "application/json"
        },
        body: JSON.stringify(body),
        credentials: "include"
    });
    return handleResponse(res);
}
async function postPing(payload) {
    return apiPost("/api/pings", payload);
}
async function fetchDriverState() {
    return apiGet("/api/driver-state");
}
async function fetchRecommendations(params) {
    const qs = new URLSearchParams();
    if (params?.lat !== undefined) qs.set("lat", String(params.lat));
    if (params?.lon !== undefined) qs.set("lon", String(params.lon));
    if (params?.k !== undefined) qs.set("k", String(params.k));
    const suffix = qs.toString();
    return apiGet(`/api/recommendations/next-spot${suffix ? `?${suffix}` : ""}`);
}
async function postRideEvent(payload) {
    return apiPost("/api/ride-events/ingest", {
        occurred_at: new Date().toISOString(),
        ...payload
    });
}
async function upsertOpsDaily(payload) {
    return apiPost("/api/ops-daily/upsert", payload);
}
async function postTripSync(payload) {
    return apiPost("/api/trips/sync", payload);
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/lib/hooks/useDriverState.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "useDriverState",
    ()=>useDriverState
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$api$2d$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/api-client.ts [app-client] (ecmascript)");
var _s = __turbopack_context__.k.signature();
"use client";
;
;
function unwrapDriverState(payload) {
    if (!payload) return null;
    if (typeof payload?.data !== "undefined") {
        return payload?.data ?? null;
    }
    return payload;
}
function useDriverState(pollMs = 0) {
    _s();
    const [data, setData] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [loading, setLoading] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(true);
    const [error, setError] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const load = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useDriverState.useCallback[load]": async ()=>{
            const { data, error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$api$2d$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["fetchDriverState"])();
            if (error) {
                setError(error.message);
            } else {
                setError(null);
                setData(unwrapDriverState(data ?? null));
            }
            setLoading(false);
        }
    }["useDriverState.useCallback[load]"], []);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "useDriverState.useEffect": ()=>{
            load();
            if (pollMs > 0) {
                const id = setInterval(load, pollMs);
                return ({
                    "useDriverState.useEffect": ()=>clearInterval(id)
                })["useDriverState.useEffect"];
            }
        }
    }["useDriverState.useEffect"], [
        load,
        pollMs
    ]);
    return {
        data,
        loading,
        error,
        refresh: load
    };
}
_s(useDriverState, "KrZbG0iHBofwJAKWiwWTMEud1Io=");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/lib/tracking/store.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "useTrackingStore",
    ()=>useTrackingStore
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zustand$2f$esm$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/zustand/esm/index.mjs [app-client] (ecmascript) <locals>");
"use client";
;
const useTrackingStore = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zustand$2f$esm$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["create"])((set)=>({
        trackingOn: false,
        permissionStatus: "prompt",
        lastFix: null,
        lastPingAt: null,
        lastRecommendation: null,
        error: null,
        isDriving: false,
        autoStartPending: true,
        allowLowAccuracy: false,
        setTrackingOn: (trackingOn)=>set({
                trackingOn
            }),
        setPermissionStatus: (permissionStatus)=>set({
                permissionStatus
            }),
        setLastFix: (lastFix)=>set({
                lastFix
            }),
        setLastPingAt: (lastPingAt)=>set({
                lastPingAt
            }),
        setRecommendation: (lastRecommendation)=>set({
                lastRecommendation
            }),
        setError: (error)=>set({
                error
            }),
        setIsDriving: (isDriving)=>set(()=>({
                    isDriving,
                    autoStartPending: isDriving ? false : true
                })),
        setAutoStartPending: (autoStartPending)=>set({
                autoStartPending
            }),
        setAllowLowAccuracy: (allowLowAccuracy)=>set({
                allowLowAccuracy
            })
    }));
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/ui/card.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "Card",
    ()=>Card,
    "CardContent",
    ()=>CardContent,
    "CardDescription",
    ()=>CardDescription,
    "CardFooter",
    ()=>CardFooter,
    "CardHeader",
    ()=>CardHeader,
    "CardTitle",
    ()=>CardTitle
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils.ts [app-client] (ecmascript)");
;
;
;
const Card = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["forwardRef"](_c = ({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("rounded-2xl border bg-card text-card-foreground shadow-sm", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/components/ui/card.tsx",
        lineNumber: 8,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
_c1 = Card;
Card.displayName = "Card";
const CardHeader = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["forwardRef"](_c2 = ({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("flex flex-col space-y-1.5 p-6", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/components/ui/card.tsx",
        lineNumber: 23,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
_c3 = CardHeader;
CardHeader.displayName = "CardHeader";
const CardTitle = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["forwardRef"](_c4 = ({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("text-2xl font-semibold leading-none tracking-tight", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/components/ui/card.tsx",
        lineNumber: 35,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
_c5 = CardTitle;
CardTitle.displayName = "CardTitle";
const CardDescription = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["forwardRef"](_c6 = ({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("text-sm text-muted-foreground", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/components/ui/card.tsx",
        lineNumber: 50,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
_c7 = CardDescription;
CardDescription.displayName = "CardDescription";
const CardContent = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["forwardRef"](_c8 = ({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("p-6 pt-0", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/components/ui/card.tsx",
        lineNumber: 62,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
_c9 = CardContent;
CardContent.displayName = "CardContent";
const CardFooter = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["forwardRef"](_c10 = ({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("flex items-center p-6 pt-0", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/components/ui/card.tsx",
        lineNumber: 70,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
_c11 = CardFooter;
CardFooter.displayName = "CardFooter";
;
var _c, _c1, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c10, _c11;
__turbopack_context__.k.register(_c, "Card$React.forwardRef");
__turbopack_context__.k.register(_c1, "Card");
__turbopack_context__.k.register(_c2, "CardHeader$React.forwardRef");
__turbopack_context__.k.register(_c3, "CardHeader");
__turbopack_context__.k.register(_c4, "CardTitle$React.forwardRef");
__turbopack_context__.k.register(_c5, "CardTitle");
__turbopack_context__.k.register(_c6, "CardDescription$React.forwardRef");
__turbopack_context__.k.register(_c7, "CardDescription");
__turbopack_context__.k.register(_c8, "CardContent$React.forwardRef");
__turbopack_context__.k.register(_c9, "CardContent");
__turbopack_context__.k.register(_c10, "CardFooter$React.forwardRef");
__turbopack_context__.k.register(_c11, "CardFooter");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/lib/nearest-zones.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "computeNearestZones",
    ()=>computeNearestZones
]);
const EARTH_RADIUS_M = 6371e3;
const DEFAULT_SPEED_KMH = 20;
function toRadians(value) {
    return value * Math.PI / 180;
}
function distanceMeters(a, b) {
    const deltaLat = toRadians(b.lat - a.lat);
    const deltaLon = toRadians(b.lon - a.lon);
    const lat1 = toRadians(a.lat);
    const lat2 = toRadians(b.lat);
    const haversine = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) + Math.cos(lat1) * Math.cos(lat2) * Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(haversine), Math.sqrt(1 - haversine));
    return EARTH_RADIUS_M * c;
}
function resolveZoneCoordinate(zone) {
    const center = zone.center;
    if (center && Array.isArray(center.coordinates) && center.coordinates.length === 2) {
        const [lon, lat] = center.coordinates;
        if (typeof lat === "number" && typeof lon === "number") {
            return {
                lat,
                lon
            };
        }
    }
    if (typeof zone.lat === "number" && typeof zone.lon === "number") {
        return {
            lat: zone.lat,
            lon: zone.lon
        };
    }
    return null;
}
function clampScore(value) {
    return Math.max(0, Math.min(1, Number(value.toFixed(4))));
}
function computeZoneScore(distanceKm, insideRadius, weight) {
    const distanceScore = Math.max(0, 1 - distanceKm / 4); // degrade after 4km
    const insideBoost = insideRadius ? 0.2 : 0;
    const normalizedWeight = typeof weight === "number" && Number.isFinite(weight) ? weight : 1;
    const demandBoost = Math.min(0.4, (normalizedWeight - 1) * 0.25);
    return clampScore(distanceScore + insideBoost + demandBoost);
}
function describeReason(distanceM, insideRadius, weight) {
    const parts = [];
    if (distanceM < 1000) {
        parts.push(`${Math.round(distanceM)}m away`);
    } else {
        parts.push(`${(distanceM / 1000).toFixed(1)} km away`);
    }
    if (insideRadius) {
        parts.push("inside zone radius");
    }
    if (typeof weight === "number" && weight > 1) {
        parts.push(`demand +${Math.round((weight - 1) * 100)}%`);
    }
    return `Local pick • ${parts.join(" · ")}`;
}
function computeNearestZones(zones, location, opts) {
    if (!zones.length) {
        return {
            results: [],
            best: null
        };
    }
    const limit = opts?.limit ?? 3;
    const speed = opts?.vehicleSpeedKmh ?? DEFAULT_SPEED_KMH;
    const enriched = zones.map((zone)=>{
        const coord = resolveZoneCoordinate(zone);
        if (!coord) return null;
        const distance_m = distanceMeters(location, coord);
        const distance_km = distance_m / 1000;
        const radius_km = typeof zone.radius_km === "number" && Number.isFinite(zone.radius_km) ? zone.radius_km : null;
        const inside_radius = radius_km !== null ? distance_m <= radius_km * 1000 : distance_m <= 500;
        const eta_min = Math.max(1, Math.round(distance_km / speed * 60));
        const score = computeZoneScore(distance_km, inside_radius, zone.weight_demand ?? null);
        return {
            zone_id: zone.id,
            zone_name: zone.name,
            lat: coord.lat,
            lon: coord.lon,
            distance_m,
            distance_km,
            eta_min,
            score,
            radius_km,
            weight_demand: zone.weight_demand ?? null,
            inside_radius,
            reason: describeReason(distance_m, inside_radius, zone.weight_demand ?? null)
        };
    }).filter(Boolean).sort((a, b)=>{
        if (!a || !b) return 0;
        if (a.score === b.score) {
            return a.distance_m - b.distance_m;
        }
        return b.score - a.score;
    }).slice(0, limit);
    if (enriched.length && ("TURBOPACK compile-time value", "object") !== "undefined") {
        console.log("[nearest-zones] computed", {
            origin: opts?.origin ?? "unknown",
            best_zone: enriched[0]?.zone_name,
            distance_m: Math.round(enriched[0]?.distance_m ?? 0),
            considered: zones.length
        });
    }
    return {
        results: enriched,
        best: enriched[0] ?? null
    };
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/NextZonesPanel.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "NextZonesPanel",
    ()=>NextZonesPanel
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$hooks$2f$useDriverState$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/hooks/useDriverState.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/tracking/store.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/ui/card.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/ui/button.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$up$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowUpRight$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/arrow-up-right.js [app-client] (ecmascript) <export default as ArrowUpRight>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$map$2d$pin$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__MapPin$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/map-pin.js [app-client] (ecmascript) <export default as MapPin>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$refresh$2d$cw$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__RefreshCw$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/refresh-cw.js [app-client] (ecmascript) <export default as RefreshCw>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$date$2d$fns$2f$formatDistanceToNow$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/date-fns/formatDistanceToNow.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$hooks$2f$useZones$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/hooks/useZones.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$nearest$2d$zones$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/nearest-zones.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
;
;
;
;
const STALE_MS = 45_000;
const AUTO_REFRESH_MS = 180_000; // 3 minutes
function NextZonesPanel({ trackingOn, hasLocation, isFetchingLocation, currentLoc, seedRecommendation, allowLowAccuracy, onAllowLowAccuracy }) {
    _s();
    const { data: driverState } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$hooks$2f$useDriverState$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useDriverState"])();
    const { zones } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$hooks$2f$useZones$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useZones"])();
    const [recommendation, setRecommendation] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(seedRecommendation ?? null);
    const [loading, setLoading] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(!seedRecommendation);
    const [error, setError] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const setTrackingRecommendation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "NextZonesPanel.useTrackingStore[setTrackingRecommendation]": (s)=>s.setRecommendation
    }["NextZonesPanel.useTrackingStore[setTrackingRecommendation]"]);
    const lastFix = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "NextZonesPanel.useTrackingStore[lastFix]": (s)=>s.lastFix
    }["NextZonesPanel.useTrackingStore[lastFix]"]);
    const lastFixRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(lastFix);
    const lastFetchAtRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(0);
    const currentLocRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(currentLoc);
    const hasLocationRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(hasLocation);
    const lastFetchedCoordsRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const debounceTimerRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const initialFetchTriggeredRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            lastFixRef.current = lastFix;
        }
    }["NextZonesPanel.useEffect"], [
        lastFix
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            currentLocRef.current = currentLoc;
        }
    }["NextZonesPanel.useEffect"], [
        currentLoc
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            hasLocationRef.current = hasLocation;
        }
    }["NextZonesPanel.useEffect"], [
        hasLocation
    ]);
    const fallbackLocation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "NextZonesPanel.useMemo[fallbackLocation]": ()=>selectBestLocation(currentLoc, driverState)
    }["NextZonesPanel.useMemo[fallbackLocation]"], [
        currentLoc,
        driverState
    ]);
    const syncRecommendation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "NextZonesPanel.useCallback[syncRecommendation]": (next)=>{
            setRecommendation(next);
            setTrackingRecommendation(next);
        }
    }["NextZonesPanel.useCallback[syncRecommendation]"], [
        setTrackingRecommendation
    ]);
    const buildLocalRecommendation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "NextZonesPanel.useCallback[buildLocalRecommendation]": (coords, meta)=>{
            if (!zones.length) return null;
            const { results } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$nearest$2d$zones$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["computeNearestZones"])(zones, coords, {
                limit: 3,
                origin: meta.origin
            });
            const top = results.map({
                "NextZonesPanel.useCallback[buildLocalRecommendation].top": (zone)=>({
                        zone_id: zone.zone_id,
                        zone_name: zone.zone_name,
                        lat: zone.lat,
                        lon: zone.lon,
                        distance_km: Number(zone.distance_km.toFixed(2)),
                        eta_min: zone.eta_min,
                        score: zone.score,
                        reason: zone.reason,
                        traffic_speed_idx: null
                    })
            }["NextZonesPanel.useCallback[buildLocalRecommendation].top"]);
            return {
                computed_at: new Date().toISOString(),
                source: "local",
                traffic_source: "fallback",
                context: {
                    reason: top.length ? "local_inference" : "no_zones_in_db",
                    origin: meta.origin,
                    trigger: meta.trigger
                },
                top
            };
        }
    }["NextZonesPanel.useCallback[buildLocalRecommendation]"], [
        zones
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            if (!fallbackLocation) return;
            if (recommendation?.top?.length) return;
            const seeded = buildLocalRecommendation(fallbackLocation.coords, {
                origin: fallbackLocation.source,
                trigger: "driver_state_seed"
            });
            if (seeded && seeded.top.length) {
                setError(null);
                setLoading(false);
                syncRecommendation(seeded);
            }
        }
    }["NextZonesPanel.useEffect"], [
        fallbackLocation,
        recommendation,
        buildLocalRecommendation,
        syncRecommendation
    ]);
    const hydrateFromState = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "NextZonesPanel.useCallback[hydrateFromState]": ()=>{
            if (driverState?.recommendation) {
                const rec = driverState.recommendation;
                if (Date.now() - Date.parse(rec.computed_at) < STALE_MS) {
                    syncRecommendation(rec);
                    setError(null);
                    setLoading(false);
                    return true;
                }
            }
            return false;
        }
    }["NextZonesPanel.useCallback[hydrateFromState]"], [
        driverState,
        syncRecommendation
    ]);
    const fetchLatest = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "NextZonesPanel.useCallback[fetchLatest]": async (reason = "manual")=>{
            const loc = currentLocRef.current;
            if (!loc || !hasLocationRef.current) {
                setLoading(false);
                return;
            }
            lastFetchAtRef.current = Date.now();
            lastFetchedCoordsRef.current = {
                lat: loc.lat,
                lon: loc.lon
            };
            setLoading(true);
            setError(null);
            const localRecommendation = buildLocalRecommendation({
                lat: loc.lat,
                lon: loc.lon
            }, {
                origin: "live_fix",
                trigger: reason
            });
            if (!localRecommendation || localRecommendation.top.length === 0) {
                setError("No zones with coordinates are configured yet.");
            } else {
                setError(null);
                syncRecommendation(localRecommendation);
            }
            setLoading(false);
        }
    }["NextZonesPanel.useCallback[fetchLatest]"], [
        buildLocalRecommendation,
        syncRecommendation
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            if (!seedRecommendation && hasLocation) {
                if (!hydrateFromState()) {
                    fetchLatest("initial_state");
                }
            }
        }
    }["NextZonesPanel.useEffect"], [
        seedRecommendation,
        hasLocation,
        hydrateFromState,
        fetchLatest
    ]);
    const requestRefresh = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "NextZonesPanel.useCallback[requestRefresh]": (reason)=>{
            if (debounceTimerRef.current) {
                clearTimeout(debounceTimerRef.current);
            }
            debounceTimerRef.current = setTimeout({
                "NextZonesPanel.useCallback[requestRefresh]": ()=>{
                    debounceTimerRef.current = null;
                    void fetchLatest(reason);
                }
            }["NextZonesPanel.useCallback[requestRefresh]"], 800);
        }
    }["NextZonesPanel.useCallback[requestRefresh]"], [
        fetchLatest
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            if (!hasLocation) {
                initialFetchTriggeredRef.current = false;
            }
        }
    }["NextZonesPanel.useEffect"], [
        hasLocation
    ]);
    // Kick off the first fetch as soon as we have a good GPS fix
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            if (!hasLocation || !currentLoc) return;
            if (!initialFetchTriggeredRef.current) {
                initialFetchTriggeredRef.current = true;
                void fetchLatest("first_fix");
            }
        }
    }["NextZonesPanel.useEffect"], [
        hasLocation,
        currentLoc,
        fetchLatest
    ]);
    // Refresh when the driver moves ~50m or every 15s while tracking
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            if (!hasLocation || !currentLoc || !initialFetchTriggeredRef.current) return;
            const lastCoords = lastFetchedCoordsRef.current;
            const now = Date.now();
            const movedMeters = lastCoords ? distanceBetweenMeters(lastCoords.lat, lastCoords.lon, currentLoc.lat, currentLoc.lon) : Infinity;
            if (!lastCoords || movedMeters >= 50 || now - lastFetchAtRef.current >= 15_000) {
                requestRefresh("movement_or_interval");
            }
        }
    }["NextZonesPanel.useEffect"], [
        hasLocation,
        currentLoc,
        requestRefresh
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            hydrateFromState();
        }
    }["NextZonesPanel.useEffect"], [
        driverState,
        hydrateFromState
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            return ({
                "NextZonesPanel.useEffect": ()=>{
                    if (debounceTimerRef.current) {
                        clearTimeout(debounceTimerRef.current);
                    }
                }
            })["NextZonesPanel.useEffect"];
        }
    }["NextZonesPanel.useEffect"], []);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            if (seedRecommendation && (!recommendation || seedRecommendation.computed_at !== recommendation.computed_at)) {
                syncRecommendation(seedRecommendation);
            }
        }
    }["NextZonesPanel.useEffect"], [
        seedRecommendation,
        recommendation,
        syncRecommendation
    ]);
    const runAutoRefresh = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "NextZonesPanel.useCallback[runAutoRefresh]": ()=>{
            if (!hasLocationRef.current) return;
            const now = Date.now();
            if (now - lastFetchAtRef.current < AUTO_REFRESH_MS) {
                return;
            }
            void fetchLatest("auto_refresh");
        }
    }["NextZonesPanel.useCallback[runAutoRefresh]"], [
        fetchLatest
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "NextZonesPanel.useEffect": ()=>{
            if (!trackingOn || !hasLocation) return;
            runAutoRefresh();
            const id = setInterval(runAutoRefresh, AUTO_REFRESH_MS);
            return ({
                "NextZonesPanel.useEffect": ()=>clearInterval(id)
            })["NextZonesPanel.useEffect"];
        }
    }["NextZonesPanel.useEffect"], [
        trackingOn,
        hasLocation,
        runAutoRefresh
    ]);
    const hasServerResults = Boolean(recommendation?.top && recommendation.top.length > 0);
    const empty = !loading && !error && !hasServerResults;
    const waitingForGps = trackingOn && !hasLocation;
    const rawAccuracy = currentLoc?.accuracy_m ?? lastFix?.accuracy ?? null;
    const gpsAccuracy = typeof rawAccuracy === "number" ? rawAccuracy : null;
    const computedAgo = recommendation?.computed_at ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$date$2d$fns$2f$formatDistanceToNow$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["formatDistanceToNow"])(new Date(recommendation.computed_at), {
        addSuffix: true
    }) : null;
    const context = recommendation?.context;
    const avgTrafficIdx = typeof context?.traffic_speed_idx === "number" ? context.traffic_speed_idx : null;
    const trafficSource = recommendation?.traffic_source ?? null;
    const contextReason = typeof context?.reason === "string" ? context.reason : undefined;
    const emptyStateContent = (()=>{
        if (waitingForGps || isFetchingLocation) {
            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "font-medium",
                        children: "Waiting for GPS fix..."
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 279,
                        columnNumber: 11
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "mt-1 text-xs",
                        children: "Move outdoors for a clear sky view. Accuracy must be <150m before we can plan zones."
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 280,
                        columnNumber: 11
                    }, this),
                    typeof gpsAccuracy === "number" && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "mt-1 text-xs text-amber-600",
                        children: [
                            "Current accuracy: ",
                            gpsAccuracy.toFixed(0),
                            "m"
                        ]
                    }, void 0, true, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 284,
                        columnNumber: 13
                    }, this),
                    !allowLowAccuracy && Boolean(onAllowLowAccuracy) && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                        size: "sm",
                        variant: "secondary",
                        className: "mt-3",
                        onClick: onAllowLowAccuracy,
                        children: "Use low-accuracy fix"
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 287,
                        columnNumber: 13
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/components/NextZonesPanel.tsx",
                lineNumber: 278,
                columnNumber: 9
            }, this);
        }
        if (contextReason === "no_zones_in_db") {
            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "font-medium",
                        children: "No zones configured"
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 297,
                        columnNumber: 11
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "mt-1 text-xs",
                        children: "Ask operations to seed the zones table. Recommendations need at least one zone."
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 298,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/components/NextZonesPanel.tsx",
                lineNumber: 296,
                columnNumber: 9
            }, this);
        }
        if (contextReason === "no_zones_with_coords") {
            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "font-medium",
                        children: "Zones missing coordinates"
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 307,
                        columnNumber: 11
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "mt-1 text-xs",
                        children: "None of the zones have lat/lon or center coordinates. Update them in Supabase."
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 308,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/components/NextZonesPanel.tsx",
                lineNumber: 306,
                columnNumber: 9
            }, this);
        }
        return "We'll start suggesting zones once we see your location.";
    })();
    const headerMeta = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "NextZonesPanel.useMemo[headerMeta]": ()=>{
            const parts = [
                computedAgo ? `Refreshed ${computedAgo}` : "Refreshed just now",
                describeTrafficSource(trafficSource),
                avgTrafficIdx !== null ? `Avg traffic ${describeTrafficLevel(avgTrafficIdx)}` : null
            ];
            return parts.filter(Boolean).join(" | ");
        }
    }["NextZonesPanel.useMemo[headerMeta]"], [
        computedAgo,
        trafficSource,
        avgTrafficIdx
    ]);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Card"], {
        className: "shadow-sm",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CardHeader"], {
                className: "flex flex-row items-center justify-between space-y-0",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CardTitle"], {
                                className: "text-base font-semibold",
                                children: "Next best zones"
                            }, void 0, false, {
                                fileName: "[project]/components/NextZonesPanel.tsx",
                                lineNumber: 329,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-xs text-muted-foreground",
                                children: headerMeta
                            }, void 0, false, {
                                fileName: "[project]/components/NextZonesPanel.tsx",
                                lineNumber: 330,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 328,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                        variant: "ghost",
                        size: "icon",
                        "aria-label": "Refresh",
                        onClick: ()=>fetchLatest("manual_button"),
                        disabled: !hasLocation || isFetchingLocation,
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$refresh$2d$cw$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__RefreshCw$3e$__["RefreshCw"], {
                            className: "h-4 w-4"
                        }, void 0, false, {
                            fileName: "[project]/components/NextZonesPanel.tsx",
                            lineNumber: 339,
                            columnNumber: 11
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 332,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/components/NextZonesPanel.tsx",
                lineNumber: 327,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CardContent"], {
                className: "space-y-4",
                children: [
                    loading && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "space-y-3",
                        children: [
                            0,
                            1,
                            2
                        ].map((idx)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "rounded-xl border p-3",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "h-4 w-1/2 animate-pulse rounded bg-muted"
                                    }, void 0, false, {
                                        fileName: "[project]/components/NextZonesPanel.tsx",
                                        lineNumber: 347,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mt-2 h-3 w-1/3 animate-pulse rounded bg-muted"
                                    }, void 0, false, {
                                        fileName: "[project]/components/NextZonesPanel.tsx",
                                        lineNumber: 348,
                                        columnNumber: 17
                                    }, this)
                                ]
                            }, idx, true, {
                                fileName: "[project]/components/NextZonesPanel.tsx",
                                lineNumber: 346,
                                columnNumber: 15
                            }, this))
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 344,
                        columnNumber: 11
                    }, this),
                    !loading && error && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-700",
                        children: [
                            error,
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                                size: "sm",
                                variant: "secondary",
                                className: "mt-3",
                                onClick: ()=>fetchLatest("retry"),
                                disabled: isFetchingLocation || !hasLocation,
                                children: "Try again"
                            }, void 0, false, {
                                fileName: "[project]/components/NextZonesPanel.tsx",
                                lineNumber: 357,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 355,
                        columnNumber: 11
                    }, this),
                    empty && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "rounded-xl border border-dashed p-4 text-sm text-muted-foreground",
                        children: emptyStateContent
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 370,
                        columnNumber: 11
                    }, this),
                    !loading && !error && recommendation?.top?.length ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "space-y-3",
                        children: recommendation.top.map((zone)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(ZoneCard, {
                                zone: zone
                            }, zone.zone_id, false, {
                                fileName: "[project]/components/NextZonesPanel.tsx",
                                lineNumber: 378,
                                columnNumber: 15
                            }, this))
                    }, void 0, false, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 376,
                        columnNumber: 11
                    }, this) : null
                ]
            }, void 0, true, {
                fileName: "[project]/components/NextZonesPanel.tsx",
                lineNumber: 342,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/components/NextZonesPanel.tsx",
        lineNumber: 326,
        columnNumber: 5
    }, this);
}
_s(NextZonesPanel, "0LXKV/sd92T3Xan8zwi3GH+f508=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$hooks$2f$useDriverState$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useDriverState"],
        __TURBOPACK__imported__module__$5b$project$5d2f$hooks$2f$useZones$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useZones"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"]
    ];
});
_c = NextZonesPanel;
function selectBestLocation(currentLoc, driverState) {
    if (currentLoc) {
        return {
            coords: {
                lat: currentLoc.lat,
                lon: currentLoc.lon
            },
            source: "live_fix"
        };
    }
    if (!driverState) return null;
    if (typeof driverState.lat === "number" && typeof driverState.lon === "number") {
        return {
            coords: {
                lat: driverState.lat,
                lon: driverState.lon
            },
            source: "driver_state_coords"
        };
    }
    const coordsField = driverState?.coords;
    if (coordsField && typeof coordsField.lat === "number" && typeof coordsField.lon === "number") {
        return {
            coords: {
                lat: coordsField.lat,
                lon: coordsField.lon
            },
            source: "driver_state_coords"
        };
    }
    const locPoint = driverState.loc;
    if (locPoint && Array.isArray(locPoint.coordinates) && locPoint.coordinates.length === 2) {
        const [lon, lat] = locPoint.coordinates;
        if (typeof lat === "number" && typeof lon === "number") {
            return {
                coords: {
                    lat,
                    lon
                },
                source: "driver_state_loc"
            };
        }
    }
    return null;
}
function ZoneCard({ zone }) {
    const hasScore = typeof zone.score === "number";
    const hasEta = typeof zone.eta_min === "number";
    const hasDistance = typeof zone.distance_km === "number";
    const distanceLabel = hasDistance ? `${zone.distance_km.toFixed(1)} km` : "Distance n/a";
    const etaLabel = hasEta ? `${zone.eta_min} min` : "ETA n/a";
    const scoreLabel = hasScore ? zone.score.toFixed(2) : "Score n/a";
    const barWidth = hasScore ? `${Math.min(100, Math.round(zone.score * 100))}%` : "0%";
    const handleNavigate = ()=>{
        if (typeof zone.lat === "number" && typeof zone.lon === "number") {
            window.open(`https://www.google.com/maps/search/?api=1&query=${zone.lat},${zone.lon}`, "_blank");
            return;
        }
        const fallbackQuery = encodeURIComponent(`${zone.zone_name} Patna`);
        window.open(`https://www.google.com/maps/search/?api=1&query=${fallbackQuery}`, "_blank");
    };
    const trafficLabel = typeof zone.traffic_speed_idx === "number" ? describeTrafficLevel(zone.traffic_speed_idx) : null;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "rounded-2xl border p-4",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex items-start justify-between gap-3",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex items-center gap-2 text-base font-semibold",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$map$2d$pin$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__MapPin$3e$__["MapPin"], {
                                        className: "h-4 w-4 text-primary"
                                    }, void 0, false, {
                                        fileName: "[project]/components/NextZonesPanel.tsx",
                                        lineNumber: 447,
                                        columnNumber: 13
                                    }, this),
                                    zone.zone_name
                                ]
                            }, void 0, true, {
                                fileName: "[project]/components/NextZonesPanel.tsx",
                                lineNumber: 446,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-xs text-muted-foreground",
                                children: [
                                    distanceLabel,
                                    " | ",
                                    etaLabel,
                                    " | ",
                                    scoreLabel
                                ]
                            }, void 0, true, {
                                fileName: "[project]/components/NextZonesPanel.tsx",
                                lineNumber: 450,
                                columnNumber: 11
                            }, this),
                            trafficLabel && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-xs text-muted-foreground",
                                children: [
                                    "Traffic: ",
                                    trafficLabel
                                ]
                            }, void 0, true, {
                                fileName: "[project]/components/NextZonesPanel.tsx",
                                lineNumber: 454,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 445,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                        size: "sm",
                        variant: "secondary",
                        onClick: handleNavigate,
                        children: [
                            "Navigate",
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$up$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowUpRight$3e$__["ArrowUpRight"], {
                                className: "ml-1 h-3 w-3"
                            }, void 0, false, {
                                fileName: "[project]/components/NextZonesPanel.tsx",
                                lineNumber: 459,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/components/NextZonesPanel.tsx",
                        lineNumber: 457,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/components/NextZonesPanel.tsx",
                lineNumber: 444,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "mt-3 text-sm text-muted-foreground",
                children: zone.reason
            }, void 0, false, {
                fileName: "[project]/components/NextZonesPanel.tsx",
                lineNumber: 462,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "mt-3 h-1.5 rounded-full bg-muted",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "h-full rounded-full bg-emerald-500",
                    style: {
                        width: barWidth
                    }
                }, void 0, false, {
                    fileName: "[project]/components/NextZonesPanel.tsx",
                    lineNumber: 464,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/NextZonesPanel.tsx",
                lineNumber: 463,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/components/NextZonesPanel.tsx",
        lineNumber: 443,
        columnNumber: 5
    }, this);
}
_c1 = ZoneCard;
function describeTrafficSource(source) {
    if (source === "google") return "Google live traffic";
    if (source === "cache") return "Cached traffic snapshot";
    if (source === "fallback") return "Estimated traffic";
    return null;
}
function describeTrafficLevel(idx) {
    if (idx >= 0.85) return "Smooth";
    if (idx >= 0.65) return "Moderate";
    if (idx >= 0.4) return "Busy";
    return "Heavy";
}
function distanceBetweenMeters(lat1, lon1, lat2, lon2) {
    const R = 6371e3;
    const phi1 = lat1 * Math.PI / 180;
    const phi2 = lat2 * Math.PI / 180;
    const deltaPhi = (lat2 - lat1) * Math.PI / 180;
    const deltaLambda = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(deltaPhi / 2) * Math.sin(deltaPhi / 2) + Math.cos(phi1) * Math.cos(phi2) * Math.sin(deltaLambda / 2) * Math.sin(deltaLambda / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
}
var _c, _c1;
__turbopack_context__.k.register(_c, "NextZonesPanel");
__turbopack_context__.k.register(_c1, "ZoneCard");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/RideControls.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "RideControls",
    ()=>RideControls
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/ui/button.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$api$2d$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/api-client.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/tracking/store.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__XCircle$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/circle-x.js [app-client] (ecmascript) <export default as XCircle>");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
;
const events = [
    {
        type: "booking_received",
        label: "Got a Ride",
        variant: "default"
    },
    {
        type: "ride_started",
        label: "Start Ride",
        variant: "default"
    },
    {
        type: "ride_completed",
        label: "Complete Ride",
        variant: "destructive"
    },
    {
        type: "booking_cancelled",
        label: "Cancel Booking",
        variant: "ghost"
    }
];
function RideControls({ lastFix }) {
    _s();
    const [platform, setPlatform] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("ola");
    const [rideState, setRideState] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("idle");
    const [activeEvent, setActiveEvent] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [submitting, setSubmitting] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const setIsDriving = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "RideControls.useTrackingStore[setIsDriving]": (s)=>s.setIsDriving
    }["RideControls.useTrackingStore[setIsDriving]"]);
    const coordsCopy = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "RideControls.useMemo[coordsCopy]": ()=>{
            if (!lastFix) return "No live GPS";
            return `${lastFix.lat.toFixed(4)}, ${lastFix.lon.toFixed(4)}`;
        }
    }["RideControls.useMemo[coordsCopy]"], [
        lastFix
    ]);
    const handleMainAction = ()=>{
        if (rideState === "idle") {
            setActiveEvent(events.find((e)=>e.type === "booking_received"));
        } else if (rideState === "booking") {
            setActiveEvent(events.find((e)=>e.type === "ride_started"));
        } else if (rideState === "on_trip") {
            setActiveEvent(events.find((e)=>e.type === "ride_completed"));
        }
    };
    const handleCancelAction = ()=>{
        setActiveEvent(events.find((e)=>e.type === "booking_cancelled"));
    };
    const confirmEvent = async ()=>{
        if (!activeEvent) return;
        setSubmitting(true);
        const payload = {
            event_type: activeEvent.type,
            platform
        };
        if (lastFix) {
            if (activeEvent.type === "ride_completed") {
                payload.drop_lat = lastFix.lat;
                payload.drop_lon = lastFix.lon;
            } else {
                payload.pickup_lat = lastFix.lat;
                payload.pickup_lon = lastFix.lon;
            }
        }
        const { error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$api$2d$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["postRideEvent"])(payload);
        setSubmitting(false);
        setActiveEvent(null);
        if (error) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(error.message);
        } else {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success(`${copyForEvent(activeEvent.type)} logged`);
            // State transitions
            if (activeEvent.type === "booking_received") {
                setRideState("booking");
                setIsDriving(false);
            } else if (activeEvent.type === "ride_started") {
                setRideState("on_trip");
                setIsDriving(true);
            } else if (activeEvent.type === "ride_completed") {
                setRideState("idle");
                setIsDriving(false);
            } else if (activeEvent.type === "booking_cancelled") {
                setRideState("idle");
                setIsDriving(false);
            }
        }
    };
    const getMainButtonLabel = ()=>{
        switch(rideState){
            case "idle":
                return "Got a Ride";
            case "booking":
                return "Start Ride";
            case "on_trip":
                return "Complete Ride";
        }
    };
    const getMainButtonVariant = ()=>{
        switch(rideState){
            case "idle":
                return "default"; // Green/Primary
            case "booking":
                return "secondary"; // Distinct from idle
            case "on_trip":
                return "destructive"; // Red/End action? Or maybe outline. Let's use default for now or specific style.
        }
    };
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "space-y-4",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex items-center justify-between rounded-2xl border bg-white/60 px-4 py-3 shadow-sm",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                            className: "text-xs uppercase text-muted-foreground",
                            children: "Current platform"
                        }, void 0, false, {
                            fileName: "[project]/components/RideControls.tsx",
                            lineNumber: 117,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mt-1 inline-flex gap-2 rounded-full bg-muted p-1",
                            children: [
                                "ola",
                                "uber"
                            ].map((provider)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    onClick: ()=>setPlatform(provider),
                                    className: `rounded-full px-3 py-1 text-xs font-semibold capitalize transition ${platform === provider ? "bg-white text-foreground shadow" : "text-muted-foreground"}`,
                                    children: provider
                                }, provider, false, {
                                    fileName: "[project]/components/RideControls.tsx",
                                    lineNumber: 120,
                                    columnNumber: 15
                                }, this))
                        }, void 0, false, {
                            fileName: "[project]/components/RideControls.tsx",
                            lineNumber: 118,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/RideControls.tsx",
                    lineNumber: 116,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/RideControls.tsx",
                lineNumber: 115,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex flex-col gap-3",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                        className: `h-14 text-lg font-semibold shadow-sm transition-all ${rideState === "on_trip" ? "bg-red-600 hover:bg-red-700 text-white" : rideState === "booking" ? "bg-emerald-600 hover:bg-emerald-700 text-white" : ""}`,
                        variant: rideState === "idle" ? "default" : "secondary",
                        onClick: handleMainAction,
                        children: getMainButtonLabel()
                    }, void 0, false, {
                        fileName: "[project]/components/RideControls.tsx",
                        lineNumber: 142,
                        columnNumber: 9
                    }, this),
                    rideState === "booking" && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                        variant: "ghost",
                        className: "text-muted-foreground hover:text-red-600 hover:bg-red-50",
                        onClick: handleCancelAction,
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__XCircle$3e$__["XCircle"], {
                                className: "mr-2 h-4 w-4"
                            }, void 0, false, {
                                fileName: "[project]/components/RideControls.tsx",
                                lineNumber: 159,
                                columnNumber: 13
                            }, this),
                            "Cancel Booking"
                        ]
                    }, void 0, true, {
                        fileName: "[project]/components/RideControls.tsx",
                        lineNumber: 154,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/components/RideControls.tsx",
                lineNumber: 141,
                columnNumber: 7
            }, this),
            activeEvent && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 pb-8 animate-in fade-in duration-200",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "w-full max-w-md rounded-3xl bg-whitesmoke p-6 shadow-2xl",
                    style: {
                        background: 'whitesmoke'
                    },
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                            className: "text-sm font-semibold text-muted-foreground",
                            children: "Confirm action"
                        }, void 0, false, {
                            fileName: "[project]/components/RideControls.tsx",
                            lineNumber: 176,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                            className: "text-2xl font-semibold mt-1",
                            children: activeEvent.label
                        }, void 0, false, {
                            fileName: "[project]/components/RideControls.tsx",
                            lineNumber: 177,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mt-4 space-y-2 rounded-xl bg-muted/50 p-4",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex justify-between text-sm",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-muted-foreground",
                                            children: "Platform"
                                        }, void 0, false, {
                                            fileName: "[project]/components/RideControls.tsx",
                                            lineNumber: 181,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "font-medium capitalize",
                                            children: platform
                                        }, void 0, false, {
                                            fileName: "[project]/components/RideControls.tsx",
                                            lineNumber: 182,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/RideControls.tsx",
                                    lineNumber: 180,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex justify-between text-sm",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-muted-foreground",
                                            children: "Location"
                                        }, void 0, false, {
                                            fileName: "[project]/components/RideControls.tsx",
                                            lineNumber: 185,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "font-medium font-mono",
                                            children: coordsCopy
                                        }, void 0, false, {
                                            fileName: "[project]/components/RideControls.tsx",
                                            lineNumber: 186,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/RideControls.tsx",
                                    lineNumber: 184,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/RideControls.tsx",
                            lineNumber: 179,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mt-6 flex gap-3",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                                    variant: "outline",
                                    className: "flex-1 h-12",
                                    onClick: ()=>setActiveEvent(null),
                                    children: "Back"
                                }, void 0, false, {
                                    fileName: "[project]/components/RideControls.tsx",
                                    lineNumber: 191,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                                    className: "flex-1 h-12",
                                    variant: activeEvent.type === "booking_cancelled" ? "destructive" : "default",
                                    onClick: confirmEvent,
                                    disabled: submitting,
                                    children: submitting ? "Saving..." : "Confirm"
                                }, void 0, false, {
                                    fileName: "[project]/components/RideControls.tsx",
                                    lineNumber: 194,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/RideControls.tsx",
                            lineNumber: 190,
                            columnNumber: 13
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/RideControls.tsx",
                    lineNumber: 171,
                    columnNumber: 11
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/RideControls.tsx",
                lineNumber: 170,
                columnNumber: 9
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/components/RideControls.tsx",
        lineNumber: 114,
        columnNumber: 5
    }, this);
}
_s(RideControls, "tLcVjtzprSDBXdLM6wR5s8flALg=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"]
    ];
});
_c = RideControls;
function copyForEvent(type) {
    switch(type){
        case "booking_received":
            return "Booking";
        case "ride_started":
            return "Ride start";
        case "ride_completed":
            return "Ride completion";
        case "booking_cancelled":
            return "Cancellation";
        default:
            return "Event";
    }
}
var _c;
__turbopack_context__.k.register(_c, "RideControls");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/GpsAccuracyBadge.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GpsAccuracyBadge",
    ()=>GpsAccuracyBadge
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils.ts [app-client] (ecmascript)");
"use client";
;
;
function GpsAccuracyBadge({ accuracy, trackingOn }) {
    let label = trackingOn ? "GPS: waiting for fix" : "GPS: paused";
    let tone = "bg-muted text-muted-foreground";
    if (typeof accuracy === "number" && Number.isFinite(accuracy)) {
        const rounded = Math.max(0, Math.round(accuracy));
        if (rounded <= 30) {
            label = `GPS: ${rounded}m accuracy`;
            tone = "bg-emerald-100 text-emerald-900";
        } else if (rounded <= 100) {
            label = `GPS: ${rounded}m (ok)`;
            tone = "bg-amber-100 text-amber-900";
        } else {
            label = `GPS: ${rounded}m (weak) - move outdoors`;
            tone = "bg-rose-100 text-rose-900";
        }
    } else if (trackingOn) {
        tone = "bg-muted text-muted-foreground";
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("inline-flex rounded-full px-3 py-1 text-xs font-semibold", tone),
        children: label
    }, void 0, false, {
        fileName: "[project]/components/GpsAccuracyBadge.tsx",
        lineNumber: 31,
        columnNumber: 5
    }, this);
}
_c = GpsAccuracyBadge;
var _c;
__turbopack_context__.k.register(_c, "GpsAccuracyBadge");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/lib/offline-queue.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "drain",
    ()=>drain,
    "enqueue",
    ()=>enqueue
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$idb$2f$build$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/idb/build/index.js [app-client] (ecmascript)");
;
const DB = "ride-db";
const STORE = "events";
async function db() {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$idb$2f$build$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["openDB"])(DB, 1, {
        upgrade (d) {
            d.createObjectStore(STORE, {
                keyPath: "id",
                autoIncrement: true
            });
        }
    });
}
async function enqueue(e) {
    (await db()).add(STORE, {
        ...e,
        created_at: Date.now()
    });
}
async function drain(flush) {
    const d = await db();
    const tx = d.transaction(STORE, "readwrite");
    const s = tx.store;
    let c = await s.openCursor();
    while(c){
        const ok = await flush(c.value);
        if (ok) await c.delete();
        c = await c.continue();
    }
    await tx.done;
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/hooks/useLiveTracking.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "useLiveTracking",
    ()=>useLiveTracking
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$api$2d$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/api-client.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/tracking/store.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$offline$2d$queue$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/offline-queue.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-client] (ecmascript)");
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
const MIN_DISTANCE_DELTA = 30; // meters
const MIN_INTERVAL_MS = 5000;
const GOOD_ACCURACY_THRESHOLD = 150;
const RELAXED_ACCURACY_THRESHOLD = 300;
const MAX_ACCURACY_METERS = 250;
const ACCURACY_IMPROVEMENT_FACTOR = 0.5;
function useLiveTracking(opts) {
    _s();
    const trackingOn = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[trackingOn]": (s)=>s.trackingOn
    }["useLiveTracking.useTrackingStore[trackingOn]"]);
    const permissionStatus = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[permissionStatus]": (s)=>s.permissionStatus
    }["useLiveTracking.useTrackingStore[permissionStatus]"]);
    const lastFix = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[lastFix]": (s)=>s.lastFix
    }["useLiveTracking.useTrackingStore[lastFix]"]);
    const lastPingAt = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[lastPingAt]": (s)=>s.lastPingAt
    }["useLiveTracking.useTrackingStore[lastPingAt]"]);
    const lastRecommendation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[lastRecommendation]": (s)=>s.lastRecommendation
    }["useLiveTracking.useTrackingStore[lastRecommendation]"]);
    const error = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[error]": (s)=>s.error
    }["useLiveTracking.useTrackingStore[error]"]);
    const autoStartPending = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[autoStartPending]": (s)=>s.autoStartPending
    }["useLiveTracking.useTrackingStore[autoStartPending]"]);
    const allowLowAccuracy = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[allowLowAccuracy]": (s)=>s.allowLowAccuracy
    }["useLiveTracking.useTrackingStore[allowLowAccuracy]"]);
    const setTrackingOn = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[setTrackingOn]": (s)=>s.setTrackingOn
    }["useLiveTracking.useTrackingStore[setTrackingOn]"]);
    const setPermissionStatus = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[setPermissionStatus]": (s)=>s.setPermissionStatus
    }["useLiveTracking.useTrackingStore[setPermissionStatus]"]);
    const setLastFix = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[setLastFix]": (s)=>s.setLastFix
    }["useLiveTracking.useTrackingStore[setLastFix]"]);
    const setLastPingAt = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[setLastPingAt]": (s)=>s.setLastPingAt
    }["useLiveTracking.useTrackingStore[setLastPingAt]"]);
    const setRecommendation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[setRecommendation]": (s)=>s.setRecommendation
    }["useLiveTracking.useTrackingStore[setRecommendation]"]);
    const setError = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[setError]": (s)=>s.setError
    }["useLiveTracking.useTrackingStore[setError]"]);
    const setAutoStartPending = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[setAutoStartPending]": (s)=>s.setAutoStartPending
    }["useLiveTracking.useTrackingStore[setAutoStartPending]"]);
    const setAllowLowAccuracy = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"])({
        "useLiveTracking.useTrackingStore[setAllowLowAccuracy]": (s)=>s.setAllowLowAccuracy
    }["useLiveTracking.useTrackingStore[setAllowLowAccuracy]"]);
    const watchId = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const lastSentTimestamp = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(0);
    const lastBroadcastPosition = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const lastGoodFixRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const onFirstFix = opts?.onFirstFix;
    const updatePermissionFromNavigator = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useLiveTracking.useCallback[updatePermissionFromNavigator]": async ()=>{
            try {
                if (navigator.permissions?.query) {
                    const result = await navigator.permissions.query({
                        name: "geolocation"
                    });
                    setPermissionStatus(result.state);
                    result.onchange = ({
                        "useLiveTracking.useCallback[updatePermissionFromNavigator]": ()=>setPermissionStatus(result.state)
                    })["useLiveTracking.useCallback[updatePermissionFromNavigator]"];
                } else {
                    setPermissionStatus("unsupported");
                }
            } catch (err) {
                console.warn("permission query failed", err);
                setPermissionStatus("unsupported");
            }
        }
    }["useLiveTracking.useCallback[updatePermissionFromNavigator]"], [
        setPermissionStatus
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "useLiveTracking.useEffect": ()=>{
            updatePermissionFromNavigator();
        }
    }["useLiveTracking.useEffect"], [
        updatePermissionFromNavigator
    ]);
    const stopWatch = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useLiveTracking.useCallback[stopWatch]": ()=>{
            if (watchId.current !== null && typeof navigator !== "undefined" && navigator.geolocation) {
                navigator.geolocation.clearWatch(watchId.current);
                watchId.current = null;
            }
        }
    }["useLiveTracking.useCallback[stopWatch]"], []);
    const handlePingSuccess = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useLiveTracking.useCallback[handlePingSuccess]": (recommendation, timestampIso)=>{
            setLastPingAt(timestampIso);
            if (recommendation) {
                setRecommendation(recommendation);
            }
            setError(null);
        }
    }["useLiveTracking.useCallback[handlePingSuccess]"], [
        setLastPingAt,
        setRecommendation,
        setError
    ]);
    const sendPing = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useLiveTracking.useCallback[sendPing]": async (position)=>{
            const accuracy = typeof position.coords.accuracy === "number" && Number.isFinite(position.coords.accuracy) ? position.coords.accuracy : null;
            const speedKmh = typeof position.coords.speed === "number" && Number.isFinite(position.coords.speed) ? position.coords.speed * 3.6 : null;
            const fix = {
                lat: position.coords.latitude,
                lon: position.coords.longitude,
                accuracy,
                speed: speedKmh,
                timestamp: position.timestamp
            };
            setLastFix(fix);
            const accuracyAcceptable = accuracy !== null && accuracy <= MAX_ACCURACY_METERS;
            if (!accuracyAcceptable) {
                setError("GPS accuracy is weak (>250m). Move outdoors for a clear fix.");
                return;
            }
            setError(null);
            const now = Date.now();
            const last = lastBroadcastPosition.current;
            let accuracyImproved = false;
            if (last && typeof last.coords.accuracy === "number" && Number.isFinite(last.coords.accuracy)) {
                accuracyImproved = typeof accuracy === "number" && accuracy <= last.coords.accuracy * ACCURACY_IMPROVEMENT_FACTOR;
            }
            if (last && distanceMeters(last.coords, position.coords) < MIN_DISTANCE_DELTA && now - lastSentTimestamp.current < MIN_INTERVAL_MS && !accuracyImproved) {
                return;
            }
            lastBroadcastPosition.current = position;
            lastSentTimestamp.current = now;
            const payload = {
                lat: position.coords.latitude,
                lon: position.coords.longitude,
                ts: new Date(position.timestamp).toISOString(),
                accuracy_m: accuracy,
                speed_kmh: speedKmh ?? undefined
            };
            const { data, error } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$api$2d$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["postPing"])(payload);
            if (error) {
                setError(error.message);
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$offline$2d$queue$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["enqueue"])(payload);
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Could not sync live location. We'll retry soon.");
                return;
            }
            handlePingSuccess(data?.recommendation ?? null, payload.ts ?? new Date().toISOString());
        }
    }["useLiveTracking.useCallback[sendPing]"], [
        setLastFix,
        handlePingSuccess,
        setError
    ]);
    const requestPermission = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useLiveTracking.useCallback[requestPermission]": async ()=>{
            try {
                const { state } = await navigator.permissions.query({
                    name: "geolocation"
                });
                setPermissionStatus(state);
                if (state === "denied") {
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Location permission denied. Enable it in browser settings.");
                    return false;
                }
                if (state === "prompt") {
                    await new Promise({
                        "useLiveTracking.useCallback[requestPermission]": (resolve, reject)=>{
                            navigator.geolocation.getCurrentPosition(resolve, reject, {
                                enableHighAccuracy: true,
                                timeout: 15000,
                                maximumAge: 0
                            });
                        }
                    }["useLiveTracking.useCallback[requestPermission]"]);
                    setPermissionStatus("granted");
                }
                return true;
            } catch (error) {
                console.error("permission request failed", error);
                setPermissionStatus("unsupported");
                return false;
            }
        }
    }["useLiveTracking.useCallback[requestPermission]"], [
        setPermissionStatus
    ]);
    const stopTracking = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useLiveTracking.useCallback[stopTracking]": ()=>{
            stopWatch();
            setTrackingOn(false);
        }
    }["useLiveTracking.useCallback[stopTracking]"], [
        stopWatch,
        setTrackingOn
    ]);
    const startTracking = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useLiveTracking.useCallback[startTracking]": async ()=>{
            if (trackingOn) return true;
            const granted = await requestPermission();
            if (!granted) {
                setError("Location permission required for live tracking");
                return false;
            }
            setTrackingOn(true);
            return true;
        }
    }["useLiveTracking.useCallback[startTracking]"], [
        trackingOn,
        requestPermission,
        setTrackingOn,
        setError
    ]);
    const toggleTracking = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "useLiveTracking.useCallback[toggleTracking]": async ()=>{
            if (trackingOn) {
                stopTracking();
                return;
            }
            await startTracking();
        }
    }["useLiveTracking.useCallback[toggleTracking]"], [
        trackingOn,
        startTracking,
        stopTracking
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "useLiveTracking.useEffect": ()=>{
            if (!trackingOn && autoStartPending) {
                void startTracking();
                setAutoStartPending(false);
            }
        }
    }["useLiveTracking.useEffect"], [
        trackingOn,
        autoStartPending,
        startTracking,
        setAutoStartPending
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "useLiveTracking.useEffect": ()=>{
            if (!trackingOn) {
                stopWatch();
                return;
            }
            if (typeof navigator === "undefined" || !navigator.geolocation) {
                setError("Geolocation is not supported in this browser.");
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Geolocation is not available on this device.");
                setTrackingOn(false);
                return;
            }
            watchId.current = navigator.geolocation.watchPosition({
                "useLiveTracking.useEffect": (pos)=>sendPing(pos)
            }["useLiveTracking.useEffect"], {
                "useLiveTracking.useEffect": (err)=>{
                    console.error("watchPosition error", err);
                    const friendly = describeGeoError(err);
                    setError(friendly);
                    if (err.code === err.PERMISSION_DENIED) {
                        setTrackingOn(false);
                        setPermissionStatus("denied");
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Permission denied. Please re-enable location access.");
                    } else {
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(friendly);
                    }
                }
            }["useLiveTracking.useEffect"], {
                enableHighAccuracy: true,
                maximumAge: 0,
                timeout: 15000
            });
            return ({
                "useLiveTracking.useEffect": ()=>stopWatch()
            })["useLiveTracking.useEffect"];
        }
    }["useLiveTracking.useEffect"], [
        trackingOn,
        sendPing,
        stopWatch,
        setError,
        setTrackingOn,
        setPermissionStatus
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "useLiveTracking.useEffect": ()=>{
            function handleOnline() {
                setError(null);
            }
            window.addEventListener("online", handleOnline);
            return ({
                "useLiveTracking.useEffect": ()=>window.removeEventListener("online", handleOnline)
            })["useLiveTracking.useEffect"];
        }
    }["useLiveTracking.useEffect"], [
        setError
    ]);
    const accuracyThreshold = allowLowAccuracy ? RELAXED_ACCURACY_THRESHOLD : GOOD_ACCURACY_THRESHOLD;
    if (!trackingOn) {
        lastGoodFixRef.current = null;
    } else {
        const fixAccuracy = lastFix && typeof lastFix.accuracy === "number" && Number.isFinite(lastFix.accuracy) ? lastFix.accuracy : null;
        if (lastFix && fixAccuracy !== null && fixAccuracy <= accuracyThreshold) {
            lastGoodFixRef.current = lastFix;
        } else if (lastGoodFixRef.current && typeof lastGoodFixRef.current.accuracy === "number" && lastGoodFixRef.current.accuracy > accuracyThreshold) {
            lastGoodFixRef.current = null;
        }
    }
    const currentLocSource = lastGoodFixRef.current ?? lastFix;
    const currentLoc = currentLocSource ? {
        lat: currentLocSource.lat,
        lon: currentLocSource.lon,
        accuracy_m: typeof currentLocSource.accuracy === "number" && Number.isFinite(currentLocSource.accuracy) ? currentLocSource.accuracy : null,
        ts: currentLocSource.timestamp
    } : null;
    const hasLocation = Boolean(lastGoodFixRef.current);
    const lastGoodFixAt = lastGoodFixRef.current?.timestamp ?? null;
    const isFetchingLocation = trackingOn && !hasLocation;
    const prevHasLocationRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "useLiveTracking.useEffect": ()=>{
            const prev = prevHasLocationRef.current;
            if (!prev && hasLocation && currentLoc) {
                onFirstFix?.(currentLoc);
                try {
                    window.dispatchEvent(new CustomEvent("liveTracking:firstFix", {
                        detail: currentLoc
                    }));
                } catch  {
                // no-op if CustomEvent unavailable
                }
            }
            prevHasLocationRef.current = hasLocation;
        }
    }["useLiveTracking.useEffect"], [
        hasLocation,
        currentLoc,
        onFirstFix
    ]);
    return {
        trackingOn,
        permissionStatus,
        lastFix,
        lastPingAt,
        lastRecommendation,
        error,
        currentLoc,
        lastGoodFixAt,
        toggleTracking,
        startTracking,
        stopTracking,
        hasLocation,
        isFetchingLocation,
        allowLowAccuracy,
        setAllowLowAccuracy
    };
}
_s(useLiveTracking, "wdz+0klNIU++IR5R/ruJ6PrsXaY=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tracking$2f$store$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTrackingStore"]
    ];
});
function distanceMeters(a, b) {
    const R = 6371e3;
    const lat1 = a.latitude * Math.PI / 180;
    const lat2 = b.latitude * Math.PI / 180;
    const deltaLat = lat2 - lat1;
    const deltaLon = (b.longitude - a.longitude) * Math.PI / 180;
    const x = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) + Math.cos(lat1) * Math.cos(lat2) * Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(x), Math.sqrt(1 - x));
    return R * c;
}
function describeGeoError(err) {
    switch(err.code){
        case err.PERMISSION_DENIED:
            return "Location permission denied. Enable it in your browser settings.";
        case err.POSITION_UNAVAILABLE:
            return "GPS signal unavailable. Move outdoors for a clear view of the sky.";
        case err.TIMEOUT:
            return "Timed out while waiting for GPS. Try again from an open area.";
        default:
            return err.message || "Unable to determine your location.";
    }
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/lib/hooks/useDriverProfile.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "useDriverProfile",
    ()=>useDriverProfile
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2f$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/supabase/client.ts [app-client] (ecmascript)");
var _s = __turbopack_context__.k.signature();
"use client";
;
;
const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2f$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createBrowserSupabaseClient"])();
function useDriverProfile() {
    _s();
    const [profile, setProfile] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "useDriverProfile.useEffect": ()=>{
            let active = true;
            async function load() {
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) return;
                const { data } = await supabase.from("profiles").select("id,full_name").eq("id", user.id).maybeSingle();
                if (!active) return;
                setProfile({
                    id: user.id,
                    full_name: data?.full_name ?? user.user_metadata?.full_name ?? null
                });
            }
            load();
            return ({
                "useDriverProfile.useEffect": ()=>{
                    active = false;
                }
            })["useDriverProfile.useEffect"];
        }
    }["useDriverProfile.useEffect"], []);
    return profile;
}
_s(useDriverProfile, "ANwzos52wNXGupoJVH1cRI1qCto=");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/(driver)/DriverHomeClient.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>DriverHomeClient
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$layout$2f$DriverShell$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/layout/DriverShell.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$NextZonesPanel$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/NextZonesPanel.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$RideControls$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/RideControls.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$GpsAccuracyBadge$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/GpsAccuracyBadge.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$hooks$2f$useLiveTracking$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/hooks/useLiveTracking.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$hooks$2f$useDriverProfile$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/hooks/useDriverProfile.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$hooks$2f$useTodayStats$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/hooks/useTodayStats.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
;
;
function DriverHomeClient() {
    _s();
    const tracking = (0, __TURBOPACK__imported__module__$5b$project$5d2f$hooks$2f$useLiveTracking$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useLiveTracking"])();
    const profile = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$hooks$2f$useDriverProfile$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useDriverProfile"])();
    const { stats } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$hooks$2f$useTodayStats$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTodayStats"])();
    const greeting = profile?.full_name ? `Hi, ${profile.full_name.split(" ")[0]}` : "Hi driver";
    const subtitle = `Today | ${stats.totalTrips} trips | ?${stats.totalEarnings.toFixed(0)}`;
    const gpsReady = tracking.hasLocation;
    const waitingForGps = tracking.isFetchingLocation;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$layout$2f$DriverShell$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["DriverShell"], {
        title: greeting,
        subtitle: subtitle,
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "space-y-6",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex flex-col items-start gap-2 sm:items-end",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$GpsAccuracyBadge$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["GpsAccuracyBadge"], {
                                trackingOn: tracking.trackingOn,
                                accuracy: tracking.lastFix?.accuracy ?? null
                            }, void 0, false, {
                                fileName: "[project]/app/(driver)/DriverHomeClient.tsx",
                                lineNumber: 41,
                                columnNumber: 13
                            }, this),
                            waitingForGps && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "text-xs text-amber-600",
                                children: "Acquiring GPS fix..."
                            }, void 0, false, {
                                fileName: "[project]/app/(driver)/DriverHomeClient.tsx",
                                lineNumber: 46,
                                columnNumber: 15
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/(driver)/DriverHomeClient.tsx",
                        lineNumber: 35,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/app/(driver)/DriverHomeClient.tsx",
                    lineNumber: 28,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$NextZonesPanel$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["NextZonesPanel"], {
                    trackingOn: tracking.trackingOn,
                    hasLocation: tracking.hasLocation,
                    isFetchingLocation: tracking.isFetchingLocation,
                    currentLoc: tracking.currentLoc,
                    seedRecommendation: tracking.lastRecommendation,
                    allowLowAccuracy: tracking.allowLowAccuracy,
                    onAllowLowAccuracy: ()=>tracking.setAllowLowAccuracy(true)
                }, void 0, false, {
                    fileName: "[project]/app/(driver)/DriverHomeClient.tsx",
                    lineNumber: 53,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
                    className: "space-y-3",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                            className: "text-lg font-semibold",
                            children: "Ride actions"
                        }, void 0, false, {
                            fileName: "[project]/app/(driver)/DriverHomeClient.tsx",
                            lineNumber: 69,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$RideControls$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["RideControls"], {
                            lastFix: tracking.lastFix
                        }, void 0, false, {
                            fileName: "[project]/app/(driver)/DriverHomeClient.tsx",
                            lineNumber: 70,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/(driver)/DriverHomeClient.tsx",
                    lineNumber: 68,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/app/(driver)/DriverHomeClient.tsx",
            lineNumber: 27,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/app/(driver)/DriverHomeClient.tsx",
        lineNumber: 26,
        columnNumber: 5
    }, this);
}
_s(DriverHomeClient, "Xf9TLZANP9hroCevuPS/vJHPrPM=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$hooks$2f$useLiveTracking$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useLiveTracking"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$hooks$2f$useDriverProfile$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useDriverProfile"],
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$hooks$2f$useTodayStats$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useTodayStats"]
    ];
});
_c = DriverHomeClient;
var _c;
__turbopack_context__.k.register(_c, "DriverHomeClient");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
]);

//# sourceMappingURL=_16a056cd._.js.map