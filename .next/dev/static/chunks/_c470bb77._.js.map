{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACtB","debugId":null}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/layout/DriverShell.tsx"],"sourcesContent":["import { ReactNode } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface DriverShellProps {\n  title?: string;\n  subtitle?: string;\n  actions?: ReactNode;\n  children: ReactNode;\n  className?: string;\n}\n\nexport function DriverShell({ title, subtitle, actions, children, className }: DriverShellProps) {\n  return (\n    <section className={cn(\"flex h-full flex-col\", className)}>\n      {(title || subtitle || actions) && (\n        <header className=\"flex flex-col gap-2 border-b px-4 py-4 text-left\">\n          <div className=\"flex items-start justify-between gap-3\">\n            <div>\n              {title && <h1 className=\"text-2xl font-semibold leading-tight\">{title}</h1>}\n              {subtitle && <p className=\"text-sm text-muted-foreground\">{subtitle}</p>}\n            </div>\n            {actions && <div className=\"shrink-0\">{actions}</div>}\n          </div>\n        </header>\n      )}\n      <div className=\"flex-1 overflow-y-auto px-4 pb-24 pt-4 md:pb-8\">{children}</div>\n    </section>\n  );\n}\r\n"],"names":[],"mappings":";;;;;AACA;;;AAUO,SAAS,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAoB;IAC7F,qBACE,6LAAC;QAAQ,WAAW,IAAA,qHAAE,EAAC,wBAAwB;;YAC5C,CAAC,SAAS,YAAY,OAAO,mBAC5B,6LAAC;gBAAO,WAAU;0BAChB,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;;gCACE,uBAAS,6LAAC;oCAAG,WAAU;8CAAwC;;;;;;gCAC/D,0BAAY,6LAAC;oCAAE,WAAU;8CAAiC;;;;;;;;;;;;wBAE5D,yBAAW,6LAAC;4BAAI,WAAU;sCAAY;;;;;;;;;;;;;;;;;0BAI7C,6LAAC;gBAAI,WAAU;0BAAkD;;;;;;;;;;;;AAGvE;KAjBgB","debugId":null}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/LiveStatusChip.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface LiveStatusChipProps {\r\n  trackingOn: boolean;\r\n  lastPingAt: string | null;\r\n  permissionStatus: string;\r\n}\r\n\r\nexport function LiveStatusChip({ trackingOn, lastPingAt, permissionStatus }: LiveStatusChipProps) {\r\n  const [description, setDescription] = useState(\"--\");\r\n\r\n  useEffect(() => {\r\n    if (!lastPingAt) {\r\n      setDescription(\"No GPS yet\");\r\n      return;\r\n    }\r\n    const update = () => {\r\n      const seconds = Math.floor((Date.now() - Date.parse(lastPingAt)) / 1000);\r\n      if (seconds < 5) setDescription(\"Just now\");\r\n      else setDescription(`${seconds}s ago`);\r\n    };\r\n    update();\r\n    const id = setInterval(update, 5000);\r\n    return () => clearInterval(id);\r\n  }, [lastPingAt]);\r\n\r\n  let label = \"Paused\";\r\n  let color = \"bg-muted text-foreground\";\r\n\r\n  if (trackingOn && lastPingAt && Date.now() - Date.parse(lastPingAt) < 15000) {\r\n    label = \"Live | Updating\";\r\n    color = \"bg-emerald-600 text-white\";\r\n  } else if (!trackingOn) {\r\n    label = \"Paused\";\r\n  } else if (permissionStatus === \"denied\") {\r\n    label = \"No GPS\";\r\n    color = \"bg-amber-500 text-white\";\r\n  } else {\r\n    label = \"Waiting\";\r\n    color = \"bg-muted text-foreground\";\r\n  }\r\n\r\n  const detailClass = color.includes(\"text-white\") ? \"text-white/80\" : \"text-muted-foreground\";\r\n\r\n  return (\r\n    <div className={cn(\"inline-flex flex-col rounded-2xl px-4 py-2 text-xs font-medium\", color)}>\r\n      <span className=\"text-sm font-semibold leading-none\">{label}</span>\r\n      <span className={cn(\"text-[11px] leading-tight\", detailClass)}>\r\n        Last update: {description}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAWO,SAAS,eAAe,EAAE,UAAU,EAAE,UAAU,EAAE,gBAAgB,EAAuB;;IAC9F,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAE/C,IAAA,0KAAS;oCAAC;YACR,IAAI,CAAC,YAAY;gBACf,eAAe;gBACf;YACF;YACA,MAAM;mDAAS;oBACb,MAAM,UAAU,KAAK,KAAK,CAAC,CAAC,KAAK,GAAG,KAAK,KAAK,KAAK,CAAC,WAAW,IAAI;oBACnE,IAAI,UAAU,GAAG,eAAe;yBAC3B,eAAe,GAAG,QAAQ,KAAK,CAAC;gBACvC;;YACA;YACA,MAAM,KAAK,YAAY,QAAQ;YAC/B;4CAAO,IAAM,cAAc;;QAC7B;mCAAG;QAAC;KAAW;IAEf,IAAI,QAAQ;IACZ,IAAI,QAAQ;IAEZ,IAAI,cAAc,cAAc,KAAK,GAAG,KAAK,KAAK,KAAK,CAAC,cAAc,OAAO;QAC3E,QAAQ;QACR,QAAQ;IACV,OAAO,IAAI,CAAC,YAAY;QACtB,QAAQ;IACV,OAAO,IAAI,qBAAqB,UAAU;QACxC,QAAQ;QACR,QAAQ;IACV,OAAO;QACL,QAAQ;QACR,QAAQ;IACV;IAEA,MAAM,cAAc,MAAM,QAAQ,CAAC,gBAAgB,kBAAkB;IAErE,qBACE,6LAAC;QAAI,WAAW,IAAA,qHAAE,EAAC,kEAAkE;;0BACnF,6LAAC;gBAAK,WAAU;0BAAsC;;;;;;0BACtD,6LAAC;gBAAK,WAAW,IAAA,qHAAE,EAAC,6BAA6B;;oBAAc;oBAC/C;;;;;;;;;;;;;AAItB;GA5CgB;KAAA","debugId":null}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/api-client.ts"],"sourcesContent":["export type ApiError = {\n  code: string;\n  message: string;\n  details?: unknown;\n};\n\nasync function parseJson<T>(res: Response): Promise<T | null> {\n  if (res.status === 204) return null;\n  const contentType = res.headers.get(\"content-type\");\n  if (contentType && contentType.includes(\"application/json\")) {\n    return (await res.json()) as T;\n  }\n  return null;\n}\n\nasync function handleResponse<T>(\n  res: Response\n): Promise<{ data: T | null; error: ApiError | null }> {\n  if (res.ok) {\n    const data = await parseJson<T>(res);\n    return { data, error: null };\n  }\n\n  const payload =\n    (await parseJson<{ error?: { code: string; message: string; details?: unknown } }>(\n      res\n    )) || undefined;\n\n  const error: ApiError = {\n    code: payload?.error?.code || `HTTP_${res.status}`,\n    message: payload?.error?.message || res.statusText,\n    details: payload?.error?.details,\n  };\n  return { data: null, error };\n}\n\nexport async function apiGet<T>(url: string) {\n  const res = await fetch(url, {\n    cache: \"no-store\",\n    credentials: \"include\",\n  });\n  return handleResponse<T>(res);\n}\n\nexport async function apiPost<T, B = unknown>(url: string, body: B) {\n  const res = await fetch(url, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify(body),\n    credentials: \"include\",\n  });\n  return handleResponse<T>(res);\n}\n\nexport type RecommendationZone = {\n  zone_id: string | number;\n  zone_name: string;\n  lat: number;\n  lon: number;\n  distance_km: number;\n  eta_min: number;\n  score: number;\n  reason: string;\n  success_prob?: number;\n  expected_fare_inr?: number;\n  normalized_fare?: number;\n  traffic_penalty?: number;\n  traffic_speed_idx?: number | null;\n};\n\nexport type RecommendationResponse = {\n  computed_at: string;\n  source?: string;\n  traffic_source?: \"google\" | \"cache\" | \"fallback\" | null;\n  context?: Record<string, unknown> | null;\n  top: RecommendationZone[];\n};\n\nexport type GeoPoint = {\n  type: \"Point\";\n  coordinates: [number, number];\n  crs?: { type: string; properties: Record<string, any> };\n};\n\nexport type DriverState = {\n  driver_id: string;\n  last_ping_at: string | null;\n  loc: GeoPoint | null;\n  lat: number | null;\n  lon: number | null;\n  snapped_zone: number | null;\n  speed_kmh: number | null;\n  battery_pct: number | null;\n  last_ping_accuracy_m: number | null;\n  recommendation: RecommendationResponse | null;\n  updated_at: string | null;\n  coords?: { lat: number; lon: number } | null;\n};\n\nexport type DriverStateResponse = {\n  data: DriverState | null;\n  status?: string;\n  message?: string;\n} | null;\n\nexport type PingPayload = {\n  lat: number;\n  lon: number;\n  ts?: string;\n  accuracy_m?: number | null;\n  speed_kmh?: number | null;\n  battery_pct?: number | null;\n  traffic_context?: Record<string, unknown>;\n};\n\nexport async function postPing(payload: PingPayload) {\n  return apiPost<{ zone_id: number | null; recommendation: RecommendationResponse | null }>(\n    \"/api/pings\",\n    payload\n  );\n}\n\nexport async function fetchDriverState() {\n  return apiGet<DriverStateResponse>(\"/api/driver-state\");\n}\n\nexport async function fetchRecommendations(params?: {\n  lat?: number;\n  lon?: number;\n  k?: number;\n}) {\n  const qs = new URLSearchParams();\n  if (params?.lat !== undefined) qs.set(\"lat\", String(params.lat));\n  if (params?.lon !== undefined) qs.set(\"lon\", String(params.lon));\n  if (params?.k !== undefined) qs.set(\"k\", String(params.k));\n  const suffix = qs.toString();\n  return apiGet<RecommendationResponse>(\n    `/api/recommendations/next-spot${suffix ? `?${suffix}` : \"\"}`\n  );\n}\n\nexport type RideEventPayload = {\n  event_type: \"booking_received\" | \"ride_started\" | \"ride_completed\" | \"booking_cancelled\";\n  platform: \"ola\" | \"uber\";\n  pickup_lat?: number;\n  pickup_lon?: number;\n  drop_lat?: number;\n  drop_lon?: number;\n  surge_multiplier?: number;\n  promo_code?: string;\n};\n\nexport async function postRideEvent(payload: RideEventPayload) {\n  return apiPost<{ ok: boolean; event_id: number | null }>(\"/api/ride-events/ingest\", {\n    occurred_at: new Date().toISOString(),\n    ...payload,\n  });\n}\n\nexport type OpsDailyInput = {\n  day?: string;\n  platforms?: (\"ola\" | \"uber\")[];\n  idle_minutes?: number;\n  energy_kwh?: number;\n  energy_cost_inr?: number;\n  fuel_litres?: number;\n  fuel_cost_inr?: number;\n  tolls_parking_inr?: number;\n  notes?: string;\n};\n\nexport async function upsertOpsDaily(payload: OpsDailyInput) {\n  return apiPost<{\n    driver_id: string;\n    day: string;\n    idle_minutes: number | null;\n    energy_kwh: number | null;\n    energy_cost_inr: number | null;\n    tolls_parking_inr: number | null;\n    notes: string | null;\n  }>(\"/api/ops-daily/upsert\", payload);\n}\n\nexport type TripSyncPayload = {\n  booking_at?: string;\n  pickup_at: string;\n  drop_at: string;\n  pickup_lat: number;\n  pickup_lon: number;\n  drop_lat: number;\n  drop_lon: number;\n  distance_km: number;\n  fare_inr: number;\n  platform: \"ola\" | \"uber\";\n  surge_multiplier?: number;\n  promo_code?: string;\n  tip_inr?: number;\n};\n\nexport async function postTripSync(payload: TripSyncPayload) {\n  return apiPost<{ trip_id: number | null }>(\"/api/trips/sync\", payload);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAMA,eAAe,UAAa,GAAa;IACvC,IAAI,IAAI,MAAM,KAAK,KAAK,OAAO;IAC/B,MAAM,cAAc,IAAI,OAAO,CAAC,GAAG,CAAC;IACpC,IAAI,eAAe,YAAY,QAAQ,CAAC,qBAAqB;QAC3D,OAAQ,MAAM,IAAI,IAAI;IACxB;IACA,OAAO;AACT;AAEA,eAAe,eACb,GAAa;IAEb,IAAI,IAAI,EAAE,EAAE;QACV,MAAM,OAAO,MAAM,UAAa;QAChC,OAAO;YAAE;YAAM,OAAO;QAAK;IAC7B;IAEA,MAAM,UACJ,AAAC,MAAM,UACL,QACI;IAER,MAAM,QAAkB;QACtB,MAAM,SAAS,OAAO,QAAQ,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;QAClD,SAAS,SAAS,OAAO,WAAW,IAAI,UAAU;QAClD,SAAS,SAAS,OAAO;IAC3B;IACA,OAAO;QAAE,MAAM;QAAM;IAAM;AAC7B;AAEO,eAAe,OAAU,GAAW;IACzC,MAAM,MAAM,MAAM,MAAM,KAAK;QAC3B,OAAO;QACP,aAAa;IACf;IACA,OAAO,eAAkB;AAC3B;AAEO,eAAe,QAAwB,GAAW,EAAE,IAAO;IAChE,MAAM,MAAM,MAAM,MAAM,KAAK;QAC3B,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;QACrB,aAAa;IACf;IACA,OAAO,eAAkB;AAC3B;AA+DO,eAAe,SAAS,OAAoB;IACjD,OAAO,QACL,cACA;AAEJ;AAEO,eAAe;IACpB,OAAO,OAA4B;AACrC;AAEO,eAAe,qBAAqB,MAI1C;IACC,MAAM,KAAK,IAAI;IACf,IAAI,QAAQ,QAAQ,WAAW,GAAG,GAAG,CAAC,OAAO,OAAO,OAAO,GAAG;IAC9D,IAAI,QAAQ,QAAQ,WAAW,GAAG,GAAG,CAAC,OAAO,OAAO,OAAO,GAAG;IAC9D,IAAI,QAAQ,MAAM,WAAW,GAAG,GAAG,CAAC,KAAK,OAAO,OAAO,CAAC;IACxD,MAAM,SAAS,GAAG,QAAQ;IAC1B,OAAO,OACL,CAAC,8BAA8B,EAAE,SAAS,CAAC,CAAC,EAAE,QAAQ,GAAG,IAAI;AAEjE;AAaO,eAAe,cAAc,OAAyB;IAC3D,OAAO,QAAkD,2BAA2B;QAClF,aAAa,IAAI,OAAO,WAAW;QACnC,GAAG,OAAO;IACZ;AACF;AAcO,eAAe,eAAe,OAAsB;IACzD,OAAO,QAQJ,yBAAyB;AAC9B;AAkBO,eAAe,aAAa,OAAwB;IACzD,OAAO,QAAoC,mBAAmB;AAChE","debugId":null}},
    {"offset": {"line": 295, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/hooks/useDriverState.ts"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useState } from \"react\";\nimport { DriverState, type DriverStateResponse, fetchDriverState } from \"@/lib/api-client\";\n\nfunction unwrapDriverState(payload: DriverStateResponse | DriverState | null): DriverState | null {\n  if (!payload) return null;\n  if (typeof (payload as DriverStateResponse)?.data !== \"undefined\") {\n    return (payload as DriverStateResponse)?.data ?? null;\n  }\n  return payload as DriverState;\n}\n\nexport function useDriverState(pollMs: number = 0) {\n  const [data, setData] = useState<DriverState | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const load = useCallback(async () => {\n    const { data, error } = await fetchDriverState();\n    if (error) {\n      setError(error.message);\n    } else {\n      setError(null);\n      setData(unwrapDriverState(data ?? null));\n    }\n    setLoading(false);\n  }, []);\n\n  useEffect(() => {\n    load();\n    if (pollMs > 0) {\n      const id = setInterval(load, pollMs);\n      return () => clearInterval(id);\n    }\n  }, [load, pollMs]);\n\n  return { data, loading, error, refresh: load };\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAKA,SAAS,kBAAkB,OAAiD;IAC1E,IAAI,CAAC,SAAS,OAAO;IACrB,IAAI,OAAQ,SAAiC,SAAS,aAAa;QACjE,OAAO,AAAC,SAAiC,QAAQ;IACnD;IACA,OAAO;AACT;AAEO,SAAS,eAAe,SAAiB,CAAC;;IAC/C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAqB;IACrD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAgB;IAElD,MAAM,OAAO,IAAA,4KAAW;4CAAC;YACvB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,IAAA,2IAAgB;YAC9C,IAAI,OAAO;gBACT,SAAS,MAAM,OAAO;YACxB,OAAO;gBACL,SAAS;gBACT,QAAQ,kBAAkB,QAAQ;YACpC;YACA,WAAW;QACb;2CAAG,EAAE;IAEL,IAAA,0KAAS;oCAAC;YACR;YACA,IAAI,SAAS,GAAG;gBACd,MAAM,KAAK,YAAY,MAAM;gBAC7B;gDAAO,IAAM,cAAc;;YAC7B;QACF;mCAAG;QAAC;QAAM;KAAO;IAEjB,OAAO;QAAE;QAAM;QAAS;QAAO,SAAS;IAAK;AAC/C;GAzBgB","debugId":null}},
    {"offset": {"line": 358, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/tracking/store.ts"],"sourcesContent":["\"use client\";\n\nimport { create } from \"zustand\";\nimport type { RecommendationResponse } from \"@/lib/api-client\";\n\nexport type PermissionStateMaybe = PermissionState | \"prompt\" | \"unsupported\";\n\nexport type TrackingFix = {\n  lat: number;\n  lon: number;\n  accuracy?: number | null;\n  speed?: number | null;\n  timestamp: number;\n};\n\ninterface TrackingState {\n  trackingOn: boolean;\n  permissionStatus: PermissionStateMaybe;\n  lastFix: TrackingFix | null;\n  lastPingAt: string | null;\n  lastRecommendation: RecommendationResponse | null;\n  error: string | null;\n  isDriving: boolean;\n  autoStartPending: boolean;\n  allowLowAccuracy: boolean;\n  setTrackingOn: (next: boolean) => void;\n  setPermissionStatus: (status: PermissionStateMaybe) => void;\n  setLastFix: (fix: TrackingFix | null) => void;\n  setLastPingAt: (iso: string | null) => void;\n  setRecommendation: (rec: RecommendationResponse | null) => void;\n  setError: (message: string | null) => void;\n  setIsDriving: (next: boolean) => void;\n  setAutoStartPending: (pending: boolean) => void;\n  setAllowLowAccuracy: (next: boolean) => void;\n}\n\nexport const useTrackingStore = create<TrackingState>((set) => ({\n  trackingOn: false,\n  permissionStatus: \"prompt\",\n  lastFix: null,\n  lastPingAt: null,\n  lastRecommendation: null,\n  error: null,\n  isDriving: false,\n  autoStartPending: true,\n  allowLowAccuracy: false,\n  setTrackingOn: (trackingOn) => set({ trackingOn }),\n  setPermissionStatus: (permissionStatus) => set({ permissionStatus }),\n  setLastFix: (lastFix) => set({ lastFix }),\n  setLastPingAt: (lastPingAt) => set({ lastPingAt }),\n  setRecommendation: (lastRecommendation) => set({ lastRecommendation }),\n  setError: (error) => set({ error }),\n  setIsDriving: (isDriving) =>\n    set(() => ({\n      isDriving,\n      autoStartPending: isDriving ? false : true,\n    })),\n  setAutoStartPending: (autoStartPending) => set({ autoStartPending }),\n  setAllowLowAccuracy: (allowLowAccuracy) => set({ allowLowAccuracy }),\n}));\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AAoCO,MAAM,mBAAmB,IAAA,qKAAM,EAAgB,CAAC,MAAQ,CAAC;QAC9D,YAAY;QACZ,kBAAkB;QAClB,SAAS;QACT,YAAY;QACZ,oBAAoB;QACpB,OAAO;QACP,WAAW;QACX,kBAAkB;QAClB,kBAAkB;QAClB,eAAe,CAAC,aAAe,IAAI;gBAAE;YAAW;QAChD,qBAAqB,CAAC,mBAAqB,IAAI;gBAAE;YAAiB;QAClE,YAAY,CAAC,UAAY,IAAI;gBAAE;YAAQ;QACvC,eAAe,CAAC,aAAe,IAAI;gBAAE;YAAW;QAChD,mBAAmB,CAAC,qBAAuB,IAAI;gBAAE;YAAmB;QACpE,UAAU,CAAC,QAAU,IAAI;gBAAE;YAAM;QACjC,cAAc,CAAC,YACb,IAAI,IAAM,CAAC;oBACT;oBACA,kBAAkB,YAAY,QAAQ;gBACxC,CAAC;QACH,qBAAqB,CAAC,mBAAqB,IAAI;gBAAE;YAAiB;QAClE,qBAAqB,CAAC,mBAAqB,IAAI;gBAAE;YAAiB;IACpE,CAAC","debugId":null}},
    {"offset": {"line": 411, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst Card = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\r\n      \"rounded-2xl border bg-card text-card-foreground shadow-sm\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nCard.displayName = \"Card\";\r\n\r\nconst CardHeader = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\r\n    {...props}\r\n  />\r\n));\r\nCardHeader.displayName = \"CardHeader\";\r\n\r\nconst CardTitle = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLHeadingElement>\r\n>(({ className, ...props }, ref) => (\r\n  <h3\r\n    ref={ref}\r\n    className={cn(\r\n      \"text-2xl font-semibold leading-none tracking-tight\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nCardTitle.displayName = \"CardTitle\";\r\n\r\nconst CardDescription = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, ...props }, ref) => (\r\n  <p\r\n    ref={ref}\r\n    className={cn(\"text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n));\r\nCardDescription.displayName = \"CardDescription\";\r\n\r\nconst CardContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\r\n));\r\nCardContent.displayName = \"CardContent\";\r\n\r\nconst CardFooter = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"flex items-center p-6 pt-0\", className)}\r\n    {...props}\r\n  />\r\n));\r\nCardFooter.displayName = \"CardFooter\";\r\n\r\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AACA;;;;AAEA,MAAM,qBAAO,2KAAgB,MAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,6DACA;QAED,GAAG,KAAK;;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,2KAAgB,OAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,2KAAgB,OAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,sDACA;QAED,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,2KAAgB,OAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAI,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,2KAAgB,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 518, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-bg transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\r\n        destructive:\r\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\r\n        outline:\r\n          \"border border-input bg-bg hover:bg-accent hover:text-accent-foreground\",\r\n        secondary:\r\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\r\n        link: \"text-primary underline-offset-4 hover:underline\",\r\n      },\r\n      size: {\r\n        default: \"h-10 px-4 py-2\",\r\n        sm: \"h-9 rounded-md px-3\",\r\n        lg: \"h-11 rounded-md px-8\",\r\n        icon: \"h-10 w-10\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n);\r\n\r\nexport interface ButtonProps\r\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n    VariantProps<typeof buttonVariants> {\r\n  asChild?: boolean;\r\n}\r\n\r\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"button\";\r\n    return (\r\n      <Comp\r\n        className={cn(buttonVariants({ variant, size, className }))}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    );\r\n  }\r\n);\r\nButton.displayName = \"Button\";\r\n\r\nexport { Button, buttonVariants };\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;;;;;;AAEA,MAAM,iBAAiB,IAAA,0KAAG,EACxB,oVACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,2KAAgB,MAC7B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,2KAAI,GAAG;IAC9B,qBACE,6LAAC;QACC,WAAW,IAAA,qHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,OAAO,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 585, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/nearest-zones.ts"],"sourcesContent":["import type { ZoneRow } from \"@/hooks/useZones\";\r\n\r\nexport type Coordinate = {\r\n  lat: number;\r\n  lon: number;\r\n};\r\n\r\nexport type LocalZoneSuggestion = {\r\n  zone_id: ZoneRow[\"id\"];\r\n  zone_name: string;\r\n  lat: number;\r\n  lon: number;\r\n  distance_m: number;\r\n  distance_km: number;\r\n  eta_min: number;\r\n  score: number;\r\n  radius_km: number | null;\r\n  weight_demand: number | null;\r\n  inside_radius: boolean;\r\n  reason: string;\r\n};\r\n\r\nexport type ComputeNearestZonesOptions = {\r\n  limit?: number;\r\n  vehicleSpeedKmh?: number;\r\n  origin?: string;\r\n};\r\n\r\nexport type ComputeNearestZonesResult = {\r\n  results: LocalZoneSuggestion[];\r\n  best: LocalZoneSuggestion | null;\r\n};\r\n\r\nconst EARTH_RADIUS_M = 6371e3;\r\nconst DEFAULT_SPEED_KMH = 20;\r\n\r\nfunction toRadians(value: number) {\r\n  return (value * Math.PI) / 180;\r\n}\r\n\r\nfunction distanceMeters(a: Coordinate, b: Coordinate) {\r\n  const deltaLat = toRadians(b.lat - a.lat);\r\n  const deltaLon = toRadians(b.lon - a.lon);\r\n  const lat1 = toRadians(a.lat);\r\n  const lat2 = toRadians(b.lat);\r\n\r\n  const haversine =\r\n    Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\r\n    Math.cos(lat1) * Math.cos(lat2) *\r\n      Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\r\n  const c = 2 * Math.atan2(Math.sqrt(haversine), Math.sqrt(1 - haversine));\r\n  return EARTH_RADIUS_M * c;\r\n}\r\n\r\nfunction resolveZoneCoordinate(zone: ZoneRow): Coordinate | null {\r\n  const center = zone.center as { coordinates?: [number, number] } | null;\r\n  if (center && Array.isArray(center.coordinates) && center.coordinates.length === 2) {\r\n    const [lon, lat] = center.coordinates;\r\n    if (typeof lat === \"number\" && typeof lon === \"number\") {\r\n      return { lat, lon };\r\n    }\r\n  }\r\n\r\n  if (typeof zone.lat === \"number\" && typeof zone.lon === \"number\") {\r\n    return { lat: zone.lat, lon: zone.lon };\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction clampScore(value: number) {\r\n  return Math.max(0, Math.min(1, Number(value.toFixed(4))));\r\n}\r\n\r\nfunction computeZoneScore(distanceKm: number, insideRadius: boolean, weight: number | null | undefined) {\r\n  const distanceScore = Math.max(0, 1 - distanceKm / 4); // degrade after 4km\r\n  const insideBoost = insideRadius ? 0.2 : 0;\r\n  const normalizedWeight = typeof weight === \"number\" && Number.isFinite(weight) ? weight : 1;\r\n  const demandBoost = Math.min(0.4, (normalizedWeight - 1) * 0.25);\r\n  return clampScore(distanceScore + insideBoost + demandBoost);\r\n}\r\n\r\nfunction describeReason(distanceM: number, insideRadius: boolean, weight: number | null | undefined) {\r\n  const parts: string[] = [];\r\n  if (distanceM < 1000) {\r\n    parts.push(`${Math.round(distanceM)}m away`);\r\n  } else {\r\n    parts.push(`${(distanceM / 1000).toFixed(1)} km away`);\r\n  }\r\n  if (insideRadius) {\r\n    parts.push(\"inside zone radius\");\r\n  }\r\n  if (typeof weight === \"number\" && weight > 1) {\r\n    parts.push(`demand +${Math.round((weight - 1) * 100)}%`);\r\n  }\r\n  return `Local pick • ${parts.join(\" · \")}`;\r\n}\r\n\r\nexport function computeNearestZones(\r\n  zones: ZoneRow[],\r\n  location: Coordinate,\r\n  opts?: ComputeNearestZonesOptions\r\n): ComputeNearestZonesResult {\r\n  if (!zones.length) {\r\n    return { results: [], best: null };\r\n  }\r\n  const limit = opts?.limit ?? 3;\r\n  const speed = opts?.vehicleSpeedKmh ?? DEFAULT_SPEED_KMH;\r\n\r\n  const enriched = zones\r\n    .map<LocalZoneSuggestion | null>((zone) => {\r\n      const coord = resolveZoneCoordinate(zone);\r\n      if (!coord) return null;\r\n\r\n      const distance_m = distanceMeters(location, coord);\r\n      const distance_km = distance_m / 1000;\r\n      const radius_km =\r\n        typeof zone.radius_km === \"number\" && Number.isFinite(zone.radius_km)\r\n          ? zone.radius_km\r\n          : null;\r\n      const inside_radius = radius_km !== null ? distance_m <= radius_km * 1000 : distance_m <= 500;\r\n      const eta_min = Math.max(1, Math.round((distance_km / speed) * 60));\r\n      const score = computeZoneScore(distance_km, inside_radius, zone.weight_demand ?? null);\r\n\r\n      return {\r\n        zone_id: zone.id,\r\n        zone_name: zone.name,\r\n        lat: coord.lat,\r\n        lon: coord.lon,\r\n        distance_m,\r\n        distance_km,\r\n        eta_min,\r\n        score,\r\n        radius_km,\r\n        weight_demand: zone.weight_demand ?? null,\r\n        inside_radius,\r\n        reason: describeReason(distance_m, inside_radius, zone.weight_demand ?? null),\r\n      };\r\n    })\r\n    .filter(Boolean)\r\n    .sort((a, b) => {\r\n      if (!a || !b) return 0;\r\n      if (a.score === b.score) {\r\n        return a.distance_m - b.distance_m;\r\n      }\r\n      return b.score - a.score;\r\n    })\r\n    .slice(0, limit) as LocalZoneSuggestion[];\r\n\r\n  if (enriched.length && typeof window !== \"undefined\") {\r\n    console.log(\"[nearest-zones] computed\", {\r\n      origin: opts?.origin ?? \"unknown\",\r\n      best_zone: enriched[0]?.zone_name,\r\n      distance_m: Math.round(enriched[0]?.distance_m ?? 0),\r\n      considered: zones.length,\r\n    });\r\n  }\r\n\r\n  return { results: enriched, best: enriched[0] ?? null };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 706, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/NextZonesPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { RecommendationResponse, type DriverState } from \"@/lib/api-client\";\nimport { useDriverState } from \"@/lib/hooks/useDriverState\";\nimport { useTrackingStore } from \"@/lib/tracking/store\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowUpRight, MapPin, RefreshCw } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport type { CurrentLocation } from \"@/hooks/useLiveTracking\";\nimport { useZones } from \"@/hooks/useZones\";\nimport { computeNearestZones } from \"@/lib/nearest-zones\";\n\ninterface NextZonesPanelProps {\n  trackingOn: boolean;\n  hasLocation: boolean;\n  isFetchingLocation: boolean;\n  currentLoc: CurrentLocation | null;\n  seedRecommendation?: RecommendationResponse | null;\n  allowLowAccuracy?: boolean;\n  onAllowLowAccuracy?: () => void;\n}\n\nconst STALE_MS = 45_000;\nconst AUTO_REFRESH_MS = 180_000; // 3 minutes\n\nexport function NextZonesPanel({\n  trackingOn,\n  hasLocation,\n  isFetchingLocation,\n  currentLoc,\n  seedRecommendation,\n  allowLowAccuracy,\n  onAllowLowAccuracy,\n}: NextZonesPanelProps) {\n  const { data: driverState } = useDriverState();\n  const { zones } = useZones();\n  const [recommendation, setRecommendation] = useState<RecommendationResponse | null>(\n    seedRecommendation ?? null\n  );\n  const [loading, setLoading] = useState(!seedRecommendation);\n  const [error, setError] = useState<string | null>(null);\n  const setTrackingRecommendation = useTrackingStore((s) => s.setRecommendation);\n  const lastFix = useTrackingStore((s) => s.lastFix);\n  const lastFixRef = useRef(lastFix);\n  const lastFetchAtRef = useRef(0);\n  const currentLocRef = useRef<CurrentLocation | null>(currentLoc);\n  const hasLocationRef = useRef(hasLocation);\n  const lastFetchedCoordsRef = useRef<{ lat: number; lon: number } | null>(null);\n  const debounceTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const initialFetchTriggeredRef = useRef(false);\n\n  useEffect(() => {\n    lastFixRef.current = lastFix;\n  }, [lastFix]);\n\n  useEffect(() => {\n    currentLocRef.current = currentLoc;\n  }, [currentLoc]);\n\n  useEffect(() => {\n    hasLocationRef.current = hasLocation;\n  }, [hasLocation]);\n\n  const fallbackLocation = useMemo(() => selectBestLocation(currentLoc, driverState), [currentLoc, driverState]);\n\n  const syncRecommendation = useCallback(\n    (next: RecommendationResponse | null) => {\n      setRecommendation(next);\n      setTrackingRecommendation(next);\n    },\n    [setTrackingRecommendation]\n  );\n\n  const buildLocalRecommendation = useCallback(\n    (\n      coords: { lat: number; lon: number },\n      meta: { origin: \"live_fix\" | \"driver_state_coords\" | \"driver_state_loc\"; trigger: string }\n    ): RecommendationResponse | null => {\n      if (!zones.length) return null;\n      const { results } = computeNearestZones(zones, coords, {\n        limit: 3,\n        origin: meta.origin,\n      });\n      const top = results.map((zone) => ({\n        zone_id: zone.zone_id,\n        zone_name: zone.zone_name,\n        lat: zone.lat,\n        lon: zone.lon,\n        distance_km: Number(zone.distance_km.toFixed(2)),\n        eta_min: zone.eta_min,\n        score: zone.score,\n        reason: zone.reason,\n        traffic_speed_idx: null,\n      }));\n\n      return {\n        computed_at: new Date().toISOString(),\n        source: \"local\",\n        traffic_source: \"fallback\",\n        context: {\n          reason: top.length ? \"local_inference\" : \"no_zones_in_db\",\n          origin: meta.origin,\n          trigger: meta.trigger,\n        },\n        top,\n      };\n    },\n    [zones]\n  );\n\n  useEffect(() => {\n    if (!fallbackLocation) return;\n    if (recommendation?.top?.length) return;\n    const seeded = buildLocalRecommendation(fallbackLocation.coords, {\n      origin: fallbackLocation.source,\n      trigger: \"driver_state_seed\",\n    });\n    if (seeded && seeded.top.length) {\n      setError(null);\n      setLoading(false);\n      syncRecommendation(seeded);\n    }\n  }, [fallbackLocation, recommendation, buildLocalRecommendation, syncRecommendation]);\n\n  const hydrateFromState = useCallback(() => {\n    if (driverState?.recommendation) {\n      const rec = driverState.recommendation;\n      if (Date.now() - Date.parse(rec.computed_at) < STALE_MS) {\n        syncRecommendation(rec);\n        setError(null);\n        setLoading(false);\n        return true;\n      }\n    }\n    return false;\n  }, [driverState, syncRecommendation]);\n\n  const fetchLatest = useCallback(\n    async (reason: string = \"manual\") => {\n      const loc = currentLocRef.current;\n      if (!loc || !hasLocationRef.current) {\n        setLoading(false);\n        return;\n      }\n\n      lastFetchAtRef.current = Date.now();\n      lastFetchedCoordsRef.current = { lat: loc.lat, lon: loc.lon };\n      setLoading(true);\n      setError(null);\n\n      const localRecommendation = buildLocalRecommendation(\n        { lat: loc.lat, lon: loc.lon },\n        { origin: \"live_fix\", trigger: reason }\n      );\n\n      if (!localRecommendation || localRecommendation.top.length === 0) {\n        setError(\"No zones with coordinates are configured yet.\");\n      } else {\n        setError(null);\n        syncRecommendation(localRecommendation);\n      }\n      setLoading(false);\n    },\n    [buildLocalRecommendation, syncRecommendation]\n  );\n\n  useEffect(() => {\n    if (!seedRecommendation && hasLocation) {\n      if (!hydrateFromState()) {\n        fetchLatest(\"initial_state\");\n      }\n    }\n  }, [seedRecommendation, hasLocation, hydrateFromState, fetchLatest]);\n\n  const requestRefresh = useCallback(\n    (reason: string) => {\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n      debounceTimerRef.current = setTimeout(() => {\n        debounceTimerRef.current = null;\n        void fetchLatest(reason);\n      }, 800);\n    },\n    [fetchLatest]\n  );\n\n  useEffect(() => {\n    if (!hasLocation) {\n      initialFetchTriggeredRef.current = false;\n    }\n  }, [hasLocation]);\n\n  // Kick off the first fetch as soon as we have a good GPS fix\n  useEffect(() => {\n    if (!hasLocation || !currentLoc) return;\n    if (!initialFetchTriggeredRef.current) {\n      initialFetchTriggeredRef.current = true;\n      void fetchLatest(\"first_fix\");\n    }\n  }, [hasLocation, currentLoc, fetchLatest]);\n\n  // Refresh when the driver moves ~50m or every 15s while tracking\n  useEffect(() => {\n    if (!hasLocation || !currentLoc || !initialFetchTriggeredRef.current) return;\n    const lastCoords = lastFetchedCoordsRef.current;\n    const now = Date.now();\n    const movedMeters = lastCoords\n      ? distanceBetweenMeters(lastCoords.lat, lastCoords.lon, currentLoc.lat, currentLoc.lon)\n      : Infinity;\n\n    if (\n      !lastCoords ||\n      movedMeters >= 50 ||\n      now - lastFetchAtRef.current >= 15_000\n    ) {\n      requestRefresh(\"movement_or_interval\");\n    }\n  }, [hasLocation, currentLoc, requestRefresh]);\n\n  useEffect(() => {\n    hydrateFromState();\n  }, [driverState, hydrateFromState]);\n\n  useEffect(() => {\n    return () => {\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (\n      seedRecommendation &&\n      (!recommendation ||\n        seedRecommendation.computed_at !== recommendation.computed_at)\n    ) {\n      syncRecommendation(seedRecommendation);\n    }\n  }, [seedRecommendation, recommendation, syncRecommendation]);\n\n  const runAutoRefresh = useCallback(() => {\n    if (!hasLocationRef.current) return;\n    const now = Date.now();\n    if (now - lastFetchAtRef.current < AUTO_REFRESH_MS) {\n      return;\n    }\n    void fetchLatest(\"auto_refresh\");\n  }, [fetchLatest]);\n\n  useEffect(() => {\n    if (!trackingOn || !hasLocation) return;\n    runAutoRefresh();\n    const id = setInterval(runAutoRefresh, AUTO_REFRESH_MS);\n    return () => clearInterval(id);\n  }, [trackingOn, hasLocation, runAutoRefresh]);\n\n  const hasServerResults = Boolean(recommendation?.top && recommendation.top.length > 0);\n  const empty = !loading && !error && !hasServerResults;\n  const waitingForGps = trackingOn && !hasLocation;\n  const rawAccuracy = currentLoc?.accuracy_m ?? lastFix?.accuracy ?? null;\n  const gpsAccuracy = typeof rawAccuracy === \"number\" ? rawAccuracy : null;\n  const computedAgo = recommendation?.computed_at\n    ? formatDistanceToNow(new Date(recommendation.computed_at), { addSuffix: true })\n    : null;\n  const context = recommendation?.context as { traffic_speed_idx?: number; reason?: string } | undefined;\n  const avgTrafficIdx =\n    typeof context?.traffic_speed_idx === \"number\" ? context.traffic_speed_idx : null;\n  const trafficSource = recommendation?.traffic_source ?? null;\n  const contextReason = typeof context?.reason === \"string\" ? context.reason : undefined;\n\n  const emptyStateContent = (() => {\n    if (waitingForGps || isFetchingLocation) {\n      return (\n        <div>\n          <p className=\"font-medium\">Waiting for GPS fix...</p>\n          <p className=\"mt-1 text-xs\">\n            Move outdoors for a clear sky view. Accuracy must be &lt;150m before we can plan zones.\n          </p>\n          {typeof gpsAccuracy === \"number\" && (\n            <p className=\"mt-1 text-xs text-amber-600\">Current accuracy: {gpsAccuracy.toFixed(0)}m</p>\n          )}\n          {!allowLowAccuracy && Boolean(onAllowLowAccuracy) && (\n            <Button size=\"sm\" variant=\"secondary\" className=\"mt-3\" onClick={onAllowLowAccuracy}>\n              Use low-accuracy fix\n            </Button>\n          )}\n        </div>\n      );\n    }\n    if (contextReason === \"no_zones_in_db\") {\n      return (\n        <div>\n          <p className=\"font-medium\">No zones configured</p>\n          <p className=\"mt-1 text-xs\">\n            Ask operations to seed the zones table. Recommendations need at least one zone.\n          </p>\n        </div>\n      );\n    }\n    if (contextReason === \"no_zones_with_coords\") {\n      return (\n        <div>\n          <p className=\"font-medium\">Zones missing coordinates</p>\n          <p className=\"mt-1 text-xs\">\n            None of the zones have lat/lon or center coordinates. Update them in Supabase.\n          </p>\n        </div>\n      );\n    }\n    return \"We'll start suggesting zones once we see your location.\";\n  })();\n  const headerMeta = useMemo(() => {\n    const parts = [\n      computedAgo ? `Refreshed ${computedAgo}` : \"Refreshed just now\",\n      describeTrafficSource(trafficSource),\n      avgTrafficIdx !== null ? `Avg traffic ${describeTrafficLevel(avgTrafficIdx)}` : null,\n    ];\n    return parts.filter(Boolean).join(\" | \");\n  }, [computedAgo, trafficSource, avgTrafficIdx]);\n\n  return (\n    <Card className=\"shadow-sm\">\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0\">\n        <div>\n          <CardTitle className=\"text-base font-semibold\">Next best zones</CardTitle>\n          <p className=\"text-xs text-muted-foreground\">{headerMeta}</p>\n        </div>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          aria-label=\"Refresh\"\n          onClick={() => fetchLatest(\"manual_button\")}\n          disabled={!hasLocation || isFetchingLocation}\n        >\n          <RefreshCw className=\"h-4 w-4\" />\n        </Button>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {loading && (\n          <div className=\"space-y-3\">\n            {[0, 1, 2].map((idx) => (\n              <div key={idx} className=\"rounded-xl border p-3\">\n                <div className=\"h-4 w-1/2 animate-pulse rounded bg-muted\" />\n                <div className=\"mt-2 h-3 w-1/3 animate-pulse rounded bg-muted\" />\n              </div>\n            ))}\n          </div>\n        )}\n\n        {!loading && error && (\n          <div className=\"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-700\">\n            {error}\n            <Button\n              size=\"sm\"\n              variant=\"secondary\"\n              className=\"mt-3\"\n              onClick={() => fetchLatest(\"retry\")}\n              disabled={isFetchingLocation || !hasLocation}\n            >\n              Try again\n            </Button>\n          </div>\n        )}\n\n        {empty && (\n          <div className=\"rounded-xl border border-dashed p-4 text-sm text-muted-foreground\">\n            {emptyStateContent}\n          </div>\n        )}\n\n        {!loading && !error && recommendation?.top?.length ? (\n          <div className=\"space-y-3\">\n            {recommendation.top.map((zone) => (\n              <ZoneCard key={zone.zone_id} zone={zone} />\n            ))}\n          </div>\n        ) : null}\n      </CardContent>\n    </Card>\n  );\n}\n\ntype DerivedLocation = {\n  coords: { lat: number; lon: number };\n  source: \"live_fix\" | \"driver_state_coords\" | \"driver_state_loc\";\n};\n\nfunction selectBestLocation(currentLoc: CurrentLocation | null, driverState: DriverState | null): DerivedLocation | null {\n  if (currentLoc) {\n    return { coords: { lat: currentLoc.lat, lon: currentLoc.lon }, source: \"live_fix\" };\n  }\n  if (!driverState) return null;\n\n  if (typeof driverState.lat === \"number\" && typeof driverState.lon === \"number\") {\n    return { coords: { lat: driverState.lat, lon: driverState.lon }, source: \"driver_state_coords\" };\n  }\n\n  const coordsField = (driverState as DriverState & { coords?: { lat?: number; lon?: number } | null })?.coords;\n  if (coordsField && typeof coordsField.lat === \"number\" && typeof coordsField.lon === \"number\") {\n    return { coords: { lat: coordsField.lat, lon: coordsField.lon }, source: \"driver_state_coords\" };\n  }\n\n  const locPoint = driverState.loc as { coordinates?: [number, number] } | null;\n  if (locPoint && Array.isArray(locPoint.coordinates) && locPoint.coordinates.length === 2) {\n    const [lon, lat] = locPoint.coordinates;\n    if (typeof lat === \"number\" && typeof lon === \"number\") {\n      return { coords: { lat, lon }, source: \"driver_state_loc\" };\n    }\n  }\n\n  return null;\n}\n\nfunction ZoneCard({ zone }: { zone: RecommendationResponse[\"top\"][number] }) {\n  const hasScore = typeof zone.score === \"number\";\n  const hasEta = typeof zone.eta_min === \"number\";\n  const hasDistance = typeof zone.distance_km === \"number\";\n  const distanceLabel = hasDistance ? `${zone.distance_km!.toFixed(1)} km` : \"Distance n/a\";\n  const etaLabel = hasEta ? `${zone.eta_min} min` : \"ETA n/a\";\n  const scoreLabel = hasScore ? zone.score!.toFixed(2) : \"Score n/a\";\n  const barWidth = hasScore ? `${Math.min(100, Math.round(zone.score! * 100))}%` : \"0%\";\n\n  const handleNavigate = () => {\n    if (typeof zone.lat === \"number\" && typeof zone.lon === \"number\") {\n      window.open(`https://www.google.com/maps/search/?api=1&query=${zone.lat},${zone.lon}`, \"_blank\");\n      return;\n    }\n\n    const fallbackQuery = encodeURIComponent(`${zone.zone_name} Patna`);\n    window.open(`https://www.google.com/maps/search/?api=1&query=${fallbackQuery}`, \"_blank\");\n  };\n\n  const trafficLabel =\n    typeof zone.traffic_speed_idx === \"number\"\n      ? describeTrafficLevel(zone.traffic_speed_idx)\n      : null;\n\n  return (\n    <div className=\"rounded-2xl border p-4\">\n      <div className=\"flex items-start justify-between gap-3\">\n        <div>\n          <div className=\"flex items-center gap-2 text-base font-semibold\">\n            <MapPin className=\"h-4 w-4 text-primary\" />\n            {zone.zone_name}\n          </div>\n          <p className=\"text-xs text-muted-foreground\">\n            {distanceLabel} | {etaLabel} | {scoreLabel}\n          </p>\n          {trafficLabel && (\n            <p className=\"text-xs text-muted-foreground\">Traffic: {trafficLabel}</p>\n          )}\n        </div>\n        <Button size=\"sm\" variant=\"secondary\" onClick={handleNavigate}>\n          Navigate\n          <ArrowUpRight className=\"ml-1 h-3 w-3\" />\n        </Button>\n      </div>\n      <div className=\"mt-3 text-sm text-muted-foreground\">{zone.reason}</div>\n      <div className=\"mt-3 h-1.5 rounded-full bg-muted\">\n        <div className=\"h-full rounded-full bg-emerald-500\" style={{ width: barWidth }} />\n      </div>\n    </div>\n  );\n}\n\nfunction describeTrafficSource(source?: string | null) {\n  if (source === \"google\") return \"Google live traffic\";\n  if (source === \"cache\") return \"Cached traffic snapshot\";\n  if (source === \"fallback\") return \"Estimated traffic\";\n  return null;\n}\n\nfunction describeTrafficLevel(idx: number) {\n  if (idx >= 0.85) return \"Smooth\";\n  if (idx >= 0.65) return \"Moderate\";\n  if (idx >= 0.4) return \"Busy\";\n  return \"Heavy\";\n}\n\nfunction distanceBetweenMeters(lat1: number, lon1: number, lat2: number, lon2: number) {\n  const R = 6371e3;\n  const phi1 = (lat1 * Math.PI) / 180;\n  const phi2 = (lat2 * Math.PI) / 180;\n  const deltaPhi = ((lat2 - lat1) * Math.PI) / 180;\n  const deltaLambda = ((lon2 - lon1) * Math.PI) / 180;\n\n  const a =\n    Math.sin(deltaPhi / 2) * Math.sin(deltaPhi / 2) +\n    Math.cos(phi1) * Math.cos(phi2) *\n      Math.sin(deltaLambda / 2) * Math.sin(deltaLambda / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1515, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/RideControls.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, useState } from \"react\";\nimport { Button, type ButtonProps } from \"@/components/ui/button\";\nimport { postRideEvent } from \"@/lib/api-client\";\nimport { useTrackingStore, type TrackingFix } from \"@/lib/tracking/store\";\nimport { toast } from \"sonner\";\nimport { XCircle } from \"lucide-react\";\n\ntype RideEventAction =\n  | \"booking_received\"\n  | \"ride_started\"\n  | \"ride_completed\"\n  | \"booking_cancelled\";\n\nconst events: Array<{ type: RideEventAction; label: string; variant: ButtonProps[\"variant\"] }> = [\n  { type: \"booking_received\", label: \"Got a Ride\", variant: \"default\" },\n  { type: \"ride_started\", label: \"Start Ride\", variant: \"default\" },\n  { type: \"ride_completed\", label: \"Complete Ride\", variant: \"destructive\" }, // Changed to destructive/prominent for completion\n  { type: \"booking_cancelled\", label: \"Cancel Booking\", variant: \"ghost\" },\n] as const;\n\ntype EventConfig = (typeof events)[number];\ntype RideState = \"idle\" | \"booking\" | \"on_trip\";\n\ninterface RideControlsProps {\n  lastFix: TrackingFix | null;\n}\n\nexport function RideControls({ lastFix }: RideControlsProps) {\n  const [platform, setPlatform] = useState<\"ola\" | \"uber\">(\"ola\");\n  const [rideState, setRideState] = useState<RideState>(\"idle\");\n  const [activeEvent, setActiveEvent] = useState<EventConfig | null>(null);\n  const [submitting, setSubmitting] = useState(false);\n  const setIsDriving = useTrackingStore((s) => s.setIsDriving);\n\n  const coordsCopy = useMemo(() => {\n    if (!lastFix) return \"No live GPS\";\n    return `${lastFix.lat.toFixed(4)}, ${lastFix.lon.toFixed(4)}`;\n  }, [lastFix]);\n\n  const handleMainAction = () => {\n    if (rideState === \"idle\") {\n      setActiveEvent(events.find((e) => e.type === \"booking_received\")!);\n    } else if (rideState === \"booking\") {\n      setActiveEvent(events.find((e) => e.type === \"ride_started\")!);\n    } else if (rideState === \"on_trip\") {\n      setActiveEvent(events.find((e) => e.type === \"ride_completed\")!);\n    }\n  };\n\n  const handleCancelAction = () => {\n    setActiveEvent(events.find((e) => e.type === \"booking_cancelled\")!);\n  };\n\n  const confirmEvent = async () => {\n    if (!activeEvent) return;\n    setSubmitting(true);\n    const payload: Parameters<typeof postRideEvent>[0] = {\n      event_type: activeEvent.type,\n      platform,\n    };\n    if (lastFix) {\n      if (activeEvent.type === \"ride_completed\") {\n        payload.drop_lat = lastFix.lat;\n        payload.drop_lon = lastFix.lon;\n      } else {\n        payload.pickup_lat = lastFix.lat;\n        payload.pickup_lon = lastFix.lon;\n      }\n    }\n    const { error } = await postRideEvent(payload);\n    setSubmitting(false);\n    setActiveEvent(null);\n    if (error) {\n      toast.error(error.message);\n    } else {\n      toast.success(`${copyForEvent(activeEvent.type)} logged`);\n      \n      // State transitions\n      if (activeEvent.type === \"booking_received\") {\n        setRideState(\"booking\");\n        setIsDriving(false);\n      } else if (activeEvent.type === \"ride_started\") {\n        setRideState(\"on_trip\");\n        setIsDriving(true);\n      } else if (activeEvent.type === \"ride_completed\") {\n        setRideState(\"idle\");\n        setIsDriving(false);\n      } else if (activeEvent.type === \"booking_cancelled\") {\n        setRideState(\"idle\");\n        setIsDriving(false);\n      }\n    }\n  };\n\n  const getMainButtonLabel = () => {\n    switch (rideState) {\n      case \"idle\": return \"Got a Ride\";\n      case \"booking\": return \"Start Ride\";\n      case \"on_trip\": return \"Complete Ride\";\n    }\n  };\n\n  const getMainButtonVariant = (): ButtonProps[\"variant\"] => {\n    switch (rideState) {\n      case \"idle\": return \"default\"; // Green/Primary\n      case \"booking\": return \"secondary\"; // Distinct from idle\n      case \"on_trip\": return \"destructive\"; // Red/End action? Or maybe outline. Let's use default for now or specific style.\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between rounded-2xl border bg-white/60 px-4 py-3 shadow-sm\">\n        <div>\n          <p className=\"text-xs uppercase text-muted-foreground\">Current platform</p>\n          <div className=\"mt-1 inline-flex gap-2 rounded-full bg-muted p-1\">\n            {[\"ola\", \"uber\"].map((provider) => (\n              <button\n                key={provider}\n                type=\"button\"\n                onClick={() => setPlatform(provider as \"ola\" | \"uber\")}\n                className={`rounded-full px-3 py-1 text-xs font-semibold capitalize transition ${\n                  platform === provider\n                    ? \"bg-white text-foreground shadow\"\n                    : \"text-muted-foreground\"\n                }`}\n              >\n                {provider}\n              </button>\n            ))}\n          </div>\n        </div>\n        {/* <div className=\"text-right text-xs text-muted-foreground\">\n          <p>Last fix</p>\n          <p className=\"font-semibold text-foreground\">{coordsCopy}</p>\n        </div> */}\n      </div>\n\n      <div className=\"flex flex-col gap-3\">\n        <Button\n          className={`h-14 text-lg font-semibold shadow-sm transition-all ${\n            rideState === \"on_trip\" ? \"bg-red-600 hover:bg-red-700 text-white\" : \n            rideState === \"booking\" ? \"bg-emerald-600 hover:bg-emerald-700 text-white\" : \"\"\n          }`}\n          variant={rideState === \"idle\" ? \"default\" : \"secondary\"}\n          onClick={handleMainAction}\n        >\n          {getMainButtonLabel()}\n        </Button>\n\n        {rideState === \"booking\" && (\n          <Button\n            variant=\"ghost\"\n            className=\"text-muted-foreground hover:text-red-600 hover:bg-red-50\"\n            onClick={handleCancelAction}\n          >\n            <XCircle className=\"mr-2 h-4 w-4\" />\n            Cancel Booking\n          </Button>\n        )}\n      </div>\n\n      {/* <p className=\"text-xs text-muted-foreground\">\n        Your live location is only used to suggest better zones and calculate your performance. It stays private to you.\n      </p> */}\n\n      {activeEvent && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 pb-8 animate-in fade-in duration-200\">\n          <div className=\"w-full max-w-md rounded-3xl bg-whitesmoke p-6 shadow-2xl\"\n          style={{\n            background:'whitesmoke'\n          }}\n          >\n            <p className=\"text-sm font-semibold text-muted-foreground\">Confirm action</p>\n            <h3 className=\"text-2xl font-semibold mt-1\">{activeEvent.label}</h3>\n            \n            <div className=\"mt-4 space-y-2 rounded-xl bg-muted/50 p-4\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Platform</span>\n                <span className=\"font-medium capitalize\">{platform}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Location</span>\n                <span className=\"font-medium font-mono\">{coordsCopy}</span>\n              </div>\n            </div>\n\n            <div className=\"mt-6 flex gap-3\">\n              <Button variant=\"outline\" className=\"flex-1 h-12\" onClick={() => setActiveEvent(null)}>\n                Back\n              </Button>\n              <Button \n                className=\"flex-1 h-12\" \n                variant={activeEvent.type === \"booking_cancelled\" ? \"destructive\" : \"default\"}\n                onClick={confirmEvent} \n                disabled={submitting}\n              >\n                {submitting ? \"Saving...\" : \"Confirm\"}\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction copyForEvent(type: EventConfig[\"type\"]) {\n  switch (type) {\n    case \"booking_received\":\n      return \"Booking\";\n    case \"ride_started\":\n      return \"Ride start\";\n    case \"ride_completed\":\n      return \"Ride completion\";\n    case \"booking_cancelled\":\n      return \"Cancellation\";\n    default:\n      return \"Event\";\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1889, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/offline-queue.ts"],"sourcesContent":["import { openDB, IDBPDatabase } from \"idb\";\r\n\r\nconst DB = \"ride-db\";\r\nconst STORE = \"events\";\r\n\r\nasync function db() { \r\n  return openDB(DB, 1, { \r\n    upgrade(d: IDBPDatabase) { \r\n      d.createObjectStore(STORE, { keyPath: \"id\", autoIncrement: true }); \r\n    } \r\n  }); \r\n}\r\n\r\nexport async function enqueue(e: any) { \r\n  (await db()).add(STORE, { ...e, created_at: Date.now() }); \r\n}\r\n\r\nexport async function drain(flush: (e: any) => Promise<boolean>) {\r\n  const d = await db();\r\n  const tx = d.transaction(STORE, \"readwrite\");\r\n  const s = tx.store;\r\n  let c = await s.openCursor();\r\n  while (c) { \r\n    const ok = await flush(c.value); \r\n    if (ok) await c.delete(); \r\n    c = await c.continue(); \r\n  }\r\n  await tx.done;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,KAAK;AACX,MAAM,QAAQ;AAEd,eAAe;IACb,OAAO,IAAA,kJAAM,EAAC,IAAI,GAAG;QACnB,SAAQ,CAAe;YACrB,EAAE,iBAAiB,CAAC,OAAO;gBAAE,SAAS;gBAAM,eAAe;YAAK;QAClE;IACF;AACF;AAEO,eAAe,QAAQ,CAAM;IAClC,CAAC,MAAM,IAAI,EAAE,GAAG,CAAC,OAAO;QAAE,GAAG,CAAC;QAAE,YAAY,KAAK,GAAG;IAAG;AACzD;AAEO,eAAe,MAAM,KAAmC;IAC7D,MAAM,IAAI,MAAM;IAChB,MAAM,KAAK,EAAE,WAAW,CAAC,OAAO;IAChC,MAAM,IAAI,GAAG,KAAK;IAClB,IAAI,IAAI,MAAM,EAAE,UAAU;IAC1B,MAAO,EAAG;QACR,MAAM,KAAK,MAAM,MAAM,EAAE,KAAK;QAC9B,IAAI,IAAI,MAAM,EAAE,MAAM;QACtB,IAAI,MAAM,EAAE,QAAQ;IACtB;IACA,MAAM,GAAG,IAAI;AACf","debugId":null}},
    {"offset": {"line": 1934, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/hooks/useLiveTracking.ts"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { postPing, RecommendationResponse } from \"@/lib/api-client\";\nimport { useTrackingStore, type TrackingFix } from \"@/lib/tracking/store\";\nimport { enqueue } from \"@/lib/offline-queue\";\nimport { toast } from \"sonner\";\n\nconst MIN_DISTANCE_DELTA = 30; // meters\nconst MIN_INTERVAL_MS = 5000;\nconst GOOD_ACCURACY_THRESHOLD = 150;\nconst RELAXED_ACCURACY_THRESHOLD = 300;\nconst MAX_ACCURACY_METERS = 250;\nconst ACCURACY_IMPROVEMENT_FACTOR = 0.5;\n\nexport type CurrentLocation = {\n  lat: number;\n  lon: number;\n  accuracy_m: number | null;\n  ts: number;\n};\n\ntype GeoPermissionDescriptor = { name: \"geolocation\" };\n\ntype UseLiveTrackingOptions = {\n  onFirstFix?: (loc: CurrentLocation) => void;\n};\n\nexport function useLiveTracking(opts?: UseLiveTrackingOptions) {\n  const trackingOn = useTrackingStore((s) => s.trackingOn);\n  const permissionStatus = useTrackingStore((s) => s.permissionStatus);\n  const lastFix = useTrackingStore((s) => s.lastFix);\n  const lastPingAt = useTrackingStore((s) => s.lastPingAt);\n  const lastRecommendation = useTrackingStore((s) => s.lastRecommendation);\n  const error = useTrackingStore((s) => s.error);\n  const autoStartPending = useTrackingStore((s) => s.autoStartPending);\n  const allowLowAccuracy = useTrackingStore((s) => s.allowLowAccuracy);\n  const setTrackingOn = useTrackingStore((s) => s.setTrackingOn);\n  const setPermissionStatus = useTrackingStore((s) => s.setPermissionStatus);\n  const setLastFix = useTrackingStore((s) => s.setLastFix);\n  const setLastPingAt = useTrackingStore((s) => s.setLastPingAt);\n  const setRecommendation = useTrackingStore((s) => s.setRecommendation);\n  const setError = useTrackingStore((s) => s.setError);\n  const setAutoStartPending = useTrackingStore((s) => s.setAutoStartPending);\n  const setAllowLowAccuracy = useTrackingStore((s) => s.setAllowLowAccuracy);\n  const watchId = useRef<number | null>(null);\n  const lastSentTimestamp = useRef<number>(0);\n  const lastBroadcastPosition = useRef<GeolocationPosition | null>(null);\n  const lastGoodFixRef = useRef<TrackingFix | null>(null);\n  const onFirstFix = opts?.onFirstFix;\n\n  const updatePermissionFromNavigator = useCallback(async () => {\n    try {\n      if (navigator.permissions?.query) {\n        const result = await navigator.permissions.query(\n          { name: \"geolocation\" } as PermissionDescriptor & GeoPermissionDescriptor\n        );\n        setPermissionStatus(result.state);\n        result.onchange = () => setPermissionStatus(result.state);\n      } else {\n        setPermissionStatus(\"unsupported\");\n      }\n    } catch (err) {\n      console.warn(\"permission query failed\", err);\n      setPermissionStatus(\"unsupported\");\n    }\n  }, [setPermissionStatus]);\n\n  useEffect(() => {\n    updatePermissionFromNavigator();\n  }, [updatePermissionFromNavigator]);\n\n  const stopWatch = useCallback(() => {\n    if (watchId.current !== null && typeof navigator !== \"undefined\" && navigator.geolocation) {\n      navigator.geolocation.clearWatch(watchId.current);\n      watchId.current = null;\n    }\n  }, []);\n\n  const handlePingSuccess = useCallback(\n    (recommendation: RecommendationResponse | null, timestampIso: string) => {\n      setLastPingAt(timestampIso);\n      if (recommendation) {\n        setRecommendation(recommendation);\n      }\n      setError(null);\n    },\n    [setLastPingAt, setRecommendation, setError]\n  );\n\n  const sendPing = useCallback(\n    async (position: GeolocationPosition) => {\n      const accuracy =\n        typeof position.coords.accuracy === \"number\" && Number.isFinite(position.coords.accuracy)\n          ? position.coords.accuracy\n          : null;\n\n      const speedKmh =\n        typeof position.coords.speed === \"number\" && Number.isFinite(position.coords.speed)\n          ? position.coords.speed * 3.6\n          : null;\n\n      const fix: TrackingFix = {\n        lat: position.coords.latitude,\n        lon: position.coords.longitude,\n        accuracy,\n        speed: speedKmh,\n        timestamp: position.timestamp,\n      };\n\n      setLastFix(fix);\n\n      const accuracyAcceptable =\n        accuracy !== null && accuracy <= MAX_ACCURACY_METERS;\n\n      if (!accuracyAcceptable) {\n        setError(\"GPS accuracy is weak (>250m). Move outdoors for a clear fix.\");\n        return;\n      }\n\n      setError(null);\n\n      const now = Date.now();\n      const last = lastBroadcastPosition.current;\n      let accuracyImproved = false;\n      if (\n        last &&\n        typeof last.coords.accuracy === \"number\" &&\n        Number.isFinite(last.coords.accuracy)\n      ) {\n        accuracyImproved =\n          typeof accuracy === \"number\" &&\n          accuracy <= last.coords.accuracy * ACCURACY_IMPROVEMENT_FACTOR;\n      }\n\n      if (\n        last &&\n        distanceMeters(last.coords, position.coords) < MIN_DISTANCE_DELTA &&\n        now - lastSentTimestamp.current < MIN_INTERVAL_MS &&\n        !accuracyImproved\n      ) {\n        return;\n      }\n\n      lastBroadcastPosition.current = position;\n      lastSentTimestamp.current = now;\n\n      const payload = {\n        lat: position.coords.latitude,\n        lon: position.coords.longitude,\n        ts: new Date(position.timestamp).toISOString(),\n        accuracy_m: accuracy,\n        speed_kmh: speedKmh ?? undefined,\n      };\n\n      const { data, error } = await postPing(payload);\n      if (error) {\n        setError(error.message);\n        await enqueue(payload);\n        toast.error(\"Could not sync live location. We'll retry soon.\");\n        return;\n      }\n\n      handlePingSuccess(data?.recommendation ?? null, payload.ts ?? new Date().toISOString());\n    },\n    [setLastFix, handlePingSuccess, setError]\n  );\n\n  const requestPermission = useCallback(async () => {\n    try {\n      const { state } = await navigator.permissions.query(\n        { name: \"geolocation\" } as PermissionDescriptor & GeoPermissionDescriptor\n      );\n      setPermissionStatus(state);\n      if (state === \"denied\") {\n        toast.error(\"Location permission denied. Enable it in browser settings.\");\n        return false;\n      }\n      if (state === \"prompt\") {\n        await new Promise<GeolocationPosition>((resolve, reject) => {\n          navigator.geolocation.getCurrentPosition(resolve, reject, {\n            enableHighAccuracy: true,\n            timeout: 15000,\n            maximumAge: 0,\n          });\n        });\n        setPermissionStatus(\"granted\");\n      }\n      return true;\n    } catch (error) {\n      console.error(\"permission request failed\", error);\n      setPermissionStatus(\"unsupported\");\n      return false;\n    }\n  }, [setPermissionStatus]);\n\n  const stopTracking = useCallback(() => {\n    stopWatch();\n    setTrackingOn(false);\n  }, [stopWatch, setTrackingOn]);\n\n  const startTracking = useCallback(async () => {\n    if (trackingOn) return true;\n    const granted = await requestPermission();\n    if (!granted) {\n      setError(\"Location permission required for live tracking\");\n      return false;\n    }\n    setTrackingOn(true);\n    return true;\n  }, [trackingOn, requestPermission, setTrackingOn, setError]);\n\n  const toggleTracking = useCallback(async () => {\n    if (trackingOn) {\n      stopTracking();\n      return;\n    }\n    await startTracking();\n  }, [trackingOn, startTracking, stopTracking]);\n\n  useEffect(() => {\n    if (!trackingOn && autoStartPending) {\n      void startTracking();\n      setAutoStartPending(false);\n    }\n  }, [trackingOn, autoStartPending, startTracking, setAutoStartPending]);\n\n  useEffect(() => {\n    if (!trackingOn) {\n      stopWatch();\n      return;\n    }\n\n    if (typeof navigator === \"undefined\" || !navigator.geolocation) {\n      setError(\"Geolocation is not supported in this browser.\");\n      toast.error(\"Geolocation is not available on this device.\");\n      setTrackingOn(false);\n      return;\n    }\n\n    watchId.current = navigator.geolocation.watchPosition(\n      (pos) => sendPing(pos),\n      (err) => {\n        console.error(\"watchPosition error\", err);\n        const friendly = describeGeoError(err);\n        setError(friendly);\n        if (err.code === err.PERMISSION_DENIED) {\n          setTrackingOn(false);\n          setPermissionStatus(\"denied\");\n          toast.error(\"Permission denied. Please re-enable location access.\");\n        } else {\n          toast.error(friendly);\n        }\n      },\n      {\n        enableHighAccuracy: true,\n        maximumAge: 0,\n        timeout: 15000,\n      }\n    );\n\n    return () => stopWatch();\n  }, [trackingOn, sendPing, stopWatch, setError, setTrackingOn, setPermissionStatus]);\n\n  useEffect(() => {\n    function handleOnline() {\n      setError(null);\n    }\n    window.addEventListener(\"online\", handleOnline);\n    return () => window.removeEventListener(\"online\", handleOnline);\n  }, [setError]);\n\n  const accuracyThreshold = allowLowAccuracy\n    ? RELAXED_ACCURACY_THRESHOLD\n    : GOOD_ACCURACY_THRESHOLD;\n\n  if (!trackingOn) {\n    lastGoodFixRef.current = null;\n  } else {\n    const fixAccuracy =\n      lastFix && typeof lastFix.accuracy === \"number\" && Number.isFinite(lastFix.accuracy)\n        ? lastFix.accuracy\n        : null;\n    if (lastFix && fixAccuracy !== null && fixAccuracy <= accuracyThreshold) {\n      lastGoodFixRef.current = lastFix;\n    } else if (\n      lastGoodFixRef.current &&\n      typeof lastGoodFixRef.current.accuracy === \"number\" &&\n      lastGoodFixRef.current.accuracy > accuracyThreshold\n    ) {\n      lastGoodFixRef.current = null;\n    }\n  }\n\n  const currentLocSource = lastGoodFixRef.current ?? lastFix;\n  const currentLoc: CurrentLocation | null = currentLocSource\n    ? {\n        lat: currentLocSource.lat,\n        lon: currentLocSource.lon,\n        accuracy_m:\n          typeof currentLocSource.accuracy === \"number\" &&\n          Number.isFinite(currentLocSource.accuracy)\n            ? currentLocSource.accuracy\n            : null,\n        ts: currentLocSource.timestamp,\n      }\n    : null;\n\n  const hasLocation = Boolean(lastGoodFixRef.current);\n  const lastGoodFixAt = lastGoodFixRef.current?.timestamp ?? null;\n  const isFetchingLocation = trackingOn && !hasLocation;\n\n  const prevHasLocationRef = useRef(false);\n\n  useEffect(() => {\n    const prev = prevHasLocationRef.current;\n    if (!prev && hasLocation && currentLoc) {\n      onFirstFix?.(currentLoc);\n      try {\n        window.dispatchEvent(new CustomEvent(\"liveTracking:firstFix\", { detail: currentLoc }));\n      } catch {\n        // no-op if CustomEvent unavailable\n      }\n    }\n    prevHasLocationRef.current = hasLocation;\n  }, [hasLocation, currentLoc, onFirstFix]);\n\n  return {\n    trackingOn,\n    permissionStatus,\n    lastFix,\n    lastPingAt,\n    lastRecommendation,\n    error,\n    currentLoc,\n    lastGoodFixAt,\n    toggleTracking,\n    startTracking,\n    stopTracking,\n    hasLocation,\n    isFetchingLocation,\n    allowLowAccuracy,\n    setAllowLowAccuracy,\n  };\n}\n\nfunction distanceMeters(a: GeolocationCoordinates, b: GeolocationCoordinates) {\n  const R = 6371e3;\n  const lat1 = (a.latitude * Math.PI) / 180;\n  const lat2 = (b.latitude * Math.PI) / 180;\n  const deltaLat = lat2 - lat1;\n  const deltaLon = ((b.longitude - a.longitude) * Math.PI) / 180;\n  const x =\n    Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n    Math.cos(lat1) * Math.cos(lat2) * Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(x), Math.sqrt(1 - x));\n  return R * c;\n}\n\nfunction describeGeoError(err: GeolocationPositionError) {\n  switch (err.code) {\n    case err.PERMISSION_DENIED:\n      return \"Location permission denied. Enable it in your browser settings.\";\n    case err.POSITION_UNAVAILABLE:\n      return \"GPS signal unavailable. Move outdoors for a clear view of the sky.\";\n    case err.TIMEOUT:\n      return \"Timed out while waiting for GPS. Try again from an open area.\";\n    default:\n      return err.message || \"Unable to determine your location.\";\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2362, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/supabase/config.ts"],"sourcesContent":["const isServer = () => typeof window === \"undefined\";\n\n/**\n * Next.js only inlines environment variables when they are referenced with static keys.\n * Avoid dynamic lookups (e.g. process.env[key]) because they are stripped from the client bundle\n * and will always be undefined in the browser.\n */\nexport function getSupabaseConfig() {\n  const serverUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const serverAnonKey =\n    process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  const url = isServer() ? serverUrl : process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const anonKey = isServer() ? serverAnonKey : process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  if (!url) {\n    throw new Error(\"Missing SUPABASE_URL/NEXT_PUBLIC_SUPABASE_URL environment variable\");\n  }\n  if (!anonKey) {\n    throw new Error(\"Missing SUPABASE_ANON_KEY/NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable\");\n  }\n\n  return { url, anonKey };\n}\n"],"names":[],"mappings":";;;;AAQoB;AARpB,MAAM,WAAW,IAAM,+CAAkB;AAOlC,SAAS;IACd,MAAM,YAAY,2KAAO,CAAC,GAAG,CAAC,YAAY;IAC1C,MAAM,gBACJ,2KAAO,CAAC,GAAG,CAAC,iBAAiB;IAE/B,MAAM,MAAM,aAAa;IACzB,MAAM,UAAU,aAAa;IAE7B;;IAGA;;IAIA,OAAO;QAAE;QAAK;IAAQ;AACxB","debugId":null}},
    {"offset": {"line": 2389, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/supabase/client.ts"],"sourcesContent":["\"use client\";\n\nimport { createBrowserClient } from \"@supabase/ssr\";\nimport type { SupabaseClient } from \"@supabase/supabase-js\";\nimport { getSupabaseConfig } from \"./config\";\n\nlet browserClient: SupabaseClient | null = null;\n\nexport function createBrowserSupabaseClient() {\n  if (typeof window === \"undefined\") {\n    // Return a placeholder during SSR - actual client will be created on hydration\n    return null as any;\n  }\n\n  if (browserClient) {\n    return browserClient;\n  }\n\n  const { url, anonKey } = getSupabaseConfig();\n  browserClient = createBrowserClient(url, anonKey, {\n    auth: {\n      persistSession: true,\n      detectSessionInUrl: true,\n      autoRefreshToken: true,\n    },\n  });\n\n  return browserClient;\n}\n\nexport function getBrowserSupabaseClient() {\n  return createBrowserSupabaseClient();\n}\n"],"names":[],"mappings":";;;;;;AAEA;AAAA;AAEA;AAJA;;;AAMA,IAAI,gBAAuC;AAEpC,SAAS;IACd;;IAKA,IAAI,eAAe;QACjB,OAAO;IACT;IAEA,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,IAAA,iJAAiB;IAC1C,gBAAgB,IAAA,oMAAmB,EAAC,KAAK,SAAS;QAChD,MAAM;YACJ,gBAAgB;YAChB,oBAAoB;YACpB,kBAAkB;QACpB;IACF;IAEA,OAAO;AACT;AAEO,SAAS;IACd,OAAO;AACT","debugId":null}},
    {"offset": {"line": 2428, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/hooks/useDriverProfile.ts"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { createBrowserSupabaseClient } from \"@/lib/supabase/client\";\n\nconst supabase = createBrowserSupabaseClient();\n\nexport function useDriverProfile() {\n  const [profile, setProfile] = useState<{ id: string; full_name: string | null } | null>(null);\n\n  useEffect(() => {\n    let active = true;\n    async function load() {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser();\n      if (!user) return;\n      const { data } = await supabase\n        .from(\"profiles\")\n        .select(\"id,full_name\")\n        .eq(\"id\", user.id)\n        .maybeSingle();\n      if (!active) return;\n      setProfile({ id: user.id, full_name: data?.full_name ?? user.user_metadata?.full_name ?? null });\n    }\n    load();\n    return () => {\n      active = false;\n    };\n  }, []);\n\n  return profile;\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAKA,MAAM,WAAW,IAAA,2JAA2B;AAErC,SAAS;;IACd,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAkD;IAExF,IAAA,0KAAS;sCAAC;YACR,IAAI,SAAS;YACb,eAAe;gBACb,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;gBAC/B,IAAI,CAAC,MAAM;gBACX,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SACpB,IAAI,CAAC,YACL,MAAM,CAAC,gBACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,WAAW;gBACd,IAAI,CAAC,QAAQ;gBACb,WAAW;oBAAE,IAAI,KAAK,EAAE;oBAAE,WAAW,MAAM,aAAa,KAAK,aAAa,EAAE,aAAa;gBAAK;YAChG;YACA;YACA;8CAAO;oBACL,SAAS;gBACX;;QACF;qCAAG,EAAE;IAEL,OAAO;AACT;GAzBgB","debugId":null}},
    {"offset": {"line": 2473, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/hooks/useTodayStats.ts"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useState } from \"react\";\nimport { startOfDay } from \"date-fns\";\nimport { createBrowserSupabaseClient } from \"@/lib/supabase/client\";\n\nconst supabase = createBrowserSupabaseClient();\n\ntype TripRow = {\n  pickup_at: string | null;\n  drop_at: string | null;\n  fare_inr: number | null;\n  tip_inr: number | null;\n};\n\nexport interface TodayStats {\n  totalTrips: number;\n  totalEarnings: number;\n  totalHours: number;\n  idleMinutes: number;\n}\n\nexport function useTodayStats() {\n  const [stats, setStats] = useState<TodayStats>({\n    totalTrips: 0,\n    totalEarnings: 0,\n    totalHours: 0,\n    idleMinutes: 0,\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const load = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    const start = startOfDay(new Date());\n    const end = new Date();\n    const { data: trips, error: tripsError } = await supabase\n      .from(\"trips\")\n      .select(\"pickup_at,drop_at,fare_inr,tip_inr\")\n      .gte(\"pickup_at\", start.toISOString())\n      .lte(\"pickup_at\", end.toISOString());\n    if (tripsError) {\n      setError(tripsError.message);\n    }\n\n    let totalTrips = trips?.length ?? 0;\n    let totalEarnings = 0;\n    let totalHours = 0;\n    trips?.forEach((trip: TripRow) => {\n      totalEarnings += (trip.fare_inr ?? 0) + (trip.tip_inr ?? 0);\n      const pickup = trip.pickup_at ? Date.parse(trip.pickup_at) : 0;\n      const drop = trip.drop_at ? Date.parse(trip.drop_at) : pickup;\n      totalHours += Math.max(0, drop - pickup) / (1000 * 60 * 60);\n    });\n\n    const { data: opsRow } = await supabase\n      .from(\"ops_daily\")\n      .select(\"idle_minutes\")\n      .eq(\"day\", start.toISOString().slice(0, 10))\n      .maybeSingle();\n\n    setStats({\n      totalTrips,\n      totalEarnings,\n      totalHours,\n      idleMinutes: opsRow?.idle_minutes ?? 0,\n    });\n    setLoading(false);\n  }, []);\n\n  useEffect(() => {\n    load();\n  }, [load]);\n\n  return { stats, loading, error, refresh: load };\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAMA,MAAM,WAAW,IAAA,2JAA2B;AAgBrC,SAAS;;IACd,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAa;QAC7C,YAAY;QACZ,eAAe;QACf,YAAY;QACZ,aAAa;IACf;IACA,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAgB;IAElD,MAAM,OAAO,IAAA,4KAAW;2CAAC;YACvB,WAAW;YACX,SAAS;YACT,MAAM,QAAQ,IAAA,0JAAU,EAAC,IAAI;YAC7B,MAAM,MAAM,IAAI;YAChB,MAAM,EAAE,MAAM,KAAK,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SAC9C,IAAI,CAAC,SACL,MAAM,CAAC,sCACP,GAAG,CAAC,aAAa,MAAM,WAAW,IAClC,GAAG,CAAC,aAAa,IAAI,WAAW;YACnC,IAAI,YAAY;gBACd,SAAS,WAAW,OAAO;YAC7B;YAEA,IAAI,aAAa,OAAO,UAAU;YAClC,IAAI,gBAAgB;YACpB,IAAI,aAAa;YACjB,OAAO;mDAAQ,CAAC;oBACd,iBAAiB,CAAC,KAAK,QAAQ,IAAI,CAAC,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC;oBAC1D,MAAM,SAAS,KAAK,SAAS,GAAG,KAAK,KAAK,CAAC,KAAK,SAAS,IAAI;oBAC7D,MAAM,OAAO,KAAK,OAAO,GAAG,KAAK,KAAK,CAAC,KAAK,OAAO,IAAI;oBACvD,cAAc,KAAK,GAAG,CAAC,GAAG,OAAO,UAAU,CAAC,OAAO,KAAK,EAAE;gBAC5D;;YAEA,MAAM,EAAE,MAAM,MAAM,EAAE,GAAG,MAAM,SAC5B,IAAI,CAAC,aACL,MAAM,CAAC,gBACP,EAAE,CAAC,OAAO,MAAM,WAAW,GAAG,KAAK,CAAC,GAAG,KACvC,WAAW;YAEd,SAAS;gBACP;gBACA;gBACA;gBACA,aAAa,QAAQ,gBAAgB;YACvC;YACA,WAAW;QACb;0CAAG,EAAE;IAEL,IAAA,0KAAS;mCAAC;YACR;QACF;kCAAG;QAAC;KAAK;IAET,OAAO;QAAE;QAAO;QAAS;QAAO,SAAS;IAAK;AAChD;GAtDgB","debugId":null}},
    {"offset": {"line": 2549, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/app/%28driver%29/DriverHomeClient.tsx"],"sourcesContent":["\"use client\";\n\nimport { DriverShell } from \"@/components/layout/DriverShell\";\nimport { TrackingToggle } from \"@/components/TrackingToggle\";\nimport { LiveStatusChip } from \"@/components/LiveStatusChip\";\nimport { NextZonesPanel } from \"@/components/NextZonesPanel\";\nimport { TrafficPreviewMap } from \"@/components/TrafficPreviewMap\";\nimport { RideControls } from \"@/components/RideControls\";\nimport { GpsAccuracyBadge } from \"@/components/GpsAccuracyBadge\";\nimport { useLiveTracking } from \"@/hooks/useLiveTracking\";\nimport { useDriverProfile } from \"@/lib/hooks/useDriverProfile\";\nimport { useTodayStats } from \"@/lib/hooks/useTodayStats\";\n\nexport default function DriverHomeClient() {\n  const tracking = useLiveTracking();\n  const profile = useDriverProfile();\n  const { stats } = useTodayStats();\n\n  const greeting = profile?.full_name ? `Hi, ${profile.full_name.split(\" \")[0]}` : \"Hi driver\";\n  const subtitle = `Today | ${stats.totalTrips} trips | ?${stats.totalEarnings.toFixed(0)}`;\n\n  const gpsReady = tracking.hasLocation;\n  const waitingForGps = tracking.isFetchingLocation;\n\n  return (\n    <DriverShell title={greeting} subtitle={subtitle}>\n      <div className=\"space-y-6\">\n        <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n          {/* <TrackingToggle\n            trackingOn={tracking.trackingOn}\n            permissionStatus={tracking.permissionStatus}\n            toggleTracking={tracking.toggleTracking}\n            error={tracking.error}\n          /> */}\n          <div className=\"flex flex-col items-start gap-2 sm:items-end\">\n            <LiveStatusChip\n              trackingOn={tracking.trackingOn}\n              lastPingAt={tracking.lastPingAt}\n              permissionStatus={tracking.permissionStatus}\n            />\n            {/* <GpsAccuracyBadge\n              trackingOn={tracking.trackingOn}\n              accuracy={tracking.lastFix?.accuracy ?? null}\n            /> */}\n            {waitingForGps && (\n              <div className=\"text-xs text-amber-600\">\n                Acquiring GPS fix...\n              </div>\n            )}\n          </div>\n        </div>\n\n        <NextZonesPanel\n          trackingOn={tracking.trackingOn}\n          hasLocation={tracking.hasLocation}\n          isFetchingLocation={tracking.isFetchingLocation}\n          currentLoc={tracking.currentLoc}\n          seedRecommendation={tracking.lastRecommendation}\n          allowLowAccuracy={tracking.allowLowAccuracy}\n          onAllowLowAccuracy={() => tracking.setAllowLowAccuracy(true)}\n        />\n\n        {/* <TrafficPreviewMap\n          currentLocation={tracking.lastFix}\n          recommendedZones={tracking.lastRecommendation?.top ?? null}\n        /> */}\n\n        <section className=\"space-y-3\">\n          {/* <h2 className=\"text-lg font-semibold\">Ride actions</h2> */}\n          <RideControls lastFix={tracking.lastFix} />\n        </section>\n      </div>\n    </DriverShell>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;;;AAXA;;;;;;;;AAae,SAAS;;IACtB,MAAM,WAAW,IAAA,8IAAe;IAChC,MAAM,UAAU,IAAA,uJAAgB;IAChC,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,iJAAa;IAE/B,MAAM,WAAW,SAAS,YAAY,CAAC,IAAI,EAAE,QAAQ,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,GAAG;IACjF,MAAM,WAAW,CAAC,QAAQ,EAAE,MAAM,UAAU,CAAC,UAAU,EAAE,MAAM,aAAa,CAAC,OAAO,CAAC,IAAI;IAEzF,MAAM,WAAW,SAAS,WAAW;IACrC,MAAM,gBAAgB,SAAS,kBAAkB;IAEjD,qBACE,6LAAC,sJAAW;QAAC,OAAO;QAAU,UAAU;kBACtC,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;8BAOb,cAAA,6LAAC;wBAAI,WAAU;;0CACb,6LAAC,kJAAc;gCACb,YAAY,SAAS,UAAU;gCAC/B,YAAY,SAAS,UAAU;gCAC/B,kBAAkB,SAAS,gBAAgB;;;;;;4BAM5C,+BACC,6LAAC;gCAAI,WAAU;0CAAyB;;;;;;;;;;;;;;;;;8BAO9C,6LAAC,kJAAc;oBACb,YAAY,SAAS,UAAU;oBAC/B,aAAa,SAAS,WAAW;oBACjC,oBAAoB,SAAS,kBAAkB;oBAC/C,YAAY,SAAS,UAAU;oBAC/B,oBAAoB,SAAS,kBAAkB;oBAC/C,kBAAkB,SAAS,gBAAgB;oBAC3C,oBAAoB,IAAM,SAAS,mBAAmB,CAAC;;;;;;8BAQzD,6LAAC;oBAAQ,WAAU;8BAEjB,cAAA,6LAAC,8IAAY;wBAAC,SAAS,SAAS,OAAO;;;;;;;;;;;;;;;;;;;;;;AAKjD;GA7DwB;;QACL,8IAAe;QAChB,uJAAgB;QACd,iJAAa;;;KAHT","debugId":null}}]
}