{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/supabase-browser.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n  { auth: { persistSession: true, autoRefreshToken: true } }\r\n);\r\n"],"names":[],"mappings":";;;;AAGE;AAHF;;AAEO,MAAM,WAAW,IAAA,0MAAY,sUAGlC;IAAE,MAAM;QAAE,gBAAgB;QAAM,kBAAkB;IAAK;AAAE","debugId":null}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/lib/offline-queue.ts"],"sourcesContent":["import { openDB, IDBPDatabase } from \"idb\";\r\n\r\nconst DB = \"ride-db\";\r\nconst STORE = \"events\";\r\n\r\nasync function db() { \r\n  return openDB(DB, 1, { \r\n    upgrade(d: IDBPDatabase) { \r\n      d.createObjectStore(STORE, { keyPath: \"id\", autoIncrement: true }); \r\n    } \r\n  }); \r\n}\r\n\r\nexport async function enqueue(e: any) { \r\n  (await db()).add(STORE, { ...e, created_at: Date.now() }); \r\n}\r\n\r\nexport async function drain(flush: (e: any) => Promise<boolean>) {\r\n  const d = await db();\r\n  const tx = d.transaction(STORE, \"readwrite\");\r\n  const s = tx.store;\r\n  let c = await s.openCursor();\r\n  while (c) { \r\n    const ok = await flush(c.value); \r\n    if (ok) await c.delete(); \r\n    c = await c.continue(); \r\n  }\r\n  await tx.done;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,KAAK;AACX,MAAM,QAAQ;AAEd,eAAe;IACb,OAAO,IAAA,kJAAM,EAAC,IAAI,GAAG;QACnB,SAAQ,CAAe;YACrB,EAAE,iBAAiB,CAAC,OAAO;gBAAE,SAAS;gBAAM,eAAe;YAAK;QAClE;IACF;AACF;AAEO,eAAe,QAAQ,CAAM;IAClC,CAAC,MAAM,IAAI,EAAE,GAAG,CAAC,OAAO;QAAE,GAAG,CAAC;QAAE,YAAY,KAAK,GAAG;IAAG;AACzD;AAEO,eAAe,MAAM,KAAmC;IAC7D,MAAM,IAAI,MAAM;IAChB,MAAM,KAAK,EAAE,WAAW,CAAC,OAAO;IAChC,MAAM,IAAI,GAAG,KAAK;IAClB,IAAI,IAAI,MAAM,EAAE,UAAU;IAC1B,MAAO,EAAG;QACR,MAAM,KAAK,MAAM,MAAM,EAAE,KAAK;QAC9B,IAAI,IAAI,MAAM,EAAE,MAAM;QACtB,IAAI,MAAM,EAAE,QAAQ;IACtB;IACA,MAAM,GAAG,IAAI;AACf","debugId":null}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lokes/Desktop/projects/whatsnext/components/RideConfirmBar.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase-browser\";\r\nimport { enqueue, drain } from \"@/lib/offline-queue\";\r\n\r\ntype RideState = \"seeking\" | \"booked\" | \"ontrip\";\r\n\r\nasync function getCoords() {\r\n  return new Promise<GeolocationPosition>((res, rej) => \r\n    navigator.geolocation.getCurrentPosition(res, rej, { \r\n      enableHighAccuracy: true, \r\n      maximumAge: 5000, \r\n      timeout: 10000 \r\n    })\r\n  )\r\n    .then(p => ({ lat: p.coords.latitude, lon: p.coords.longitude }))\r\n    .catch(() => ({ lat: null, lon: null }));\r\n}\r\n\r\nasync function sendEvent(payload: any) {\r\n  const token = (await supabase.auth.getSession()).data.session?.access_token;\r\n  const r = await fetch(\"/functions/v1/ingest_ride_event\", { \r\n    method: \"POST\", \r\n    headers: { \r\n      \"Content-Type\": \"application/json\",\r\n      \"Authorization\": `Bearer ${token}` \r\n    }, \r\n    body: JSON.stringify(payload) \r\n  });\r\n  return r.ok;\r\n}\r\n\r\nexport default function RideConfirmBar() {\r\n  const [state, setState] = useState<RideState>(\"seeking\");\r\n  const [battery, setBattery] = useState<string>(\"\");\r\n  const [status, setStatus] = useState<string>(\"\");\r\n  \r\n  useEffect(() => { \r\n    navigator.serviceWorker?.addEventListener(\"message\", (e: any) => { \r\n      if (e.data?.type === \"SYNC_REQUEST\") { \r\n        drain(sendEvent); \r\n      }\r\n    }); \r\n  }, []);\r\n  \r\n  async function post(type: \"booking_received\" | \"ride_started\" | \"ride_completed\" | \"booking_cancelled\") {\r\n    setStatus(\"Locating…\"); \r\n    const coords = await getCoords();\r\n    const payload = { \r\n      event_type: type, \r\n      occurred_at: new Date().toISOString(), \r\n      battery_pct: battery ? Number(battery) : null, \r\n      ...coords \r\n    };\r\n    setStatus(\"Saving…\"); \r\n    const ok = await sendEvent(payload);\r\n    if (!ok) { \r\n      await enqueue(payload); \r\n      const reg = await navigator.serviceWorker?.ready; \r\n      await reg?.sync.register(\"flush-ride-queue\"); \r\n      setStatus(\"Saved offline\"); \r\n    } else { \r\n      setStatus(\"Saved\"); \r\n    }\r\n  }\r\n  \r\n  return (\r\n    <div className=\"fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-md border-t\">\r\n      <div className=\"max-w-md mx-auto space-y-3\">\r\n        <input \r\n          className=\"w-full border rounded p-2\" \r\n          placeholder=\"Battery % (optional)\" \r\n          value={battery} \r\n          onChange={e => setBattery(e.target.value)} \r\n        />\r\n        <div className=\"text-sm text-gray-600\">\r\n          {status || (state === \"seeking\" ? \"Seeking rides…\" : state === \"booked\" ? \"Booking confirmed\" : \"On a trip\")}\r\n        </div>\r\n        {state === \"seeking\" && (\r\n          <button \r\n            className=\"w-full bg-emerald-600 text-white rounded p-4 text-lg\" \r\n            onClick={async () => { \r\n              await post(\"booking_received\"); \r\n              setState(\"booked\"); \r\n            }}\r\n          >\r\n            Got a ride\r\n          </button>\r\n        )}\r\n        {state === \"booked\" && (\r\n          <div className=\"grid grid-cols-2 gap-3\">\r\n            <button \r\n              className=\"bg-emerald-600 text-white rounded p-4\" \r\n              onClick={async () => { \r\n                await post(\"ride_started\"); \r\n                setState(\"ontrip\"); \r\n              }}\r\n            >\r\n              Start trip\r\n            </button>\r\n            <button \r\n              className=\"border rounded p-4\" \r\n              onClick={async () => { \r\n                await post(\"booking_cancelled\"); \r\n                setState(\"seeking\"); \r\n              }}\r\n            >\r\n              Cancel\r\n            </button>\r\n          </div>\r\n        )}\r\n        {state === \"ontrip\" && (\r\n          <button \r\n            className=\"w-full bg-emerald-600 text-white rounded p-4 text-lg\" \r\n            onClick={async () => { \r\n              await post(\"ride_completed\"); \r\n              setState(\"seeking\"); \r\n            }}\r\n          >\r\n            End trip\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAQA,eAAe;IACb,OAAO,IAAI,QAA6B,CAAC,KAAK,MAC5C,UAAU,WAAW,CAAC,kBAAkB,CAAC,KAAK,KAAK;YACjD,oBAAoB;YACpB,YAAY;YACZ,SAAS;QACX,IAEC,IAAI,CAAC,CAAA,IAAK,CAAC;YAAE,KAAK,EAAE,MAAM,CAAC,QAAQ;YAAE,KAAK,EAAE,MAAM,CAAC,SAAS;QAAC,CAAC,GAC9D,KAAK,CAAC,IAAM,CAAC;YAAE,KAAK;YAAM,KAAK;QAAK,CAAC;AAC1C;AAEA,eAAe,UAAU,OAAY;IACnC,MAAM,QAAQ,CAAC,MAAM,yIAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE,IAAI,CAAC,OAAO,EAAE;IAC/D,MAAM,IAAI,MAAM,MAAM,mCAAmC;QACvD,QAAQ;QACR,SAAS;YACP,gBAAgB;YAChB,iBAAiB,CAAC,OAAO,EAAE,OAAO;QACpC;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,OAAO,EAAE,EAAE;AACb;AAEe,SAAS;;IACtB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAY;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAS;IAC/C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAS;IAE7C,IAAA,0KAAS;oCAAC;YACR,UAAU,aAAa,EAAE,iBAAiB;4CAAW,CAAC;oBACpD,IAAI,EAAE,IAAI,EAAE,SAAS,gBAAgB;wBACnC,IAAA,mIAAK,EAAC;oBACR;gBACF;;QACF;mCAAG,EAAE;IAEL,eAAe,KAAK,IAAkF;QACpG,UAAU;QACV,MAAM,SAAS,MAAM;QACrB,MAAM,UAAU;YACd,YAAY;YACZ,aAAa,IAAI,OAAO,WAAW;YACnC,aAAa,UAAU,OAAO,WAAW;YACzC,GAAG,MAAM;QACX;QACA,UAAU;QACV,MAAM,KAAK,MAAM,UAAU;QAC3B,IAAI,CAAC,IAAI;YACP,MAAM,IAAA,qIAAO,EAAC;YACd,MAAM,MAAM,MAAM,UAAU,aAAa,EAAE;YAC3C,MAAM,KAAK,KAAK,SAAS;YACzB,UAAU;QACZ,OAAO;YACL,UAAU;QACZ;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBACC,WAAU;oBACV,aAAY;oBACZ,OAAO;oBACP,UAAU,CAAA,IAAK,WAAW,EAAE,MAAM,CAAC,KAAK;;;;;;8BAE1C,6LAAC;oBAAI,WAAU;8BACZ,UAAU,CAAC,UAAU,YAAY,mBAAmB,UAAU,WAAW,sBAAsB,WAAW;;;;;;gBAE5G,UAAU,2BACT,6LAAC;oBACC,WAAU;oBACV,SAAS;wBACP,MAAM,KAAK;wBACX,SAAS;oBACX;8BACD;;;;;;gBAIF,UAAU,0BACT,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BACC,WAAU;4BACV,SAAS;gCACP,MAAM,KAAK;gCACX,SAAS;4BACX;sCACD;;;;;;sCAGD,6LAAC;4BACC,WAAU;4BACV,SAAS;gCACP,MAAM,KAAK;gCACX,SAAS;4BACX;sCACD;;;;;;;;;;;;gBAKJ,UAAU,0BACT,6LAAC;oBACC,WAAU;oBACV,SAAS;wBACP,MAAM,KAAK;wBACX,SAAS;oBACX;8BACD;;;;;;;;;;;;;;;;;AAOX;GA7FwB;KAAA","debugId":null}}]
}