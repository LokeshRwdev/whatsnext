module.exports=[33354,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},92966,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HeadManagerContext},30089,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"setAttributesFromProps",{enumerable:!0,get:function(){return g}});let d={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv",noModule:"noModule"},e=["onLoad","onReady","dangerouslySetInnerHTML","children","onError","strategy","stylesheets"];function f(a){return["async","defer","noModule"].includes(a)}function g(a,b){for(let[c,g]of Object.entries(b)){if(!b.hasOwnProperty(c)||e.includes(c)||void 0===g)continue;let h=d[c]||c.toLowerCase();"SCRIPT"===a.tagName&&f(h)?a[h]=!!g:a.setAttribute(h,String(g)),(!1===g||"SCRIPT"===a.tagName&&f(h)&&(!g||"false"===g))&&(a.setAttribute(h,""),a.removeAttribute(h))}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},12962,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={cancelIdleCallback:function(){return g},requestIdleCallback:function(){return f}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="undefined"!=typeof self&&self.requestIdleCallback&&self.requestIdleCallback.bind(window)||function(a){let b=Date.now();return self.setTimeout(function(){a({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-b))}})},1)},g="undefined"!=typeof self&&self.cancelIdleCallback&&self.cancelIdleCallback.bind(window)||function(a){return clearTimeout(a)};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},96665,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return t},handleClientScriptLoad:function(){return q},initScriptLoader:function(){return r}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(33354),g=a.r(46058),h=a.r(87924),i=f._(a.r(35112)),j=g._(a.r(72131)),k=a.r(92966),l=a.r(30089),m=a.r(12962),n=new Map,o=new Set,p=a=>{let{src:b,id:c,onLoad:d=()=>{},onReady:e=null,dangerouslySetInnerHTML:f,children:g="",strategy:h="afterInteractive",onError:j,stylesheets:k}=a,m=c||b;if(m&&o.has(m))return;if(n.has(b)){o.add(m),n.get(b).then(d,j);return}let p=()=>{e&&e(),o.add(m)},q=document.createElement("script"),r=new Promise((a,b)=>{q.addEventListener("load",function(b){a(),d&&d.call(this,b),p()}),q.addEventListener("error",function(a){b(a)})}).catch(function(a){j&&j(a)});f?(q.innerHTML=f.__html||"",p()):g?(q.textContent="string"==typeof g?g:Array.isArray(g)?g.join(""):"",p()):b&&(q.src=b,n.set(b,r)),(0,l.setAttributesFromProps)(q,a),"worker"===h&&q.setAttribute("type","text/partytown"),q.setAttribute("data-nscript",h),k&&(a=>{if(i.default.preinit)return a.forEach(a=>{i.default.preinit(a,{as:"style"})})})(k),document.body.appendChild(q)};function q(a){let{strategy:b="afterInteractive"}=a;"lazyOnload"===b?window.addEventListener("load",()=>{(0,m.requestIdleCallback)(()=>p(a))}):p(a)}function r(a){a.forEach(q),[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach(a=>{let b=a.id||a.getAttribute("src");o.add(b)})}function s(a){let{id:b,src:c="",onLoad:d=()=>{},onReady:e=null,strategy:f="afterInteractive",onError:g,stylesheets:l,...n}=a,{updateScripts:q,scripts:r,getIsSsr:s,appDir:t,nonce:u}=(0,j.useContext)(k.HeadManagerContext);u=n.nonce||u;let v=(0,j.useRef)(!1);(0,j.useEffect)(()=>{let a=b||c;v.current||(e&&a&&o.has(a)&&e(),v.current=!0)},[e,b,c]);let w=(0,j.useRef)(!1);if((0,j.useEffect)(()=>{if(!w.current){if("afterInteractive"===f)p(a);else"lazyOnload"===f&&("complete"===document.readyState?(0,m.requestIdleCallback)(()=>p(a)):window.addEventListener("load",()=>{(0,m.requestIdleCallback)(()=>p(a))}));w.current=!0}},[a,f]),("beforeInteractive"===f||"worker"===f)&&(q?(r[f]=(r[f]||[]).concat([{id:b,src:c,onLoad:d,onReady:e,onError:g,...n,nonce:u}]),q(r)):s&&s()?o.add(b||c):s&&!s()&&p({...a,nonce:u})),t){if(l&&l.forEach(a=>{i.default.preinit(a,{as:"style"})}),"beforeInteractive"===f)if(!c)return n.dangerouslySetInnerHTML&&(n.children=n.dangerouslySetInnerHTML.__html,delete n.dangerouslySetInnerHTML),(0,h.jsx)("script",{nonce:u,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([0,{...n,id:b}])})`}});else return i.default.preload(c,n.integrity?{as:"script",integrity:n.integrity,nonce:u,crossOrigin:n.crossOrigin}:{as:"script",nonce:u,crossOrigin:n.crossOrigin}),(0,h.jsx)("script",{nonce:u,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([c,{...n,id:b}])})`}});"afterInteractive"===f&&c&&i.default.preload(c,n.integrity?{as:"script",integrity:n.integrity,nonce:u,crossOrigin:n.crossOrigin}:{as:"script",nonce:u,crossOrigin:n.crossOrigin})}return null}Object.defineProperty(s,"__nextScript",{value:!0});let t=s;("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},47283,(a,b,c)=>{b.exports=a.r(96665)},20716,a=>{"use strict";let b,c,d,e;var f=a.i(87924),g=a.i(92375),h=a.i(97895);function i({trackingOn:a,permissionStatus:b,toggleTracking:c,error:d}){let e=function(a,b){if(b)return b;switch(a){case"granted":return"Foreground only";case"denied":return"Permission denied";case"prompt":return"Requires GPS access";case"unsupported":return"GPS unsupported";default:return a||""}}(b,d);return(0,f.jsxs)("button",{type:"button",onClick:c,className:(0,h.cn)("flex items-center gap-3 rounded-2xl border px-4 py-3 shadow-sm transition hover:border-primary",a?"bg-emerald-600 text-white":"bg-muted text-foreground"),"aria-pressed":a,children:[(0,f.jsx)("div",{className:"relative inline-flex h-5 w-10 items-center rounded-full bg-white/30 p-0.5",children:(0,f.jsx)("span",{className:(0,h.cn)("inline-block h-4 w-4 rounded-full bg-white transition",a?"translate-x-5":"translate-x-0")})}),(0,f.jsxs)("div",{className:"text-left",children:[(0,f.jsx)("p",{className:"text-sm font-semibold leading-tight",children:"Live Suggestions"}),(0,f.jsxs)("p",{className:"text-xs text-muted-foreground/90",children:[a?"Tracking enabled":"Tap to start"," | ",e]})]})]})}var j=a.i(72131);function k({trackingOn:a,lastPingAt:b,permissionStatus:c}){let[d,e]=(0,j.useState)("--");(0,j.useEffect)(()=>{if(!b)return void e("No GPS yet");let a=()=>{let a=Math.floor((Date.now()-Date.parse(b))/1e3);a<5?e("Just now"):e(`${a}s ago`)};a();let c=setInterval(a,5e3);return()=>clearInterval(c)},[b]);let g="Paused",i="bg-muted text-foreground";a&&b&&Date.now()-Date.parse(b)<15e3?(g="Live | Updating",i="bg-emerald-600 text-white"):a?"denied"===c?(g="No GPS",i="bg-amber-500 text-white"):(g="Waiting",i="bg-muted text-foreground"):g="Paused";let k=i.includes("text-white")?"text-white/80":"text-muted-foreground";return(0,f.jsxs)("div",{className:(0,h.cn)("inline-flex flex-col rounded-2xl px-4 py-2 text-xs font-medium",i),children:[(0,f.jsx)("span",{className:"text-sm font-semibold leading-none",children:g}),(0,f.jsxs)("span",{className:(0,h.cn)("text-[11px] leading-tight",k),children:["Last update: ",d]})]})}var l=a.i(71630);let m=(0,a.i(33915).create)(a=>({trackingOn:!1,permissionStatus:"prompt",lastFix:null,lastPingAt:null,lastRecommendation:null,error:null,isDriving:!1,autoStartPending:!0,setTrackingOn:b=>a({trackingOn:b}),setPermissionStatus:b=>a({permissionStatus:b}),setLastFix:b=>a({lastFix:b}),setLastPingAt:b=>a({lastPingAt:b}),setRecommendation:b=>a({lastRecommendation:b}),setError:b=>a({error:b}),setIsDriving:b=>a(()=>({isDriving:b,autoStartPending:!b})),setAutoStartPending:b=>a({autoStartPending:b})}));var n=a.i(3130),o=a.i(40695);let p=(0,a.i(70106).default)("arrow-up-right",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);var q=a.i(24987),r=a.i(69520),s=a.i(42724),t=a.i(44513),u=a.i(52587),v=a.i(23464),w=a.i(57270),x=a.i(74016);function y(a,b){let c=(0,x.toDate)(a)-(0,x.toDate)(b);return c<0?-1:c>0?1:c}var z=a.i(59296);function A({trackingOn:a,seedRecommendation:b}){var c,d;let{data:e}=function(a=0){let[b,c]=(0,j.useState)(null),[d,e]=(0,j.useState)(!0),[f,g]=(0,j.useState)(null),h=(0,j.useCallback)(async()=>{let{data:a,error:b}=await (0,l.fetchDriverState)();b?g(b.message):(g(null),c(a)),e(!1)},[]);return(0,j.useEffect)(()=>{if(h(),a>0){let b=setInterval(h,a);return()=>clearInterval(b)}},[h,a]),{data:b,loading:d,error:f,refresh:h}}(),[g,h]=(0,j.useState)(b??null),[i,k]=(0,j.useState)(!b),[p,q]=(0,j.useState)(null),A=m(a=>a.setRecommendation),D=m(a=>a.lastFix),E=(0,j.useRef)(D);(0,j.useEffect)(()=>{E.current=D},[D]);let F=(0,j.useCallback)(a=>{h(a),A(a)},[A]),G=(0,j.useCallback)(()=>{if(e?.recommendation){let a=e.recommendation;if(Date.now()-Date.parse(a.computed_at)<45e3)return F(a),q(null),k(!1),!0}return!1},[e,F]),H=(0,j.useCallback)(async()=>{k(!0);let a={k:3},b=E.current;b&&(a.lat=b.lat,a.lon=b.lon);let{data:c,error:d}=await (0,l.fetchRecommendations)(a);d?"NO_STATE"===d.code?q("We couldn't get your current location. Enable live tracking or share location to see zone recommendations."):q(d.message):(q(null),F(c)),k(!1)},[F]);(0,j.useEffect)(()=>{b||G()||H()},[b,G,H]),(0,j.useEffect)(()=>{G()},[e,G]),(0,j.useEffect)(()=>{b&&(!g||b.computed_at!==g.computed_at)&&F(b)},[b,g,F]),(0,j.useEffect)(()=>{if(!a)return;let b=setInterval(()=>H(),15e3);return()=>clearInterval(b)},[a,H]);let I=!i&&!p&&(!g||!g.top||0===g.top.length),J=a&&!D,K=g?.computed_at?(c=new Date(g.computed_at),d={addSuffix:!0},function(a,b,c){var d;let e,f=(0,u.getDefaultOptions)(),g=c?.locale??f.locale??t.defaultLocale,h=y(a,b);if(isNaN(h))throw RangeError("Invalid time value");let i=Object.assign({},c,{addSuffix:c?.addSuffix,comparison:h}),[j,k]=(0,w.normalizeDates)(c?.in,...h>0?[b,a]:[a,b]),l=(d=void 0,a=>{let b=(d?Math[d]:Math.trunc)(a);return 0===b?0:b})(((0,x.toDate)(k)-(0,x.toDate)(j))/1e3),m=Math.round((l-((0,v.getTimezoneOffsetInMilliseconds)(k)-(0,v.getTimezoneOffsetInMilliseconds)(j))/1e3)/60);if(m<2)if(c?.includeSeconds)if(l<5)return g.formatDistance("lessThanXSeconds",5,i);else if(l<10)return g.formatDistance("lessThanXSeconds",10,i);else if(l<20)return g.formatDistance("lessThanXSeconds",20,i);else if(l<40)return g.formatDistance("halfAMinute",0,i);else if(l<60)return g.formatDistance("lessThanXMinutes",1,i);else return g.formatDistance("xMinutes",1,i);else if(0===m)return g.formatDistance("lessThanXMinutes",1,i);else return g.formatDistance("xMinutes",m,i);if(m<45)return g.formatDistance("xMinutes",m,i);if(m<90)return g.formatDistance("aboutXHours",1,i);if(m<z.minutesInDay){let a=Math.round(m/60);return g.formatDistance("aboutXHours",a,i)}if(m<2520)return g.formatDistance("xDays",1,i);else if(m<z.minutesInMonth){let a=Math.round(m/z.minutesInDay);return g.formatDistance("xDays",a,i)}else if(m<2*z.minutesInMonth)return e=Math.round(m/z.minutesInMonth),g.formatDistance("aboutXMonths",e,i);if((e=function(a,b,c){var d,e;let f,g,h,i,[j,k,l]=(0,w.normalizeDates)(void 0,a,a,b),m=y(k,l),n=Math.abs(function(a,b,c){let[d,e]=(0,w.normalizeDates)(void 0,a,b);return 12*(d.getFullYear()-e.getFullYear())+(d.getMonth()-e.getMonth())}(k,l));if(n<1)return 0;1===k.getMonth()&&k.getDate()>27&&k.setDate(30),k.setMonth(k.getMonth()-m*n);let o=y(k,l)===-m;+(f=(0,x.toDate)(j,void 0),d=void 0,(g=(0,x.toDate)(f,d?.in)).setHours(23,59,59,999),g)==+(e=void 0,i=(h=(0,x.toDate)(f,e?.in)).getMonth(),h.setFullYear(h.getFullYear(),i+1,0),h.setHours(23,59,59,999),h)&&1===n&&1===y(j,l)&&(o=!1);let p=m*(n-o);return 0===p?0:p}(k,j))<12){let a=Math.round(m/z.minutesInMonth);return g.formatDistance("xMonths",a,i)}{let a=e%12,b=Math.trunc(e/12);return a<3?g.formatDistance("aboutXYears",b,i):a<9?g.formatDistance("overXYears",b,i):g.formatDistance("almostXYears",b+1,i)}}(c,(0,s.constructFrom)(c,Date.now()),d)):null,L=g?.context,M="number"==typeof L?.traffic_speed_idx?L.traffic_speed_idx:null,N=g?.traffic_source??null,O=(0,j.useMemo)(()=>{var a;return[K?`Refreshed ${K}`:"Refreshed just now","google"===(a=N)?"Google live traffic":"cache"===a?"Cached traffic snapshot":"fallback"===a?"Estimated traffic":null,null!==M?`Avg traffic ${C(M)}`:null].filter(Boolean).join(" | ")},[K,N,M]);return(0,f.jsxs)(n.Card,{className:"shadow-sm",children:[(0,f.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between space-y-0",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)(n.CardTitle,{className:"text-base font-semibold",children:"Next best zones"}),(0,f.jsx)("p",{className:"text-xs text-muted-foreground",children:O})]}),(0,f.jsx)(o.Button,{variant:"ghost",size:"icon","aria-label":"Refresh",onClick:H,children:(0,f.jsx)(r.RefreshCw,{className:"h-4 w-4"})})]}),(0,f.jsxs)(n.CardContent,{className:"space-y-4",children:[i&&(0,f.jsx)("div",{className:"space-y-3",children:[0,1,2].map(a=>(0,f.jsxs)("div",{className:"rounded-xl border p-3",children:[(0,f.jsx)("div",{className:"h-4 w-1/2 animate-pulse rounded bg-muted"}),(0,f.jsx)("div",{className:"mt-2 h-3 w-1/3 animate-pulse rounded bg-muted"})]},a))}),!i&&p&&(0,f.jsxs)("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:[p,(0,f.jsx)(o.Button,{size:"sm",variant:"secondary",className:"mt-3",onClick:H,children:"Try again"})]}),I&&(0,f.jsx)("div",{className:"rounded-xl border border-dashed p-4 text-sm text-muted-foreground",children:J?"Waiting for GPS fix...":"We'll start suggesting zones once we see your location."}),!i&&!p&&g?.top?.length?(0,f.jsx)("div",{className:"space-y-3",children:g.top.map(a=>(0,f.jsx)(B,{zone:a},a.zone_id))}):null]})]})}function B({zone:a}){let b="number"==typeof a.score,c="number"==typeof a.eta_min,d="number"==typeof a.distance_km?`${a.distance_km.toFixed(1)} km`:"Distance n/a",e=c?`${a.eta_min} min`:"ETA n/a",g=b?a.score.toFixed(2):"Score n/a",h=b?`${Math.min(100,Math.round(100*a.score))}%`:"0%",i="number"==typeof a.traffic_speed_idx?C(a.traffic_speed_idx):null;return(0,f.jsxs)("div",{className:"rounded-2xl border p-4",children:[(0,f.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:"flex items-center gap-2 text-base font-semibold",children:[(0,f.jsx)(q.MapPin,{className:"h-4 w-4 text-primary"}),a.zone_name]}),(0,f.jsxs)("p",{className:"text-xs text-muted-foreground",children:[d," | ",e," | ",g]}),i&&(0,f.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Traffic: ",i]})]}),(0,f.jsxs)(o.Button,{size:"sm",variant:"secondary",onClick:()=>{let b=encodeURIComponent(`${a.zone_name} Patna`);window.open(`https://www.google.com/maps/search/?api=1&query=${b}`,"_blank")},children:["Navigate",(0,f.jsx)(p,{className:"ml-1 h-3 w-3"})]})]}),(0,f.jsx)("div",{className:"mt-3 text-sm text-muted-foreground",children:a.reason}),(0,f.jsx)("div",{className:"mt-3 h-1.5 rounded-full bg-muted",children:(0,f.jsx)("div",{className:"h-full rounded-full bg-emerald-500",style:{width:h}})})]})}function C(a){return a>=.85?"Smooth":a>=.65?"Moderate":a>=.4?"Busy":"Heavy"}var D=a.i(47283);let E="AIzaSyBmrEg7SfI6pHlfcoAhOBG5GbHXxFz9pqk";function F({currentLocation:a,recommendedZones:b}){let c=(0,j.useRef)(null),[d,e]=(0,j.useState)(!1),[g,h]=(0,j.useState)(null),[i,k]=(0,j.useState)(null),[l,m]=(0,j.useState)(null),[p,q]=(0,j.useState)(!1),r=(0,j.useRef)([]),s=(0,j.useRef)(null),t=(0,j.useMemo)(()=>(b??[]).filter(a=>"number"==typeof a.lat&&"number"==typeof a.lon),[b]),u=(0,j.useCallback)(()=>{m("Geolocation is not supported by your browser")},[]);return(0,j.useEffect)(()=>(u(),()=>{null!==s.current&&navigator.geolocation&&navigator.geolocation.clearWatch(s.current)}),[u]),(0,j.useEffect)(()=>{if(!E||!d||g||!c.current)return;let b=window.google;if(!b?.maps)return;let e=a||i,f=e?{lat:e.lat,lng:e.lon}:{lat:25.617,lng:85.141},j=new b.maps.Map(c.current,{center:f,zoom:13,disableDefaultUI:!0}),k=new b.maps.TrafficLayer;return k.setMap(j),h(j),()=>{k.setMap(null)}},[d,g,a,i]),(0,j.useEffect)(()=>{if(!g)return;let b=window.google;if(!b?.maps)return;r.current.forEach(a=>a.setMap(null)),r.current=[];let c=new b.maps.LatLngBounds,d=!1,e=a||i;if(e){let a=new b.maps.Marker({map:g,position:{lat:e.lat,lng:e.lon},title:"You",icon:{path:b.maps.SymbolPath.CIRCLE,scale:7,fillColor:"#10b981",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2}});r.current.push(a),c.extend(a.getPosition()),d=!0,g.panTo(a.getPosition())}t.forEach((a,e)=>{let f=new b.maps.Marker({map:g,position:{lat:a.lat,lng:a.lon},label:`${e+1}`,title:a.zone_name});r.current.push(f),c.extend(f.getPosition()),d=!0}),d&&g.fitBounds(c,48)},[g,t,a,i]),(0,f.jsxs)(n.Card,{className:"shadow-sm",children:[(0,f.jsxs)(n.CardHeader,{className:"space-y-1",children:[(0,f.jsx)(n.CardTitle,{className:"text-base font-semibold",children:"Live map preview"}),(0,f.jsx)("p",{className:"text-xs text-muted-foreground",children:"Browser geolocation + Google Maps traffic overlay (visual only)"})]}),(0,f.jsxs)(n.CardContent,{className:"space-y-3",children:[l&&(0,f.jsx)("div",{className:"rounded-lg bg-amber-50 px-3 py-2 text-xs text-amber-800",children:l}),(0,f.jsx)("div",{className:"flex justify-end",children:(0,f.jsx)(o.Button,{variant:"outline",size:"sm",onClick:u,disabled:p,children:p?"Requesting location...":"Use my current location"})}),(0,f.jsx)("div",{className:"h-64 w-full overflow-hidden rounded-2xl border",ref:c}),t.length>0?(0,f.jsx)("div",{className:"text-xs text-muted-foreground",children:t.slice(0,3).map((a,b)=>(0,f.jsxs)("div",{children:["#",b+1," ",a.zone_name,": ",a.eta_min.toFixed(1)," min,"," ",a.distance_km.toFixed(1)," km"]},a.zone_id))}):(0,f.jsx)("p",{className:"text-xs text-muted-foreground",children:"Start tracking to see nearby recommended zones on the map."})]}),(0,f.jsx)(D.default,{id:"google-maps-js",src:`https://maps.googleapis.com/maps/api/js?key=${E}&libraries=visualization`,strategy:"lazyOnload",onLoad:()=>e(!0)})]})}var G=a.i(23292);let H=[{type:"booking_received",label:"Got a Ride",variant:"default"},{type:"ride_started",label:"Ride Started",variant:"secondary"},{type:"ride_completed",label:"Ride Completed",variant:"outline"},{type:"booking_cancelled",label:"Booking Cancelled",variant:"ghost"}];function I({lastFix:a}){let[b,c]=(0,j.useState)("ola"),[d,e]=(0,j.useState)(null),[g,h]=(0,j.useState)(!1),i=m(a=>a.setIsDriving),k=(0,j.useMemo)(()=>a?`${a.lat.toFixed(4)}, ${a.lon.toFixed(4)}`:"No live GPS",[a]),n=async()=>{if(!d)return;h(!0);let c={event_type:d.type,platform:b};a&&("ride_completed"===d.type?(c.drop_lat=a.lat,c.drop_lon=a.lon):(c.pickup_lat=a.lat,c.pickup_lon=a.lon));let{error:f}=await (0,l.postRideEvent)(c);h(!1),e(null),f?G.toast.error(f.message):(G.toast.success(`${function(a){switch(a){case"booking_received":return"Booking";case"ride_started":return"Ride start";case"ride_completed":return"Ride completion";case"booking_cancelled":return"Cancellation";default:return"Event"}}(d.type)} logged`),function(a,b){switch(a){case"ride_started":b(!0);return;case"ride_completed":case"booking_cancelled":case"booking_received":b(!1);return;default:return}}(d.type,i))};return(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between rounded-2xl border bg-white/60 px-4 py-3 shadow-sm",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"text-xs uppercase text-muted-foreground",children:"Current platform"}),(0,f.jsx)("div",{className:"mt-1 inline-flex gap-2 rounded-full bg-muted p-1",children:["ola","uber"].map(a=>(0,f.jsx)("button",{type:"button",onClick:()=>c(a),className:`rounded-full px-3 py-1 text-xs font-semibold capitalize transition ${b===a?"bg-white text-foreground shadow":"text-muted-foreground"}`,children:a},a))})]}),(0,f.jsxs)("div",{className:"text-right text-xs text-muted-foreground",children:[(0,f.jsx)("p",{children:"Last fix"}),(0,f.jsx)("p",{className:"font-semibold text-foreground",children:k})]})]}),(0,f.jsx)("div",{className:"grid grid-cols-2 gap-3",children:H.map(a=>(0,f.jsx)(o.Button,{className:"booking_received"===a.type?"col-span-2 h-14 text-base":"h-12",variant:a.variant,onClick:()=>e(a),children:a.label},a.type))}),(0,f.jsx)("p",{className:"text-xs text-muted-foreground",children:"Your live location is only used to suggest better zones and calculate your performance. It stays private to you."}),d&&(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 pb-8",children:(0,f.jsxs)("div",{className:"w-full max-w-md rounded-3xl bg-bg p-5 shadow-2xl",children:[(0,f.jsx)("p",{className:"text-sm font-semibold text-muted-foreground",children:"Confirm action"}),(0,f.jsx)("h3",{className:"text-2xl font-semibold",children:d.label}),(0,f.jsxs)("p",{className:"mt-2 text-sm text-muted-foreground",children:["Platform: ",(0,f.jsx)("span",{className:"font-medium capitalize",children:b})]}),(0,f.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Location: ",(0,f.jsx)("span",{className:"font-medium",children:k})]}),(0,f.jsxs)("div",{className:"mt-5 flex gap-3",children:[(0,f.jsx)(o.Button,{variant:"outline",className:"flex-1",onClick:()=>e(null),children:"Cancel"}),(0,f.jsx)(o.Button,{className:"flex-1",onClick:n,disabled:g,children:g?"Saving.":"Confirm"})]})]})})]})}function J({accuracy:a,trackingOn:b}){let c=b?"GPS: waiting for fix":"GPS: paused",d="bg-muted text-muted-foreground";if("number"==typeof a&&Number.isFinite(a)){let b=Math.max(0,Math.round(a));b<=30?(c=`GPS: ${b}m accuracy`,d="bg-emerald-100 text-emerald-900"):b<=100?(c=`GPS: ${b}m (ok)`,d="bg-amber-100 text-amber-900"):(c=`GPS: ${b}m (weak) - move outdoors`,d="bg-rose-100 text-rose-900")}else b&&(d="bg-muted text-muted-foreground");return(0,f.jsx)("div",{className:(0,h.cn)("inline-flex rounded-full px-3 py-1 text-xs font-semibold",d),children:c})}let K=(a,b)=>b.some(b=>a instanceof b),L=new WeakMap,M=new WeakMap,N=new WeakMap,O={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return L.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return P(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function P(a){if(a instanceof IDBRequest){let b;return b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(P(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)}),N.set(b,a),b}if(M.has(a))return M.get(a);let d=function(a){if("function"==typeof a)return(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){return a.apply(Q(this),b),P(this.request)}:function(...b){return P(a.apply(Q(this),b))};return(a instanceof IDBTransaction&&function(a){if(L.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});L.set(a,b)}(a),K(a,b||(b=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(a,O):a}(a);return d!==a&&(M.set(a,d),N.set(d,a)),d}let Q=a=>N.get(a),R=["get","getKey","getAll","getAllKeys","count"],S=["put","add","delete","clear"],T=new Map;function U(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(T.get(b))return T.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=S.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||R.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return T.set(b,f),f}O={...d=O,get:(a,b,c)=>U(a,b)||d.get(a,b,c),has:(a,b)=>!!U(a,b)||d.has(a,b)};let V=["continue","continuePrimaryKey","advance"],W={},X=new WeakMap,Y=new WeakMap,Z={get(a,b){if(!V.includes(b))return a[b];let c=W[b];return c||(c=W[b]=function(...a){X.set(this,Y.get(this)[b](...a))}),c}};async function*$(...a){let b=this;if(b instanceof IDBCursor||(b=await b.openCursor(...a)),!b)return;let c=new Proxy(b,Z);for(Y.set(c,b),N.set(c,Q(b));b;)yield c,b=await (X.get(c)||b.continue()),X.delete(c)}function _(a,b){return b===Symbol.asyncIterator&&K(a,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===b&&K(a,[IDBIndex,IDBObjectStore])}O={...e=O,get:(a,b,c)=>_(a,b)?$:e.get(a,b,c),has:(a,b)=>_(a,b)||e.has(a,b)};let aa="events";async function ab(){return function(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,1),h=P(g);return d&&g.addEventListener("upgradeneeded",a=>{d(P(g.result),a.oldVersion,a.newVersion,P(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h}("ride-db",0,{upgrade(a){a.createObjectStore(aa,{keyPath:"id",autoIncrement:!0})}})}async function ac(a){(await ab()).add(aa,{...a,created_at:Date.now()})}let ad=(0,a.i(69240).createBrowserSupabaseClient)();var ae=a.i(82279);function af(){let a,b,c,d,e,h,n,o,p,q,r,s,t,u,v,w,x,y,z,B,C,D,E,H=(a=m(a=>a.trackingOn),b=m(a=>a.permissionStatus),c=m(a=>a.lastFix),d=m(a=>a.lastPingAt),e=m(a=>a.lastRecommendation),h=m(a=>a.error),n=m(a=>a.autoStartPending),o=m(a=>a.setTrackingOn),p=m(a=>a.setPermissionStatus),q=m(a=>a.setLastFix),r=m(a=>a.setLastPingAt),s=m(a=>a.setRecommendation),t=m(a=>a.setError),u=m(a=>a.setAutoStartPending),v=(0,j.useRef)(null),w=(0,j.useRef)(0),x=(0,j.useRef)(null),y=(0,j.useCallback)(async()=>{try{if(navigator.permissions?.query){let a=await navigator.permissions.query({name:"geolocation"});p(a.state),a.onchange=()=>p(a.state)}else p("unsupported")}catch(a){console.warn("permission query failed",a),p("unsupported")}},[p]),(0,j.useEffect)(()=>{y()},[y]),z=(0,j.useCallback)(()=>{null!==v.current&&"undefined"!=typeof navigator&&navigator.geolocation&&(navigator.geolocation.clearWatch(v.current),v.current=null)},[]),B=(0,j.useCallback)((a,b)=>{r(b),a&&s(a),t(null)},[r,s,t]),C=(0,j.useCallback)(async a=>{var b,c;let d,e,f,g,h,i="number"==typeof a.coords.accuracy?a.coords.accuracy:null;if(!Number.isFinite(i)||null===i||i>200)return void t("GPS accuracy is weak (>200m). Move outdoors for a clear fix.");let j="number"==typeof a.coords.speed&&Number.isFinite(a.coords.speed)?3.6*a.coords.speed:null;q({lat:a.coords.latitude,lon:a.coords.longitude,accuracy:i,speed:j,timestamp:a.timestamp}),t(null);let k=Date.now(),m=x.current,n=!1;if(m&&"number"==typeof m.coords.accuracy&&Number.isFinite(m.coords.accuracy)&&(n=i<=.5*m.coords.accuracy),m&&30>(b=m.coords,c=a.coords,d=b.latitude*Math.PI/180,f=(e=c.latitude*Math.PI/180)-d,2*Math.atan2(Math.sqrt(h=Math.sin(f/2)*Math.sin(f/2)+Math.cos(d)*Math.cos(e)*Math.sin((g=(c.longitude-b.longitude)*Math.PI/180)/2)*Math.sin(g/2)),Math.sqrt(1-h))*6371e3)&&k-w.current<5e3&&!n)return;x.current=a,w.current=k;let o={lat:a.coords.latitude,lon:a.coords.longitude,ts:new Date(a.timestamp).toISOString(),accuracy_m:i,speed_kmh:j??void 0},{data:p,error:r}=await (0,l.postPing)(o);if(r){t(r.message),await ac(o),G.toast.error("Could not sync live location. We'll retry soon.");return}B(p?.recommendation??null,o.ts??new Date().toISOString())},[q,B,t]),D=(0,j.useCallback)(async()=>{try{let{state:a}=await navigator.permissions.query({name:"geolocation"});if(p(a),"denied"===a)return G.toast.error("Location permission denied. Enable it in browser settings."),!1;return"prompt"===a&&(await new Promise((a,b)=>{navigator.geolocation.getCurrentPosition(a,b,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),p("granted")),!0}catch(a){return console.error("permission request failed",a),p("unsupported"),!1}},[p]),E=(0,j.useCallback)(async()=>{if(a){z(),o(!1);return}await D()?o(!0):t("Location permission required for live tracking")},[a,D,z,o,t]),(0,j.useEffect)(()=>{!a&&n&&(E(),u(!1))},[a,n,E,u]),(0,j.useEffect)(()=>{if(!a)return void z();if("undefined"==typeof navigator||!navigator.geolocation){t("Geolocation is not supported in this browser."),G.toast.error("Geolocation is not available on this device."),o(!1);return}return v.current=navigator.geolocation.watchPosition(a=>C(a),a=>{console.error("watchPosition error",a);let b=function(a){switch(a.code){case a.PERMISSION_DENIED:return"Location permission denied. Enable it in your browser settings.";case a.POSITION_UNAVAILABLE:return"GPS signal unavailable. Move outdoors for a clear view of the sky.";case a.TIMEOUT:return"Timed out while waiting for GPS. Try again from an open area.";default:return a.message||"Unable to determine your location."}}(a);t(b),a.code===a.PERMISSION_DENIED?(o(!1),p("denied"),G.toast.error("Permission denied. Please re-enable location access.")):G.toast.error(b)},{enableHighAccuracy:!0,maximumAge:0,timeout:15e3}),()=>z()},[a,C,z,t,o,p]),(0,j.useEffect)(()=>{function a(){t(null)}return window.addEventListener("online",a),()=>window.removeEventListener("online",a)},[t]),{trackingOn:a,permissionStatus:b,lastFix:c,lastPingAt:d,lastRecommendation:e,error:h,toggleTracking:E}),K=function(){let[a,b]=(0,j.useState)(null);return(0,j.useEffect)(()=>{let a=!0;return async function(){let{data:{user:c}}=await ad.auth.getUser();if(!c)return;let{data:d}=await ad.from("profiles").select("id,full_name").eq("id",c.id).maybeSingle();a&&b({id:c.id,full_name:d?.full_name??c.user_metadata?.full_name??null})}(),()=>{a=!1}},[]),a}(),{stats:L}=(0,ae.useTodayStats)(),M=K?.full_name?`Hi, ${K.full_name.split(" ")[0]}`:"Hi driver",N=`Today | ${L.totalTrips} trips | ?${L.totalEarnings.toFixed(0)}`;return(0,f.jsx)(g.DriverShell,{title:M,subtitle:N,children:(0,f.jsxs)("div",{className:"space-y-6",children:[(0,f.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,f.jsx)(i,{trackingOn:H.trackingOn,permissionStatus:H.permissionStatus,toggleTracking:H.toggleTracking,error:H.error}),(0,f.jsxs)("div",{className:"flex flex-col items-start gap-2 sm:items-end",children:[(0,f.jsx)(k,{trackingOn:H.trackingOn,lastPingAt:H.lastPingAt,permissionStatus:H.permissionStatus}),(0,f.jsx)(J,{trackingOn:H.trackingOn,accuracy:H.lastFix?.accuracy??null})]})]}),(0,f.jsx)(A,{trackingOn:H.trackingOn,seedRecommendation:H.lastRecommendation}),(0,f.jsx)(F,{currentLocation:H.lastFix,recommendedZones:H.lastRecommendation?.top??null}),(0,f.jsxs)("section",{className:"space-y-3",children:[(0,f.jsx)("h2",{className:"text-lg font-semibold",children:"Ride actions"}),(0,f.jsx)(I,{lastFix:H.lastFix})]})]})})}a.s(["default",()=>af],20716)}];

//# sourceMappingURL=_1beff549._.js.map