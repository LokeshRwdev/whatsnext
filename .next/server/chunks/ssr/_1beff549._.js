module.exports=[33354,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},92966,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HeadManagerContext},30089,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"setAttributesFromProps",{enumerable:!0,get:function(){return g}});let d={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv",noModule:"noModule"},e=["onLoad","onReady","dangerouslySetInnerHTML","children","onError","strategy","stylesheets"];function f(a){return["async","defer","noModule"].includes(a)}function g(a,b){for(let[c,g]of Object.entries(b)){if(!b.hasOwnProperty(c)||e.includes(c)||void 0===g)continue;let h=d[c]||c.toLowerCase();"SCRIPT"===a.tagName&&f(h)?a[h]=!!g:a.setAttribute(h,String(g)),(!1===g||"SCRIPT"===a.tagName&&f(h)&&(!g||"false"===g))&&(a.setAttribute(h,""),a.removeAttribute(h))}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},12962,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={cancelIdleCallback:function(){return g},requestIdleCallback:function(){return f}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="undefined"!=typeof self&&self.requestIdleCallback&&self.requestIdleCallback.bind(window)||function(a){let b=Date.now();return self.setTimeout(function(){a({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-b))}})},1)},g="undefined"!=typeof self&&self.cancelIdleCallback&&self.cancelIdleCallback.bind(window)||function(a){return clearTimeout(a)};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},96665,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return t},handleClientScriptLoad:function(){return q},initScriptLoader:function(){return r}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(33354),g=a.r(46058),h=a.r(87924),i=f._(a.r(35112)),j=g._(a.r(72131)),k=a.r(92966),l=a.r(30089),m=a.r(12962),n=new Map,o=new Set,p=a=>{let{src:b,id:c,onLoad:d=()=>{},onReady:e=null,dangerouslySetInnerHTML:f,children:g="",strategy:h="afterInteractive",onError:j,stylesheets:k}=a,m=c||b;if(m&&o.has(m))return;if(n.has(b)){o.add(m),n.get(b).then(d,j);return}let p=()=>{e&&e(),o.add(m)},q=document.createElement("script"),r=new Promise((a,b)=>{q.addEventListener("load",function(b){a(),d&&d.call(this,b),p()}),q.addEventListener("error",function(a){b(a)})}).catch(function(a){j&&j(a)});f?(q.innerHTML=f.__html||"",p()):g?(q.textContent="string"==typeof g?g:Array.isArray(g)?g.join(""):"",p()):b&&(q.src=b,n.set(b,r)),(0,l.setAttributesFromProps)(q,a),"worker"===h&&q.setAttribute("type","text/partytown"),q.setAttribute("data-nscript",h),k&&(a=>{if(i.default.preinit)return a.forEach(a=>{i.default.preinit(a,{as:"style"})})})(k),document.body.appendChild(q)};function q(a){let{strategy:b="afterInteractive"}=a;"lazyOnload"===b?window.addEventListener("load",()=>{(0,m.requestIdleCallback)(()=>p(a))}):p(a)}function r(a){a.forEach(q),[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach(a=>{let b=a.id||a.getAttribute("src");o.add(b)})}function s(a){let{id:b,src:c="",onLoad:d=()=>{},onReady:e=null,strategy:f="afterInteractive",onError:g,stylesheets:l,...n}=a,{updateScripts:q,scripts:r,getIsSsr:s,appDir:t,nonce:u}=(0,j.useContext)(k.HeadManagerContext);u=n.nonce||u;let v=(0,j.useRef)(!1);(0,j.useEffect)(()=>{let a=b||c;v.current||(e&&a&&o.has(a)&&e(),v.current=!0)},[e,b,c]);let w=(0,j.useRef)(!1);if((0,j.useEffect)(()=>{if(!w.current){if("afterInteractive"===f)p(a);else"lazyOnload"===f&&("complete"===document.readyState?(0,m.requestIdleCallback)(()=>p(a)):window.addEventListener("load",()=>{(0,m.requestIdleCallback)(()=>p(a))}));w.current=!0}},[a,f]),("beforeInteractive"===f||"worker"===f)&&(q?(r[f]=(r[f]||[]).concat([{id:b,src:c,onLoad:d,onReady:e,onError:g,...n,nonce:u}]),q(r)):s&&s()?o.add(b||c):s&&!s()&&p({...a,nonce:u})),t){if(l&&l.forEach(a=>{i.default.preinit(a,{as:"style"})}),"beforeInteractive"===f)if(!c)return n.dangerouslySetInnerHTML&&(n.children=n.dangerouslySetInnerHTML.__html,delete n.dangerouslySetInnerHTML),(0,h.jsx)("script",{nonce:u,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([0,{...n,id:b}])})`}});else return i.default.preload(c,n.integrity?{as:"script",integrity:n.integrity,nonce:u,crossOrigin:n.crossOrigin}:{as:"script",nonce:u,crossOrigin:n.crossOrigin}),(0,h.jsx)("script",{nonce:u,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([c,{...n,id:b}])})`}});"afterInteractive"===f&&c&&i.default.preload(c,n.integrity?{as:"script",integrity:n.integrity,nonce:u,crossOrigin:n.crossOrigin}:{as:"script",nonce:u,crossOrigin:n.crossOrigin})}return null}Object.defineProperty(s,"__nextScript",{value:!0});let t=s;("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},47283,(a,b,c)=>{b.exports=a.r(96665)},20716,a=>{"use strict";let b,c,d,e;var f=a.i(87924),g=a.i(92375),h=a.i(72131),i=a.i(71630);let j=(0,a.i(33915).create)(a=>({trackingOn:!1,permissionStatus:"prompt",lastFix:null,lastPingAt:null,lastRecommendation:null,error:null,isDriving:!1,autoStartPending:!0,setTrackingOn:b=>a({trackingOn:b}),setPermissionStatus:b=>a({permissionStatus:b}),setLastFix:b=>a({lastFix:b}),setLastPingAt:b=>a({lastPingAt:b}),setRecommendation:b=>a({lastRecommendation:b}),setError:b=>a({error:b}),setIsDriving:b=>a(()=>({isDriving:b,autoStartPending:!b})),setAutoStartPending:b=>a({autoStartPending:b})}));var k=a.i(3130),l=a.i(40695);let m=(0,a.i(70106).default)("arrow-up-right",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);var n=a.i(24987),o=a.i(69520),p=a.i(42724),q=a.i(44513),r=a.i(52587),s=a.i(23464),t=a.i(57270),u=a.i(74016);function v(a,b){let c=(0,u.toDate)(a)-(0,u.toDate)(b);return c<0?-1:c>0?1:c}var w=a.i(59296);function x({trackingOn:a,seedRecommendation:b}){var c,d;let{data:e}=function(a=0){let[b,c]=(0,h.useState)(null),[d,e]=(0,h.useState)(!0),[f,g]=(0,h.useState)(null),j=(0,h.useCallback)(async()=>{let{data:a,error:b}=await (0,i.fetchDriverState)();b?g(b.message):(g(null),c(a)),e(!1)},[]);return(0,h.useEffect)(()=>{if(j(),a>0){let b=setInterval(j,a);return()=>clearInterval(b)}},[j,a]),{data:b,loading:d,error:f,refresh:j}}(),[g,m]=(0,h.useState)(b??null),[n,x]=(0,h.useState)(!b),[A,B]=(0,h.useState)(null),C=j(a=>a.setRecommendation),D=j(a=>a.lastFix),E=(0,h.useRef)(D),F=(0,h.useRef)(0);(0,h.useEffect)(()=>{E.current=D},[D]);let G=(0,h.useCallback)(a=>{m(a),C(a)},[C]),H=(0,h.useCallback)(()=>{if(e?.recommendation){let a=e.recommendation;if(Date.now()-Date.parse(a.computed_at)<45e3)return G(a),B(null),x(!1),!0}return!1},[e,G]),I=(0,h.useCallback)(async()=>{let a=E.current;if(!a||"number"!=typeof a.accuracy||a.accuracy>100){B("Waiting for GPS fix (accuracy <100m). Move outdoors for better signal."),x(!1);return}F.current=Date.now(),x(!0);let b={k:3,lat:a.lat,lon:a.lon},{data:c,error:d}=await (0,i.fetchRecommendations)(b);d?"NO_STATE"===d.code?B("We couldn't get your current location. Enable live tracking or share location to see zone recommendations."):B(d.message):(B(null),G(c)),x(!1)},[G]);(0,h.useEffect)(()=>{b||H()||I()},[b,H,I]),(0,h.useEffect)(()=>{H()},[e,H]),(0,h.useEffect)(()=>{b&&(!g||b.computed_at!==g.computed_at)&&G(b)},[b,g,G]);let J=(0,h.useCallback)(()=>{Date.now()-F.current<18e4||I()},[I]);(0,h.useEffect)(()=>{if(!a)return;J();let b=setInterval(J,18e4);return()=>clearInterval(b)},[a,J]);let K=!n&&!A&&(!g||!g.top||0===g.top.length),L=a&&(!D||"number"!=typeof D.accuracy||D.accuracy>100),M=g?.computed_at?(c=new Date(g.computed_at),d={addSuffix:!0},function(a,b,c){var d;let e,f=(0,r.getDefaultOptions)(),g=c?.locale??f.locale??q.defaultLocale,h=v(a,b);if(isNaN(h))throw RangeError("Invalid time value");let i=Object.assign({},c,{addSuffix:c?.addSuffix,comparison:h}),[j,k]=(0,t.normalizeDates)(c?.in,...h>0?[b,a]:[a,b]),l=(d=void 0,a=>{let b=(d?Math[d]:Math.trunc)(a);return 0===b?0:b})(((0,u.toDate)(k)-(0,u.toDate)(j))/1e3),m=Math.round((l-((0,s.getTimezoneOffsetInMilliseconds)(k)-(0,s.getTimezoneOffsetInMilliseconds)(j))/1e3)/60);if(m<2)if(c?.includeSeconds)if(l<5)return g.formatDistance("lessThanXSeconds",5,i);else if(l<10)return g.formatDistance("lessThanXSeconds",10,i);else if(l<20)return g.formatDistance("lessThanXSeconds",20,i);else if(l<40)return g.formatDistance("halfAMinute",0,i);else if(l<60)return g.formatDistance("lessThanXMinutes",1,i);else return g.formatDistance("xMinutes",1,i);else if(0===m)return g.formatDistance("lessThanXMinutes",1,i);else return g.formatDistance("xMinutes",m,i);if(m<45)return g.formatDistance("xMinutes",m,i);if(m<90)return g.formatDistance("aboutXHours",1,i);if(m<w.minutesInDay){let a=Math.round(m/60);return g.formatDistance("aboutXHours",a,i)}if(m<2520)return g.formatDistance("xDays",1,i);else if(m<w.minutesInMonth){let a=Math.round(m/w.minutesInDay);return g.formatDistance("xDays",a,i)}else if(m<2*w.minutesInMonth)return e=Math.round(m/w.minutesInMonth),g.formatDistance("aboutXMonths",e,i);if((e=function(a,b,c){var d,e;let f,g,h,i,[j,k,l]=(0,t.normalizeDates)(void 0,a,a,b),m=v(k,l),n=Math.abs(function(a,b,c){let[d,e]=(0,t.normalizeDates)(void 0,a,b);return 12*(d.getFullYear()-e.getFullYear())+(d.getMonth()-e.getMonth())}(k,l));if(n<1)return 0;1===k.getMonth()&&k.getDate()>27&&k.setDate(30),k.setMonth(k.getMonth()-m*n);let o=v(k,l)===-m;+(f=(0,u.toDate)(j,void 0),d=void 0,(g=(0,u.toDate)(f,d?.in)).setHours(23,59,59,999),g)==+(e=void 0,i=(h=(0,u.toDate)(f,e?.in)).getMonth(),h.setFullYear(h.getFullYear(),i+1,0),h.setHours(23,59,59,999),h)&&1===n&&1===v(j,l)&&(o=!1);let p=m*(n-o);return 0===p?0:p}(k,j))<12){let a=Math.round(m/w.minutesInMonth);return g.formatDistance("xMonths",a,i)}{let a=e%12,b=Math.trunc(e/12);return a<3?g.formatDistance("aboutXYears",b,i):a<9?g.formatDistance("overXYears",b,i):g.formatDistance("almostXYears",b+1,i)}}(c,(0,p.constructFrom)(c,Date.now()),d)):null,N=g?.context,O="number"==typeof N?.traffic_speed_idx?N.traffic_speed_idx:null,P=g?.traffic_source??null,Q=(0,h.useMemo)(()=>{var a;return[M?`Refreshed ${M}`:"Refreshed just now","google"===(a=P)?"Google live traffic":"cache"===a?"Cached traffic snapshot":"fallback"===a?"Estimated traffic":null,null!==O?`Avg traffic ${z(O)}`:null].filter(Boolean).join(" | ")},[M,P,O]);return(0,f.jsxs)(k.Card,{className:"shadow-sm",children:[(0,f.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between space-y-0",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)(k.CardTitle,{className:"text-base font-semibold",children:"Next best zones"}),(0,f.jsx)("p",{className:"text-xs text-muted-foreground",children:Q})]}),(0,f.jsx)(l.Button,{variant:"ghost",size:"icon","aria-label":"Refresh",onClick:I,children:(0,f.jsx)(o.RefreshCw,{className:"h-4 w-4"})})]}),(0,f.jsxs)(k.CardContent,{className:"space-y-4",children:[n&&(0,f.jsx)("div",{className:"space-y-3",children:[0,1,2].map(a=>(0,f.jsxs)("div",{className:"rounded-xl border p-3",children:[(0,f.jsx)("div",{className:"h-4 w-1/2 animate-pulse rounded bg-muted"}),(0,f.jsx)("div",{className:"mt-2 h-3 w-1/3 animate-pulse rounded bg-muted"})]},a))}),!n&&A&&(0,f.jsxs)("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:[A,(0,f.jsx)(l.Button,{size:"sm",variant:"secondary",className:"mt-3",onClick:I,children:"Try again"})]}),K&&(0,f.jsx)("div",{className:"rounded-xl border border-dashed p-4 text-sm text-muted-foreground",children:L?(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-medium",children:"Waiting for GPS fix..."}),(0,f.jsx)("p",{className:"mt-1 text-xs",children:"Move outdoors for clear sky view. Accuracy must be <100m."}),D?.accuracy&&(0,f.jsxs)("p",{className:"mt-1 text-xs text-amber-600",children:["Current accuracy: ",D.accuracy.toFixed(0),"m"]})]}):"We'll start suggesting zones once we see your location."}),!n&&!A&&g?.top?.length?(0,f.jsx)("div",{className:"space-y-3",children:g.top.map(a=>(0,f.jsx)(y,{zone:a},a.zone_id))}):null]})]})}function y({zone:a}){let b="number"==typeof a.score,c="number"==typeof a.eta_min,d="number"==typeof a.distance_km?`${a.distance_km.toFixed(1)} km`:"Distance n/a",e=c?`${a.eta_min} min`:"ETA n/a",g=b?a.score.toFixed(2):"Score n/a",h=b?`${Math.min(100,Math.round(100*a.score))}%`:"0%",i="number"==typeof a.traffic_speed_idx?z(a.traffic_speed_idx):null;return(0,f.jsxs)("div",{className:"rounded-2xl border p-4",children:[(0,f.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:"flex items-center gap-2 text-base font-semibold",children:[(0,f.jsx)(n.MapPin,{className:"h-4 w-4 text-primary"}),a.zone_name]}),(0,f.jsxs)("p",{className:"text-xs text-muted-foreground",children:[d," | ",e," | ",g]}),i&&(0,f.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Traffic: ",i]})]}),(0,f.jsxs)(l.Button,{size:"sm",variant:"secondary",onClick:()=>{let b=encodeURIComponent(`${a.zone_name} Patna`);window.open(`https://www.google.com/maps/search/?api=1&query=${b}`,"_blank")},children:["Navigate",(0,f.jsx)(m,{className:"ml-1 h-3 w-3"})]})]}),(0,f.jsx)("div",{className:"mt-3 text-sm text-muted-foreground",children:a.reason}),(0,f.jsx)("div",{className:"mt-3 h-1.5 rounded-full bg-muted",children:(0,f.jsx)("div",{className:"h-full rounded-full bg-emerald-500",style:{width:h}})})]})}function z(a){return a>=.85?"Smooth":a>=.65?"Moderate":a>=.4?"Busy":"Heavy"}var A=a.i(47283);let B="AIzaSyBmrEg7SfI6pHlfcoAhOBG5GbHXxFz9pqk";function C({currentLocation:a,recommendedZones:b}){let c=(0,h.useRef)(null),[d,e]=(0,h.useState)(!1),[g,i]=(0,h.useState)(null),[j,m]=(0,h.useState)(null),[n,o]=(0,h.useState)(null),[p,q]=(0,h.useState)(!1),r=(0,h.useRef)([]),s=(0,h.useRef)(null),t=(0,h.useMemo)(()=>(b??[]).filter(a=>"number"==typeof a.lat&&"number"==typeof a.lon),[b]),u=(0,h.useCallback)(()=>{o("Geolocation is not supported by your browser")},[]);return(0,h.useEffect)(()=>(u(),()=>{null!==s.current&&navigator.geolocation&&navigator.geolocation.clearWatch(s.current)}),[u]),(0,h.useEffect)(()=>{if(!B||!d||g||!c.current)return;let b=window.google;if(!b?.maps)return;let e=a||j,f=e?{lat:e.lat,lng:e.lon}:{lat:25.617,lng:85.141},h=new b.maps.Map(c.current,{center:f,zoom:13,disableDefaultUI:!0}),k=new b.maps.TrafficLayer;return k.setMap(h),i(h),()=>{k.setMap(null)}},[d,g,a,j]),(0,h.useEffect)(()=>{if(!g)return;let b=window.google;if(!b?.maps)return;r.current.forEach(a=>a.setMap(null)),r.current=[];let c=new b.maps.LatLngBounds,d=!1,e=a||j;if(e){let a=new b.maps.Marker({map:g,position:{lat:e.lat,lng:e.lon},title:"You",icon:{path:b.maps.SymbolPath.CIRCLE,scale:7,fillColor:"#10b981",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2}});r.current.push(a),c.extend(a.getPosition()),d=!0,g.panTo(a.getPosition())}t.forEach((a,e)=>{let f=new b.maps.Marker({map:g,position:{lat:a.lat,lng:a.lon},label:`${e+1}`,title:a.zone_name});r.current.push(f),c.extend(f.getPosition()),d=!0}),d&&g.fitBounds(c,48)},[g,t,a,j]),(0,f.jsxs)(k.Card,{className:"shadow-sm",children:[(0,f.jsxs)(k.CardHeader,{className:"space-y-1",children:[(0,f.jsx)(k.CardTitle,{className:"text-base font-semibold",children:"Live map preview"}),(0,f.jsx)("p",{className:"text-xs text-muted-foreground",children:"Browser geolocation + Google Maps traffic overlay (visual only)"})]}),(0,f.jsxs)(k.CardContent,{className:"space-y-3",children:[n&&(0,f.jsx)("div",{className:"rounded-lg bg-amber-50 px-3 py-2 text-xs text-amber-800",children:n}),(0,f.jsx)("div",{className:"flex justify-end",children:(0,f.jsx)(l.Button,{variant:"outline",size:"sm",onClick:u,disabled:p,children:p?"Requesting location...":"Use my current location"})}),(0,f.jsx)("div",{className:"h-64 w-full overflow-hidden rounded-2xl border",ref:c}),t.length>0?(0,f.jsx)("div",{className:"text-xs text-muted-foreground",children:t.slice(0,3).map((a,b)=>(0,f.jsxs)("div",{children:["#",b+1," ",a.zone_name,": ",a.eta_min.toFixed(1)," min,"," ",a.distance_km.toFixed(1)," km"]},a.zone_id))}):(0,f.jsx)("p",{className:"text-xs text-muted-foreground",children:"Start tracking to see nearby recommended zones on the map."})]}),(0,f.jsx)(A.default,{id:"google-maps-js",src:`https://maps.googleapis.com/maps/api/js?key=${B}&libraries=visualization`,strategy:"lazyOnload",onLoad:()=>e(!0)})]})}var D=a.i(23292);let E=[{type:"booking_received",label:"Got a Ride",variant:"default"},{type:"ride_started",label:"Ride Started",variant:"secondary"},{type:"ride_completed",label:"Ride Completed",variant:"outline"},{type:"booking_cancelled",label:"Booking Cancelled",variant:"ghost"}];function F({lastFix:a}){let[b,c]=(0,h.useState)("ola"),[d,e]=(0,h.useState)(null),[g,k]=(0,h.useState)(!1),m=j(a=>a.setIsDriving),n=(0,h.useMemo)(()=>a?`${a.lat.toFixed(4)}, ${a.lon.toFixed(4)}`:"No live GPS",[a]),o=async()=>{if(!d)return;k(!0);let c={event_type:d.type,platform:b};a&&("ride_completed"===d.type?(c.drop_lat=a.lat,c.drop_lon=a.lon):(c.pickup_lat=a.lat,c.pickup_lon=a.lon));let{error:f}=await (0,i.postRideEvent)(c);k(!1),e(null),f?D.toast.error(f.message):(D.toast.success(`${function(a){switch(a){case"booking_received":return"Booking";case"ride_started":return"Ride start";case"ride_completed":return"Ride completion";case"booking_cancelled":return"Cancellation";default:return"Event"}}(d.type)} logged`),function(a,b){switch(a){case"ride_started":b(!0);return;case"ride_completed":case"booking_cancelled":case"booking_received":b(!1);return;default:return}}(d.type,m))};return(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between rounded-2xl border bg-white/60 px-4 py-3 shadow-sm",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"text-xs uppercase text-muted-foreground",children:"Current platform"}),(0,f.jsx)("div",{className:"mt-1 inline-flex gap-2 rounded-full bg-muted p-1",children:["ola","uber"].map(a=>(0,f.jsx)("button",{type:"button",onClick:()=>c(a),className:`rounded-full px-3 py-1 text-xs font-semibold capitalize transition ${b===a?"bg-white text-foreground shadow":"text-muted-foreground"}`,children:a},a))})]}),(0,f.jsxs)("div",{className:"text-right text-xs text-muted-foreground",children:[(0,f.jsx)("p",{children:"Last fix"}),(0,f.jsx)("p",{className:"font-semibold text-foreground",children:n})]})]}),(0,f.jsx)("div",{className:"grid grid-cols-2 gap-3",children:E.map(a=>(0,f.jsx)(l.Button,{className:"booking_received"===a.type?"col-span-2 h-14 text-base":"h-12",variant:a.variant,onClick:()=>e(a),children:a.label},a.type))}),(0,f.jsx)("p",{className:"text-xs text-muted-foreground",children:"Your live location is only used to suggest better zones and calculate your performance. It stays private to you."}),d&&(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 pb-8",children:(0,f.jsxs)("div",{className:"w-full max-w-md rounded-3xl bg-bg p-5 shadow-2xl",children:[(0,f.jsx)("p",{className:"text-sm font-semibold text-muted-foreground",children:"Confirm action"}),(0,f.jsx)("h3",{className:"text-2xl font-semibold",children:d.label}),(0,f.jsxs)("p",{className:"mt-2 text-sm text-muted-foreground",children:["Platform: ",(0,f.jsx)("span",{className:"font-medium capitalize",children:b})]}),(0,f.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Location: ",(0,f.jsx)("span",{className:"font-medium",children:n})]}),(0,f.jsxs)("div",{className:"mt-5 flex gap-3",children:[(0,f.jsx)(l.Button,{variant:"outline",className:"flex-1",onClick:()=>e(null),children:"Cancel"}),(0,f.jsx)(l.Button,{className:"flex-1",onClick:o,disabled:g,children:g?"Saving.":"Confirm"})]})]})})]})}var G=a.i(97895);function H({accuracy:a,trackingOn:b}){let c=b?"GPS: waiting for fix":"GPS: paused",d="bg-muted text-muted-foreground";if("number"==typeof a&&Number.isFinite(a)){let b=Math.max(0,Math.round(a));b<=30?(c=`GPS: ${b}m accuracy`,d="bg-emerald-100 text-emerald-900"):b<=100?(c=`GPS: ${b}m (ok)`,d="bg-amber-100 text-amber-900"):(c=`GPS: ${b}m (weak) - move outdoors`,d="bg-rose-100 text-rose-900")}else b&&(d="bg-muted text-muted-foreground");return(0,f.jsx)("div",{className:(0,G.cn)("inline-flex rounded-full px-3 py-1 text-xs font-semibold",d),children:c})}let I=(a,b)=>b.some(b=>a instanceof b),J=new WeakMap,K=new WeakMap,L=new WeakMap,M={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return J.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return N(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function N(a){if(a instanceof IDBRequest){let b;return b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(N(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)}),L.set(b,a),b}if(K.has(a))return K.get(a);let d=function(a){if("function"==typeof a)return(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){return a.apply(O(this),b),N(this.request)}:function(...b){return N(a.apply(O(this),b))};return(a instanceof IDBTransaction&&function(a){if(J.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});J.set(a,b)}(a),I(a,b||(b=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(a,M):a}(a);return d!==a&&(K.set(a,d),L.set(d,a)),d}let O=a=>L.get(a),P=["get","getKey","getAll","getAllKeys","count"],Q=["put","add","delete","clear"],R=new Map;function S(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(R.get(b))return R.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=Q.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||P.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return R.set(b,f),f}M={...d=M,get:(a,b,c)=>S(a,b)||d.get(a,b,c),has:(a,b)=>!!S(a,b)||d.has(a,b)};let T=["continue","continuePrimaryKey","advance"],U={},V=new WeakMap,W=new WeakMap,X={get(a,b){if(!T.includes(b))return a[b];let c=U[b];return c||(c=U[b]=function(...a){V.set(this,W.get(this)[b](...a))}),c}};async function*Y(...a){let b=this;if(b instanceof IDBCursor||(b=await b.openCursor(...a)),!b)return;let c=new Proxy(b,X);for(W.set(c,b),L.set(c,O(b));b;)yield c,b=await (V.get(c)||b.continue()),V.delete(c)}function Z(a,b){return b===Symbol.asyncIterator&&I(a,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===b&&I(a,[IDBIndex,IDBObjectStore])}M={...e=M,get:(a,b,c)=>Z(a,b)?Y:e.get(a,b,c),has:(a,b)=>Z(a,b)||e.has(a,b)};let $="events";async function _(){return function(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,1),h=N(g);return d&&g.addEventListener("upgradeneeded",a=>{d(N(g.result),a.oldVersion,a.newVersion,N(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h}("ride-db",0,{upgrade(a){a.createObjectStore($,{keyPath:"id",autoIncrement:!0})}})}async function aa(a){(await _()).add($,{...a,created_at:Date.now()})}let ab=(0,a.i(69240).createBrowserSupabaseClient)();var ac=a.i(82279);function ad(){let a,b,c,d,e,k,l,m,n,o,p,q,r,s,t,u,v,w,y,z,A,B,E,G,I,J=(a=j(a=>a.trackingOn),b=j(a=>a.permissionStatus),c=j(a=>a.lastFix),d=j(a=>a.lastPingAt),e=j(a=>a.lastRecommendation),k=j(a=>a.error),l=j(a=>a.autoStartPending),m=j(a=>a.setTrackingOn),n=j(a=>a.setPermissionStatus),o=j(a=>a.setLastFix),p=j(a=>a.setLastPingAt),q=j(a=>a.setRecommendation),r=j(a=>a.setError),s=j(a=>a.setAutoStartPending),t=(0,h.useRef)(null),u=(0,h.useRef)(0),v=(0,h.useRef)(null),w=(0,h.useCallback)(async()=>{try{if(navigator.permissions?.query){let a=await navigator.permissions.query({name:"geolocation"});n(a.state),a.onchange=()=>n(a.state)}else n("unsupported")}catch(a){console.warn("permission query failed",a),n("unsupported")}},[n]),(0,h.useEffect)(()=>{w()},[w]),y=(0,h.useCallback)(()=>{null!==t.current&&"undefined"!=typeof navigator&&navigator.geolocation&&(navigator.geolocation.clearWatch(t.current),t.current=null)},[]),z=(0,h.useCallback)((a,b)=>{p(b),a&&q(a),r(null)},[p,q,r]),A=(0,h.useCallback)(async a=>{var b,c;let d,e,f,g,h,j="number"==typeof a.coords.accuracy?a.coords.accuracy:null;if(!Number.isFinite(j)||null===j||j>200)return void r("GPS accuracy is weak (>200m). Move outdoors for a clear fix.");let k="number"==typeof a.coords.speed&&Number.isFinite(a.coords.speed)?3.6*a.coords.speed:null;o({lat:a.coords.latitude,lon:a.coords.longitude,accuracy:j,speed:k,timestamp:a.timestamp}),r(null);let l=Date.now(),m=v.current,n=!1;if(m&&"number"==typeof m.coords.accuracy&&Number.isFinite(m.coords.accuracy)&&(n=j<=.5*m.coords.accuracy),m&&30>(b=m.coords,c=a.coords,d=b.latitude*Math.PI/180,f=(e=c.latitude*Math.PI/180)-d,2*Math.atan2(Math.sqrt(h=Math.sin(f/2)*Math.sin(f/2)+Math.cos(d)*Math.cos(e)*Math.sin((g=(c.longitude-b.longitude)*Math.PI/180)/2)*Math.sin(g/2)),Math.sqrt(1-h))*6371e3)&&l-u.current<5e3&&!n)return;v.current=a,u.current=l;let p={lat:a.coords.latitude,lon:a.coords.longitude,ts:new Date(a.timestamp).toISOString(),accuracy_m:j,speed_kmh:k??void 0},{data:q,error:s}=await (0,i.postPing)(p);if(s){r(s.message),await aa(p),D.toast.error("Could not sync live location. We'll retry soon.");return}z(q?.recommendation??null,p.ts??new Date().toISOString())},[o,z,r]),B=(0,h.useCallback)(async()=>{try{let{state:a}=await navigator.permissions.query({name:"geolocation"});if(n(a),"denied"===a)return D.toast.error("Location permission denied. Enable it in browser settings."),!1;return"prompt"===a&&(await new Promise((a,b)=>{navigator.geolocation.getCurrentPosition(a,b,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),n("granted")),!0}catch(a){return console.error("permission request failed",a),n("unsupported"),!1}},[n]),E=(0,h.useCallback)(async()=>{if(a){y(),m(!1);return}await B()?m(!0):r("Location permission required for live tracking")},[a,B,y,m,r]),(0,h.useEffect)(()=>{!a&&l&&(E(),s(!1))},[a,l,E,s]),(0,h.useEffect)(()=>{if(!a)return void y();if("undefined"==typeof navigator||!navigator.geolocation){r("Geolocation is not supported in this browser."),D.toast.error("Geolocation is not available on this device."),m(!1);return}return t.current=navigator.geolocation.watchPosition(a=>A(a),a=>{console.error("watchPosition error",a);let b=function(a){switch(a.code){case a.PERMISSION_DENIED:return"Location permission denied. Enable it in your browser settings.";case a.POSITION_UNAVAILABLE:return"GPS signal unavailable. Move outdoors for a clear view of the sky.";case a.TIMEOUT:return"Timed out while waiting for GPS. Try again from an open area.";default:return a.message||"Unable to determine your location."}}(a);r(b),a.code===a.PERMISSION_DENIED?(m(!1),n("denied"),D.toast.error("Permission denied. Please re-enable location access.")):D.toast.error(b)},{enableHighAccuracy:!0,maximumAge:0,timeout:15e3}),()=>y()},[a,A,y,r,m,n]),(0,h.useEffect)(()=>{function a(){r(null)}return window.addEventListener("online",a),()=>window.removeEventListener("online",a)},[r]),G=null!==c&&"number"==typeof c.accuracy&&Number.isFinite(c.accuracy)&&c.accuracy<=100,I=a&&!G,{trackingOn:a,permissionStatus:b,lastFix:c,lastPingAt:d,lastRecommendation:e,error:k,toggleTracking:E,hasLocation:G,isFetchingLocation:I}),K=function(){let[a,b]=(0,h.useState)(null);return(0,h.useEffect)(()=>{let a=!0;return async function(){let{data:{user:c}}=await ab.auth.getUser();if(!c)return;let{data:d}=await ab.from("profiles").select("id,full_name").eq("id",c.id).maybeSingle();a&&b({id:c.id,full_name:d?.full_name??c.user_metadata?.full_name??null})}(),()=>{a=!1}},[]),a}(),{stats:L}=(0,ac.useTodayStats)(),M=K?.full_name?`Hi, ${K.full_name.split(" ")[0]}`:"Hi driver",N=`Today | ${L.totalTrips} trips | ?${L.totalEarnings.toFixed(0)}`;J.hasLocation;let O=J.isFetchingLocation;return(0,f.jsx)(g.DriverShell,{title:M,subtitle:N,children:(0,f.jsxs)("div",{className:"space-y-6",children:[(0,f.jsx)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:(0,f.jsxs)("div",{className:"flex flex-col items-start gap-2 sm:items-end",children:[(0,f.jsx)(H,{trackingOn:J.trackingOn,accuracy:J.lastFix?.accuracy??null}),O&&(0,f.jsx)("div",{className:"text-xs text-amber-600",children:"Acquiring GPS fix..."})]})}),(0,f.jsx)(x,{trackingOn:J.trackingOn,seedRecommendation:J.lastRecommendation}),(0,f.jsx)(C,{currentLocation:J.lastFix,recommendedZones:J.lastRecommendation?.top??null}),(0,f.jsxs)("section",{className:"space-y-3",children:[(0,f.jsx)("h2",{className:"text-lg font-semibold",children:"Ride actions"}),(0,f.jsx)(F,{lastFix:J.lastFix})]})]})})}a.s(["default",()=>ad],20716)}];

//# sourceMappingURL=_1beff549._.js.map